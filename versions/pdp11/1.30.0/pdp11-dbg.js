(function(){var m;
function da(a){var b=16,d;if(a){b||(b=10);var c=a.charAt(0),e=0<a.indexOf(",");e&&(a=a.replace(/,/g,""));"#"==c?(b=8,c=null):"$"==c&&(b=16,c=null);null==c?a=a.substr(1):("0"==c&&(c=a.charAt(1),"b"==c&&e&&(b=2,c=null),"o"==c?(b=8,c=null):"x"==c&&(b=16,c=null)),null==c?a=a.substr(2):(c=a.charAt(a.length-1).toLowerCase(),"y"==c?(b=2,c=null):"."==c?(b=10,c=null):"h"==c&&(b=16,c=null),null==c&&(a=a.substr(0,a.length-1))));var f,c=a;((e=b)&&10!=e?16==e?null!==c.match(/^[0-9a-f]+$/i):8==e?null!==c.match(/^[0-7]+$/):2==
e&&null!==c.match(/^[01]+$/):null!==c.match(/^[0-9]+$/))&&!isNaN(f=parseInt(a,b))&&(d=f|0)}return d}function p(a,b,d){var c="";b?8<b&&(b=8):b=a&-65536?8:4;if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var e=a&15,e=e+(0<=e&&9>=e?48:55),c=String.fromCharCode(e)+c;a>>=4}return(d?"0x":"")+c}function ea(a){var b=a,d=a.lastIndexOf("/");0<=d&&(b=a.substr(d+1));d=b.indexOf("&");0<d&&(b=b.substr(0,d));return b}
function fa(a){var b="",d=a.lastIndexOf(".");0<=d&&(b=a.substr(d+1).toLowerCase());return b}function ja(){var a=ka();return-1!==a.indexOf("pcjs.org",a.length-8)}var la={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ma(a){return a.replace(/[&<>"']/g,function(a){return la[a]})}function na(a,b){return(a+"                                        ").slice(0,b)}function oa(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}
function sa(a,b,d){var c=0,e=a.length,f=0;for(void 0===d&&(d=function(a,b){return a>b?1:a<b?-1:0});c<e;){var h=c+e>>1,g;g=d(b,a[h]);0<g?c=h+1:(e=h,f=!g)}return f?c:~c}var ta=Date.now||function(){return+new Date};function ua(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function va(a,b){var d;if(Array.prototype.indexOf)return a.indexOf(b,d);d=d||0;0>d&&(d+=a.length);0>d&&(d=0);for(var c=a.length;d<c;d++)if(d in a&&a[d]===b)return d;return-1}
function wa(a,b,d,c){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return c&&c(a,f,e),[f,e];if(d&&"function"==typeof resources)return resources(a,function(b,d){c&&c(a,b,d)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");d&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),c&&c(a,f,e))});if(b&&"object"==
typeof b){var k="",l;for(l in b)b.hasOwnProperty(l)&&(k&&(k+="&"),k+=l+"="+encodeURIComponent(b[l]));k=k.replace(/%20/g,"+");g.open("POST",a,!!d);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(k)}else g.open("GET",a,!!d),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();d||(f=g.responseText,200!=g.status&&(e=g.status||-1),c&&c(a,f,e),h=[f,e]);return h}function ka(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function r(a){window&&window.alert(a)}function xa(a){var b=!1;window&&(b=window.confirm(a));return b}var ya=null;function za(){if(null==ya){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}ya=a}return ya}function Fa(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(d){}return b}
function Ga(a,b){try{return window.localStorage.setItem(a,b),!0}catch(d){}return!1}function Ha(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}function Ia(a,b,d){function c(){--a;0<=a&&(b()||(a=0));0<a?setTimeout(c,0):d()}c()}
function Ja(a,b){function d(){b(100===c)&&(e=setTimeout(d,c),c=100)}var c=0,e=null,f=!1;a.onmousedown=function(){f||e||(c=500,d())};a.ontouchstart=function(){e||(c=500,d())};a.onmouseup=a.onmouseout=function(){e&&(clearTimeout(e),e=null)};a.ontouchend=a.ontouchcancel=function(){e&&(clearTimeout(e),e=null);f=!0}}var Ka={init:[],show:[],exit:[]},La=!1,Ma=!1,Na=!0;function Oa(a,b){if(window){var d=window[a];window[a]="function"!==typeof d?b:function(){d&&d();b()}}}function Pa(a){Ka.init.push(a)}
function Qa(a){if(Na)try{for(var b=0;b<a.length;b++)a[b]()}catch(d){r(""+("An unexpected exception occurred:\n\n"+d.message+"\n\nPlease send this information to support@pcjs.org. Thanks."))}}function Ra(a){!Na&&a?(Na=!0,La&&Sa("init"),Ma&&Sa("show")):Na=a}function Sa(a){Ka[a]&&Qa(Ka[a])}Oa("onload",function(){La=!0;Qa(Ka.init)});Oa("onpageshow",function(){Ma=!0;Qa(Ka.show)});Oa(Ha("Opera")||Ha("iOS")?"onunload":"onbeforeunload",function(){Qa(Ka.exit)});
function t(a,b,d,c){this.type=a;b||(b={id:"",name:""});this.id=b.id||"";this.name=b.name;this.ob=b.comment;this.Jb=b;b=this.id.indexOf(".");0>b?this.Xa=this.id:(this.pb=this.id.substr(0,b),this.Xa=this.id.substr(b+1));this[a]=d;this.A={ready:!1,Da:!1,Va:!1,X:!1,error:!1};this.Ta=null;this.A.error=!1;this.K={};this.F=null;this.Y=c||0;u.push(this)}var Ta=void 0,Ua={};
if(window){Ta||(Ta=window.location.search.substr(1));for(var Va,Wa=/\+/g,Xa=/([^&=]+)=?([^&]*)/g;Va=Xa.exec(Ta);)Ua[decodeURIComponent(Va[1].replace(Wa," "))]=decodeURIComponent(Va[2].replace(Wa," "))}function Ya(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var d=typeof a;if("object"!==d&&"function"!==d)throw new TypeError;}b.prototype=a;return new b}
function v(a,b){b||(b=t);a.prototype=Ya(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}if(window){window.PCjs||(window.PCjs={});var Za=window.PCjs.Machines||(window.PCjs.Machines={}),u=window.PCjs.Components||(window.PCjs.Components=[])}else Za={},u=[];function $a(a,b,d){Za[a]&&b&&(Za[a][b]=d)}function ab(a){var b,d=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<u.length;b++){var c=u[b];a&&c.id.indexOf(a)||d.push(c)}return d}
function bb(a,b){var d;if(void 0!==a){var c;b&&(b=0<(c=b.indexOf("."))?b.substr(0,c+1):"");for(c=0;c<u.length;c++)if(d)d==u[c]&&(d=null);else if(!(a!=u[c].type||b&&u[c].id.indexOf(b)))return u[c]}return null}function w(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(d){r(d.message+" ("+a+")")}return b}
function lb(a,b){for(var d=z(b.parentNode,"pdp11-control"),c=0;c<d.length;c++)for(var e=d[c].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var k=g.split(" "),l=0;l<k.length;l++)switch(g=k[l],g){case "pdp11-binding":(g=w(h))&&g.binding&&a.ha(g.type,g.binding,h,g.value),l=k.length}}}}
function z(a,b,d){d&&(b+="-"+d+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var c;d=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(c=a.length;b<c;b++)e.test(a[b].className)&&d.push(a[b]);return d}
t.prototype={constructor:t,parent:null,toString:function(){return this.name?this.name:this.id||this.type},ha:function(a,b,d){switch(b){case "clear":return this.K[b]||(this.K[b]=d,d.onclick=function(a){return function(){a.K.print&&(a.K.print.value="")}}(this)),!0;case "print":return this.K[b]||(this.ya=this.K[b]=d,d.value="",this.u=function(a){return function(b,d){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==d?d+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(d),
this.ea=function(a){this.u(a,this.Xa)}),!0;default:return!1}},log:function(){},u:function(){},status:function(a){this.u(this.Xa+": "+a)},ea:function(a,b,d){d=d||this.type;b||r((d?d+": ":"")+a)},sa:function(){return this.A.X=!0},ra:function(a,b){b&&(this.A.X=!1);return!0}};function mb(a,b){if(a.F){a===a.F?b|=0:b=b||a.Y;var d=a.F.Y&b;return!!b&&d===b||!!(d&a.F.Db)}return!1}
function nb(a,b){if(a.A.Va)return a.A.Da&&(a.A.Da=!1),a.A.Va=!1;if(a.A.error)return a.u(a.toString()+" error"),!1;a.A.Da=b;return a.A.Da}function ob(a,b){a.A.Da&&(b?a.A.Va=!0:void 0===b&&a.u(a.toString()+" busy"));return a.A.Da}function A(a){if(!a.A.error&&(a.A.ready=!0,a.A.ready)){var b=a.Ta;a.Ta=null;b&&b()}}function pb(a,b){b&&(a.A.ready?b():a.Ta=b);return a.A.ready}function qb(a,b){a.A.error=!0;a.ea(b)}
var rb="undefined"!==typeof ArrayBuffer,C={cpu:1,bus:64,mem:128,keyboard:65536,key:131072,disk:2097152,serial:8388608,speaker:33554432,computer:67108864,log:268435456,warn:536870912,buffer:1073741824,halt:-2147483648};function sb(a){t.call(this,"Panel",a,sb)}v(sb);m=sb.prototype;m.ha=function(a,b,d,c){return this.D&&this.D.ha(a,b,d,c)||this.b&&this.b.ha(a,b,d,c)||this.F&&this.F.ha(a,b,d,c)?!0:this.parent.ha.call(this,a,b,d,c)};m.za=function(a,b,d,c){this.D=a;this.H=b;this.b=d;this.F=c};
m.sa=function(a,b){b||tb();return!0};m.ra=function(){return!0};m.ia=function(){};function tb(){for(var a=!1,b=z(document,"pdp11","panel"),d=0;d<b.length;d++){var c=b[d],e=w(c),f;a:{f=e.id;if(void 0!==f)for(var h=void 0,h=0;h<u.length;h++)if(u[h].id===f){f=u[h];break a}f=null}f||(a=!0,f=new sb(e));lb(f,c);a&&A(f)}}Pa(tb);
function ub(a,b,d){t.call(this,"Bus",a,ub);this.b=b;this.F=d;this.w=a.busWidth||16;this.D=Math.pow(2,this.w);this.j=this.D-1|0;this.aa=16>=this.w?10:20>=this.w?12:24>=this.w?14:15;this.la=1<<this.aa;this.C=this.la>>2;this.i=this.la-1;this.H=this.D/this.la|0;this.G=this.H-1;a=new D;vb(a,this.F);this.P=Array(this.H);for(b=0;b<this.H;b++)this.P[b]=a;A(this)}v(ub);ub.prototype.reset=function(){};ub.prototype.sa=function(a,b){b||this.reset();return!0};
function wb(a,b,d,c){for(var e=b,f=d,h=e>>>a.aa;0<f&&h<a.P.length;){var g=a.P[h],k=h*a.la,l=a.la-(e-k);l>f&&(l=f);if(g&&g.size){if(g.type==c){if(e+f<=g.B)return g.Sa+=g.B-e,g.B=e,!0;if(e>=g.B+g.Sa){l=g.size-(e-k);l>f&&(l=f);g.Sa=e-g.B+l;e=k+a.la;f-=l;h++;continue}}return xb(1,e,f)}e=new D(e,l,a.la,c);vb(e,a.F,g);a.P[h++]=e;e=k+a.la;f-=l}return 0>=f?(a.status(Math.floor(d/1024)+"Kb "+yb[c]+" at "+p(b,4,!0)),!0):xb(2,b,d)}function zb(a,b){return a.P[(b&a.j)>>>a.aa].Qa(b&a.i,b)}
function xb(a,b,d){r("Memory block error ("+a+": "+p(b)+","+p(d)+")");return!1}var Ab;if(rb){var Mb=new ArrayBuffer(2);(new DataView(Mb)).setUint16(0,256,!0);Ab=256===(new Uint16Array(Mb))[0]}else Ab=!1;var Nb=Ab;
function D(a,b,d,c){this.id=Ob+=2;this.b=null;this.B=a;this.Sa=b;this.size=d||0;this.type=c||Pb;this.C=c==Qb;vb(this);this.va=this.Fb=!1;if(d)if(rb)this.K=new ArrayBuffer(d),this.D=new DataView(this.K,0,d),this.i=new Uint8Array(this.K,0,d),this.L=new Uint16Array(this.K,0,d>>1),this.b=new Int32Array(this.K,0,d>>2),Rb(this,Nb?Sb:Tb);else{this.b=Array(d>>2);for(a=0;a<this.b.length;a++)this.b[a]=0;Rb(this,Ub)}else Rb(this)}var Pb=0,Qb=2,yb=["NONE","RAM","ROM","VID","H/W"],Ob=0;
D.prototype={constructor:D,parent:null,save:function(){var a,b;if(rb)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.D.getInt32(b<<2,!0);else a=this.b;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(rb)for(b=0;b<a.length;b++)this.D.setInt32(b<<2,a[b],!0);else this.b=a;return this.va=!0}return!1},xa:function(a,b){b?0===this.w++&&Vb(this,Wb,!1):0===this.j++&&Xb(this,Wb,!1)},M:function(){this.F&&mb(this.F,129)&&this.F.message("attempt to read invalid block %"+p(this.B),!0);
return 255},H:function(a,b){this.F&&mb(this.F,129)&&this.F.message("attempt to write "+p(b,4,!0)+" to invalid block %"+p(this.B),!0)},V:function(a,b){return this.G(a++,b++)|this.G(a,b)<<8},oa:function(a,b,d){this.J(a++,b&255,d++);this.J(a,b>>8,d)},S:function(a){return this.b[a>>2]>>>((a&3)<<3)&255},$:function(a){var b=a>>2;a=(a&3)<<3;var d=this.b[b]>>a;return 24>a?d&65535:d&255|(this.b[b+1]&255)<<8},ga:function(a,b){var d=a>>2,c=(a&3)<<3;this.b[d]=this.b[d]&~(255<<c)|b<<c;this.va=!0},na:function(a,
b){var d=a>>2,c=(a&3)<<3;24>c?this.b[d]=this.b[d]&~(65535<<c)|b<<c:(this.b[d]=this.b[d]&16777215|b<<24,d++,this.b[d]=this.b[d]&-256|b>>8);this.va=!0},O:function(a,b){if(this.F&&null!=this.B){var d=this.F;Yb(d,this.B+a,1,d.O)&&d.ba(!0)}return this.Qa(a,b)},U:function(a,b){if(this.F&&null!=this.B){var d=this.F;Yb(d,this.B+a,2,d.O)&&d.ba(!0)}return this.xb(a,b)},da:function(a,b,d){if(this.F&&null!=this.B){var c=this.F;Yb(c,this.B+a,1,c.C)&&c.ba(!0)}this.C?this.H(a,b,d):this.Ia(a,b,d)},ka:function(a,
b,d){if(this.F&&null!=this.B){var c=this.F;Yb(c,this.B+a,2,c.C)&&c.ba(!0)}this.C?this.H(a,b,d):this.Ab(a,b,d)},N:function(a){return this.i[a]},R:function(a){return this.i[a]},T:function(a){return this.D.getUint16(a,!0)},W:function(a){return a&1?this.i[a]|this.i[a+1]<<8:this.L[a>>1]},ca:function(a,b){this.i[a]=b;this.va=!0},fa:function(a,b){this.i[a]=b;this.va=!0},ja:function(a,b){this.D.setUint16(a,b,!0);this.va=!0},pa:function(a,b){a&1?(this.i[a]=b,this.i[a+1]=b>>8):this.L[a>>1]=b;this.va=!0}};
function vb(a,b,d){a.F=b;a.j=a.w=0;d&&((a.j=d.j)&&Xb(a,Wb,!1),(a.w=d.w)&&Vb(a,Wb,!1))}function Zb(a,b){b?0===--a.w&&(a.J=a.C?a.H:a.Ia):0===--a.j&&(a.G=a.Qa)}function Vb(a,b,d){d&&a.w||(a.J=!a.C&&b[2]||a.H);if(d||void 0===d)a.Ia=b[2]||a.H,a.Ab=b[3]||a.oa}function Xb(a,b,d){d&&a.j||(a.G=b[0]||a.M);if(d||void 0===d)a.Qa=b[0]||a.M,a.xb=b[1]||a.V}function Rb(a,b){b||(b=$b);Xb(a,b,void 0);Vb(a,b,void 0)}
var $b=[],Ub=[D.prototype.S,D.prototype.$,D.prototype.ga,D.prototype.na],Wb=[D.prototype.O,D.prototype.U,D.prototype.da,D.prototype.ka];if(rb)var Tb=[D.prototype.N,D.prototype.T,D.prototype.ca,D.prototype.ja],Sb=[D.prototype.R,D.prototype.W,D.prototype.fa,D.prototype.pa];
function ac(a,b){t.call(this,"CPU",a,ac,1);var d=a.multiplier||1;this.$a=a.cycles||b;this.Ba=d;this.La=Math.round(this.$a/1E4)/100;this.Aa=this.La*this.Ba;this.A.Z=!1;this.A.fb=!1;this.A.Ja=a.autoStart;this.A.kb=!1;this.A.Ea=!1;this.Na=this.ca=0;this.Oa=a.csStart;this.Fa=a.csInterval;this.Ga=a.csStop;this.oa=[];this.Ib=this.Ca.bind(this);A(this)}v(ac);var bc=["power","reset"];m=ac.prototype;
m.za=function(a,b,d,c){this.D=a;this.H=b;this.F=c;for(b=0;b<bc.length;b++)(d=this.K[bc[b]])&&this.D.ha(null,bc[b],d);this.ja=null;a=cc(a,"autoStart");null!=a&&(this.A.Ja="true"==a?!0:"false"==a?!1:!!a);A(this)};m.reset=function(){};m.save=function(){return null};m.restore=function(){return!1};
m.sa=function(a,b){if(!b){if(a&&this.restore){dc(this);if(!this.restore(a))return!1;ec(this)}else this.reset();if(this.F){var d=this.F;d.u("Type ? for help with PDP11 Debugger commands");d.ia();if(d.ka){var c=d.ka;d.ka=null;fc(d,c)}}else this.u("No debugger detected")}F(this);return!0};m.ra=function(a){return a?this.save():!0};m.Ja=function(){return this.A.Ja||!this.F&&void 0===this.K.run?(this.Ca(!0),!0):!1};m.mb=function(){return 0};
function ec(a){void 0===a.Oa&&(a.Oa=0);void 0===a.Fa&&(a.Fa=-1);void 0===a.Ga&&(a.Ga=-1);a.A.Ea=0<=a.Oa&&0<a.Fa;a.A.Ea&&(a.Na=0,a.ca=a.Oa-a.V)}function gc(a,b){if(a.A.Ea){var d=!1;a.Na=a.Na+a.mb()|0;a.ca-=b;0>=a.ca&&(a.ca+=a.Fa,d=!0);0<=a.Ga&&a.Ga<=hc(a)&&(a.Fa=a.Ga=-1,ec(a),a.ba(),d=!0);d&&a.u(hc(a)+" cycles: checksum="+p(a.Na))}}
function ic(a,b,d,c){a.K[b]&&(void 0===d&&(qb(a,"Value for "+b+" is invalid"),a.ba()),d=!a.A.Z||a.A.kb?p(d,c):"--------".substr(0,c),a.K[b].textContent!=d&&(a.K[b].textContent=d))}
m.ha=function(a,b,d){var c=this;a=!1;switch(b){case "power":case "reset":this.K[b]=d;a=!0;break;case "run":this.K[b]=d;d.onclick=function(){var a;if(a=c.D)if(a=c.D,a.A.X)a=!0;else{var b=null,d,g=ab(a.id);for(d=0;d<g.length&&(b=g[d],b===a||b.A.ready);d++);if(d==g.length)for(d=0;d<g.length&&(b=g[d],b===a||b.A.X);d++);d==g.length&&(b=a);r("The "+b.type+" component ("+b.id+") is not "+(b.A.ready?"powered yet":"ready yet"+(b.Ta?" (waiting for notification)":""))+".");a=!1}a&&(c.A.Z?c.ba():c.Ca())};a=!0;
break;case "speed":this.K[b]=d;a=!0;break;case "setSpeed":this.K[b]=d,d.onclick=function(){jc(c,c.Ba<<1,!0)},d.textContent=this.Aa.toFixed(2)+"Mhz",a=!0}return a};function kc(a,b,d){a.V+=b;d&&(a.U=a.R=0)}function lc(a,b){var d=1;b&&1<a.Ba&&a.S&&(d=a.S/a.La);a.ub=Math.round(1E3/30);a.wa=Math.floor(a.$a/30*d);b||(a.da=a.wa);a.cb=0}function hc(a){return a.V+a.O+a.U-a.R}function dc(a){a.S=0;a.vb=0;a.V=a.O=a.U=a.R=0;ec(a);jc(a,1)}
function jc(a,b,d){var c=!1;if(void 0!==b){.8>a.S/a.Aa?b=1:c=!0;a.Ba=b;b=a.La*a.Ba;if(a.Aa!=b){a.Aa=b;b=a.Aa.toFixed(2)+"Mhz";var e=a.K.setSpeed;e&&(e.textContent=b);a.u("target speed: "+b)}d&&a.D&&a.D.Ra()}kc(a,a.O);a.O=0;a.N=ta();a.T=0;lc(a);return c}function mc(a){a.U-=a.R;a.R=0}
m.Ca=function(a){if(nb(this,!0)){if(!this.A.Z){jc(this);this.D&&this.D.start(this.N,hc(this));this.A.Z=!0;this.A.fb=!0;this.ja&&this.ja.start();var b=this.K.run;b&&(b.textContent="Halt");this.D&&(this.D.ia(!0),a&&this.D.Ra(!0))}this.cb>=this.$a&&lc(this,!0);this.ka=0;this.na=ta();this.T&&(a=this.na-this.T,a>this.ub&&(this.N+=a,this.N>this.na&&(this.N=this.na)));try{do{for(var d=this.A.Ea?1:this.wa,c=this.oa.length-1;0<=c;c--){var e=this.oa[c];0>e[0]||d>e[0]&&(d=e[0])}this.Ha(d);var f=this.U-this.R;
a=f;for(var h=this.oa.length-1;0<=h;h--){var g=this.oa[h];0>g[0]||(g[0]-=a,0>=g[0]&&(g[0]=-1,g[1]()))}this.ka+=f;this.O+=f;kc(this,0,!0);gc(this,f);this.da-=f;if(0>=this.da){this.da+=this.wa;15<=++this.vb&&(this.D&&this.D.ia(),this.vb=0);break}}while(this.A.Z)}catch(k){this.ba();F(this);this.D&&this.D.stop(ta(),hc(this));nb(this,!1);qb(this,k.stack||k.message);return}d=setTimeout;c=this.Ib;this.T=ta();e=this.ub;this.ka&&(e=Math.round(e*this.ka/this.wa));e=e-(this.T-this.na);if(f=this.T-this.N)this.S=
Math.round(this.O/(10*f))/100,864E5<=f&&(this.V=0,jc(this));if(0>e||this.S<this.Aa)-1E3>e&&(this.N-=e),e=0;this.cb+=this.ka;this.T+=e;d(c,e)}else F(this),this.D&&this.D.stop(ta(),hc(this))};m.Ha=function(){return 0};m.ba=function(a){ob(this,!0);mc(this);kc(this,this.O);this.O=0;if(this.A.Z){this.A.Z=!1;this.ja&&this.ja.stop();var b=this.K.run;b&&(b.textContent="Run")}this.A.complete=a};function F(a,b){a.D&&a.D.ia(b)}
function zc(a){this.rb=+a.model||1170;ac.call(this,a,1E6);this.nb=0;this.w=65536;this.i=this.b=32768;this.j=65535;this.I=15;this.g=[0,0,0,0,0,0,0,0];this.zb=[0,0,0,0,0,0];this.fa=[0,0,0,0];this.memory=[];this.J=[];this.eb=this.wb=0;this.W=2;this.$=255;this.G=0;this.ga=-1;this.tb=this.Ma=this.sb=this.C=this.Ka=this.M=this.L=0;this.pa=[7,7,7,7];this.Za=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[65535,65535,65535,
65535,65535,65535,65535,65535,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];this.Kb=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.A.complete=this.A.Eb=!1}v(zc,ac);m=zc.prototype;m.reset=function(){this.A.Z&&this.ba();Ac(this);dc(this);this.A.error=!1;this.parent.reset.call(this)};
function Ac(a){a.$=255;a.J=[];a.wb=0;a.L=a.M=a.Ka=a.sb=0;a.pa[0]=a.pa[1]=a.pa[3]=7;a.Ma=0}m.mb=function(){return 0};m.save=function(){var a=new G(this);H(a,0,[]);H(a,1,[this.qb,this.V,this.Ba]);for(var b=this.H,d=0,c=[],e=0;e<b.H;e++){var f=b.P[e];if(f.va||f.Fb){c[d++]=e;var h=d++;a:if(f=f.save()){for(var g=0,k=0,l=[];g<f.length;){for(var n=f[g],q=g+1;q<f.length&&f[q]===n;)q++;l[k++]=q-g;l[k++]=n;g=q}if(l.length<f.length){f=l;break a}}c[h]=f}}H(a,2,c);return a.data()};
m.restore=function(a){var b=a[1];this.qb=b[0];this.V=b[1];jc(this,b[3]);a:{b=this.H;a=a[2];var d;for(d=0;d<a.length-1;d+=2){var c=a[d],e=a[d+1];if(e&&e.length<b.C){for(var f=0,h=Array(b.C),g=0;g<e.length-1;)for(var k=e[g++],l=e[g++];k--;)h[f++]=l;e=h}f=b.P[c];if(!f||!f.restore(e)){r("Unable to restore memory block "+c);b=!1;break a}}b=!0}return b};
m.ha=function(a,b,d){var c=!1;switch(b){case "PC":case "PSW":case "SF":case "ZF":case "CF":this.K[b]=d;this.nb++;c=!0;break;default:c=this.parent.ha.call(this,a,b,d)}return c};m.ia=function(a){this.nb&&(a||!this.A.Z||this.A.kb)&&(a=this.I&-14|0|(this.ta&255?0:4)|(this.ta&256?1:0),ic(this,"PSW",a,4),ic(this,"SF",a&8?1:0,1),ic(this,"ZF",a&4?1:0,1),ic(this,"CF",a&1?1:0,1));if(a=this.K.speed)a.textContent=this.A.Z&&this.S?this.S.toFixed(2)+"Mhz":"Stopped"};
function Bc(a,b){var d,c;a.b=b<<12;a.j=~b&4;a.i=b<<14;a.w=b<<16;if((b^a.I)&2048)for(d=0;6>d;d++)c=a.g[d],a.g[d]=a.zb[d],a.zb[d]=c;(a.C=b>>14&3)!==(a.I>>14&3)&&(a.fa[c]=a.g[6],a.g[6]=a.fa[a.C]);a.W=2;a.I=b}
function I(a,b){var d,c,e=0;0>a.ga?(a.I=a.I&63728|a.b>>12&8|a.i>>14&2|a.w>>16&1,a.j&65535||(a.I|=4),a.ga=a.I):a.C||(b=4,e=1);a.L&57344||(a.M=63222);a.C=0;0<=(d=L(a,b|65536))&&0<=(c=L(a,b+2&65535|65536))&&(Bc(a,c&53247|a.ga>>2&12288),e&&(a.g[6]=4),0<=Cc(a,a.ga)&&0<=Cc(a,a.g[7])&&(a.g[7]=d));a.G=0;return a.ga=-1}
function Dc(a,b,d){var c,e,f,h=0;if(d&a.sb){c=b>>13&a.pa[a.C];e=a.Za[a.C][c];f=(a.Za[a.C][c+16]<<6)+(b&8191)&4194303;if(a.Ka&16){if(3932160<=f&&4186112>f){f=f&262143;var g=f>>13&31;31>g?a.Ka&32&&(f=a.Kb[g]+(f&8190)&4194302,3932160<=f&&4186112>f&&console.log("panic(898)")):f|=4186112}}else f&=262143,253952<=f&&(f|=4186112);if(3932160>f&&(3915776<=f||f&1&&!(d&1)))return I(a,4);switch(e&7){case 1:h=4096;case 2:e|=128;d&4&&(h=8192);break;case 4:h=4096;case 5:d&4&&(h=4096);case 6:e|=d&4?192:128;break;
default:h=32768}32512!==(e&32520)&&(e&8?e&32512&&(b&8128)<(e>>2&8128)&&(h|=16384):(b&8128)>(e>>2&8128)&&(h|=16384));a.Za[a.C][c]=e;if(4194170!==f||a.C)a.Ma=a.C,a.tb=c;if(h){if(h&57344)return 0<=a.ga&&(h|=128),a.L&57344||(a.L=a.L|h|a.Ma<<5|a.tb<<1),I(a,168);a.L&61440||!(4191360>f||4194239<f)||(a.L|=4096,a.L&512&&(a.G|=2))}}else if(f=b&65535,57344<=f)f|=4186112;else if(f&1&&!(d&1))return I(a,4);return f}function M(a,b){return 4194304<=b?a.g[b-4194304]:3932160<=b?-1:0<=b?a.memory[b>>1]:b}
function N(a,b,d){d&=65535;return 4194304<=b?a.g[b-4194304]=d:3932160<=b?-1:0<=b?a.memory[b>>1]=d:b}function Q(a,b){var d;return 4194304<=b?a.g[b-4194304]&255:3932160<=b?-1:0<=b?(d=a.memory[b>>1],b&1&&(d=d>>8),d&255):b}function R(a,b,d){d&=255;return 4194304<=b?a.g[b-4194304]=a.g[b-4194304]&65280|d:3932160<=b?-1:0<=b?b&1?a.memory[b>>1]=d<<8|a.memory[b>>1]&255:a.memory[b>>1]=a.memory[b>>1]&65280|d:b}function L(a,b){return M(a,Dc(a,b,2))}
function Ec(a){var b=L(a,a.g[6]|65536);0<=b&&(a.g[6]=a.g[6]+2&65535);return b}function Cc(a,b){var d,c;a.g[6]=c=a.g[6]-2&65535;a.L&57344||(a.M=a.M<<8|246);if(!a.C&&c<=a.$&&4<c){if(c<=a.$-32)return a.g[6]=4,I(a,4);a.G|=4}return 0<=(d=Dc(a,c|65536,4))?N(a,d,b):d}
function Fc(a,b,d){var c,e,f=b&7;switch(b>>3&7){case 0:return I(a,4);case 1:if(6===f&&!a.C&&d&4&&(a.g[6]<=a.$||65534<=a.g[6])){if(a.g[6]<=a.$-32||65534<=a.g[6])return a.g[6]=4,I(a,4);a.G|=4}return 7===f?a.g[f]:a.g[f]|65536;case 2:e=2;c=a.g[f];7!==f&&(c|=65536,6>f&&d&1&&(e=1));break;case 3:e=2;c=a.g[f];7!==f&&(c|=65536);if(0>(c=L(a,c)))return c;c|=65536;break;case 4:e=-2;6>f&&d&1&&(e=-1);c=a.g[f]+e&65535;7!==f&&(c|=65536);break;case 5:e=-2;c=a.g[f]-2&65535;7!==f&&(c|=65536);if(0>(c=L(a,c)))return c;
c|=65536;break;case 6:if(0>(c=L(a,a.g[7])))return c;a.g[7]=a.g[7]+2&65535;c=c+a.g[f]&65535;return c|65536;case 7:if(0>(c=L(a,a.g[7])))return c;a.g[7]=a.g[7]+2&65535;c=c+a.g[f]&65535;return 0>(c=L(a,c|65536))?c:c|65536}a.g[f]=a.g[f]+e&65535;a.L&57344||(a.M=a.M<<8|e<<3&248|f);if(6===f&&!a.C&&d&4&&0>=e&&(a.g[6]<=a.$||65534<=a.g[6])){if(a.g[6]<=a.$-32)return a.g[6]=4,I(a,4);a.G|=4}return c}function S(a,b,d){var c;return b&56?(0<=(c=Fc(a,b,d))&&(c=Dc(a,c,d)),c):4194304+(b&7)}
function T(a,b){var d;b&56?0<=(d=S(a,b,2))&&(d=M(a,d)):d=a.g[b&7];return d}function Gc(a,b){var d;b&56?0<=(d=S(a,b,3))&&(d=Q(a,d)):d=a.g[b&7]&255;return d}function U(a,b){return((b&128?b|65280:b&255)<<1)+a&65535}
m.Ha=function(a){this.A.complete=!0;var b=this.A.Eb=this.F&&Hc(this.F),d=a?this.A.fb?0:1:-1;this.A.fb=!1;this.U=this.R=a;this.qb&256?(mc(this),a=!1):a=!0;if(a){do{if(b){if(Ic(this.F,this.g[7],d)){this.ba();break}d=1}var c,e,f,h,g;if(this.W)if(1===this.W)this.W=2;else{this.W=0;g=-1;c=this.wb&224;if(0<(a=this.J.length))for(;0<a--;){if(0<this.J[a].Ya){this.J[a].Ya--;this.W=2;break}if(this.J[a].ib){if(!this.J[a].ib()){this.J.splice(a,1);g--;continue}this.J[a].ib=null}this.J[a].Hb>c&&(c=this.J[a].Hb,g=
a)}c>(this.I&224)&&(0>g?I(this,160):(I(this,this.J[g].Mb),this.J.splice(g,1)))}this.L&57344||(this.M=0);this.G=this.I&16;if(0<=(a=L(this,this.g[7])))switch(this.g[7]=this.g[7]+2&65535,a&61440){case 4096:0<=(c=T(this,a>>6))&&(a&56?0<=(f=S(this,a,4))&&0<=N(this,f,c)&&(this.b=this.j=c,this.i=0):(this.b=this.j=this.g[a&7]=c,this.i=0));break;case 8192:0<=(c=T(this,a>>6))&&0<=(e=T(this,a))&&(this.b=this.j=this.w=a=c-e,this.i=(c^e)&(c^a));break;case 12288:0<=(c=T(this,a>>6))&&0<=(e=T(this,a))&&(this.b=this.j=
c&e,this.i=0);break;case 16384:0<=(c=T(this,a>>6))&&(a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e&~c,0<=N(this,f,a)&&(this.b=this.j=a,this.i=0)):(this.b=this.j=a=this.g[a&7]&=~c,this.i=0));break;case 20480:0<=(c=T(this,a>>6))&&(a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e|c,0<=N(this,f,a)&&(this.b=this.j=a,this.i=0)):(this.b=this.j=a=this.g[a&7]|=c,this.i=0));break;case 24576:0<=(c=T(this,a>>6))&&(a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=c+e,0<=N(this,f,a)&&(this.b=this.j=this.w=a,this.i=(c^a)&(e^a))):(g=a&7,
e=this.g[g],this.g[g]=(a=c+e)&65535,this.b=this.j=this.w=a,this.i=(c^a)&(e^a)));break;case 36864:0<=(c=Gc(this,a>>6))&&(a&56?0<=(f=S(this,a,5))&&0<=R(this,f,c)&&(this.b=this.j=c<<8,this.i=0):(c&128&&(c|=65280),this.b=this.j=this.g[a&7]=c,this.i=0));break;case 40960:0<=(c=Gc(this,a>>6))&&0<=(e=Gc(this,a))&&(a=c-e,this.b=this.j=this.w=a<<8,this.i=((c^e)&(c^a))<<8);break;case 45056:0<=(c=Gc(this,a>>6))&&0<=(e=Gc(this,a))&&(this.b=this.j=(c&e)<<8,this.i=0);break;case 49152:0<=(c=Gc(this,a>>6))&&0<=(e=
Q(this,f=S(this,a,7)))&&(a=e&~c,0<=R(this,f,a)&&(this.b=this.j=a<<8,this.i=0));break;case 53248:0<=(c=Gc(this,a>>6))&&0<=(e=Q(this,f=S(this,a,7)))&&(a=e|c,0<=R(this,f,a)&&(this.b=this.j=a<<8,this.i=0));break;case 57344:0<=(c=T(this,a>>6))&&(a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e-c,0<=N(this,f,a)&&(this.b=this.j=this.w=a,this.i=(c^e)&(e^a))):(g=a&7,e=this.g[g],this.g[g]=(a=e-c)&65535,this.b=this.j=this.w=a,this.i=(c^e)&(e^a)));break;default:switch(a&65024){case 2048:0<=(h=Fc(this,a,0))&&(g=a>>6&7,
0<=Cc(this,this.g[g])&&(this.g[g]=this.g[7],this.g[7]=h&65535));break;case 28672:0<=(c=T(this,a))&&(g=a>>6&7,c&32768&&(c|=-65536),e=this.g[g],e&32768&&(e|=-65536),a=~~(c*e),this.g[g]=a>>16&65535,this.g[g|1]=a&65535,this.b=a>>16,this.j=this.b|a,this.w=this.i=0,-32768>a||32767<a)&&(this.w=65536);break;case 29184:0<=(c=T(this,a))&&(c?(g=a>>6&7,e=this.g[g]<<16|this.g[g|1],this.w=this.i=0,c&32768&&(c|=-65536),a=~~(e/c),-32768<=a&&32767>=a?(this.g[g]=a&65535,this.g[g|1]=e-a*c&65535,this.j=a>>16|a,this.b=
a>>16):(this.i=32768,this.j=a>>15|a,this.b=e>>16,-1===c&&65534===this.g[g]&&(this.g[g]=this.g[g|1]=1))):(this.j=this.b=0,this.i=32768,this.w=65536));break;case 29696:0<=(c=T(this,a))&&(g=a>>6&7,a=this.g[g],a&32768&&(a|=4294901760),this.w=this.i=0,c&=63,c&32?(c=64-c,16<c&&(c=16),this.w=a<<17-c,a=a>>c):c&&(16<c?(this.i=a,a=0):(this.w=a=a<<c,(e=a>>15&65535)&&65535!==e&&(this.i=32768))),this.g[g]=a&65535,this.b=this.j=a);break;case 30208:if(0<=(c=T(this,a))){g=a>>6&7;e=this.g[g]<<16|this.g[g|1];this.w=
this.i=0;c&=63;if(c&32)c=64-c,32<c&&(c=32),a=e>>c-1,this.w=a<<16,a>>=1,e&2147483648&&(a|=4294967295<<32-c);else if(c){if(a=e<<c-1,this.w=a>>15,a<<=1,32<c&&(c=32),e>>=32-c)e|=4294967295<<c&4294967295,4294967295!==e&&(this.i=32768)}else a=e;this.g[g]=a>>16&65535;this.g[g|1]=a&65535;this.b=a>>16;this.j=a>>16|a}break;case 30720:a&56?0<=(e=M(this,f=S(this,a,6)))&&(e^=this.g[a>>6&7],0<=N(this,f,e)&&(this.b=this.j=e,this.i=0)):(this.b=this.j=e=this.g[a&7]^=this.g[a>>6&7],this.i=0);break;case 32256:g=a>>
6&7;if(this.g[g]=this.g[g]-1&65535)this.g[7]=this.g[7]-((a&63)<<1)&65535;break;default:switch(a&65280){case 256:this.g[7]=U(this.g[7],a);break;case 512:this.j&65535&&(this.g[7]=U(this.g[7],a));break;case 768:this.j&65535||(this.g[7]=U(this.g[7],a));break;case 1024:(this.b&32768)===(this.i&32768)&&(this.g[7]=U(this.g[7],a));break;case 1280:(this.b&32768)!==(this.i&32768)&&(this.g[7]=U(this.g[7],a));break;case 1536:this.j&65535&&(this.b&32768)===(this.i&32768)&&(this.g[7]=U(this.g[7],a));break;case 1792:this.j&
65535&&(this.b&32768)===(this.i&32768)||(this.g[7]=U(this.g[7],a));break;case 32768:this.b&32768||(this.g[7]=U(this.g[7],a));break;case 33280:!(this.w&65536)&&this.j&65535&&(this.g[7]=U(this.g[7],a));break;case 33024:this.b&32768&&(this.g[7]=U(this.g[7],a));break;case 33536:if(this.w&65536||!(this.j&65535))this.g[7]=U(this.g[7],a);break;case 33792:this.i&32768||(this.g[7]=U(this.g[7],a));break;case 34048:this.i&32768&&(this.g[7]=U(this.g[7],a));break;case 34304:this.w&65536||(this.g[7]=U(this.g[7],
a));break;case 34560:this.w&65536&&(this.g[7]=U(this.g[7],a));break;case 34816:I(this,24);break;case 35072:I(this,28);break;default:switch(a&65472){case 64:0<=(h=Fc(this,a,0))&&(this.g[7]=h&65535);break;case 192:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e<<8|e>>8,0<=N(this,f,a)&&(this.b=this.j=e&65280,this.i=this.w=0)):(g=a&7,e=this.g[g],this.g[g]=(e<<8|e>>8)&65535,this.b=this.j=e&65280,this.i=this.w=0);break;case 2560:a&56?0<=(f=S(this,a,4))&&0<=N(this,f,0)&&(this.b=this.w=this.i=this.j=0):this.b=this.w=
this.i=this.j=this.g[a&7]=0;break;case 2624:0<=(e=M(this,f=S(this,a,6)))&&(a=~e,0<=N(this,f,a)&&(this.b=this.j=a,this.w=65536,this.i=0));break;case 2688:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e+1,0<=N(this,f,a)&&(this.b=this.j=a,this.i=a&(a^e))):(g=a&7,e=this.g[g],a=e+1,this.g[g]=a&65535,this.b=this.j=a,this.i=a&(a^e));break;case 2752:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e-1,0<=N(this,f,a)&&(this.b=this.j=a,this.i=(a^e)&e)):(g=a&7,e=this.g[g],a=e-1,this.g[g]=a&65535,this.b=this.j=a,this.i=(a^e)&e);
break;case 2816:0<=(e=M(this,f=S(this,a,6)))&&(a=-e,0<=N(this,f,a)&&(this.w=this.b=this.j=a,this.i=a&e));break;case 2880:0<=(e=M(this,f=S(this,a,6)))&&(a=e+(this.w>>16&1),0<=N(this,f,a)&&(this.w=this.b=this.j=a,this.i=a&(a^e)));break;case 2944:0<=(e=M(this,f=S(this,a,6)))&&(a=e-(this.w>>16&1),0<=N(this,f,a)&&(this.w=this.b=this.j=a,this.i=(a^e)&e));break;case 3008:0<=(e=T(this,a))&&(this.b=this.j=e,this.w=this.i=0);break;case 3072:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=(this.w&65536|e)>>1,0<=N(this,
f,a)&&(this.w=e<<16,this.b=this.j=a,this.i=a^this.w>>1)):(g=a&7,e=this.g[g],a=(this.w&65536|e)>>1,this.g[g]=a&65535,this.w=e<<16,this.b=this.j=a,this.i=a^this.w>>1);break;case 3136:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e<<1|this.w>>16&1,0<=N(this,f,a)&&(this.w=this.b=this.j=a,this.i=a^e)):(g=a&7,e=this.g[g],a=e<<1|this.w>>16&1,this.g[g]=a&65535,this.w=this.b=this.j=a,this.i=a^e);break;case 3200:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e&32768|e>>1,0<=N(this,f,a)&&(this.w=e<<16,this.b=this.j=a,this.i=
this.b^this.w>>1)):(g=a&7,e=this.g[g],a=e&32768|e>>1,this.g[g]=a&65535,this.w=e<<16,this.b=this.j=a,this.i=this.b^this.w>>1);break;case 3264:a&56?0<=(e=M(this,f=S(this,a,6)))&&(a=e<<1,0<=N(this,f,a)&&(this.w=this.b=this.j=a,this.i=a^e)):(g=a&7,e=this.g[g],a=e<<1,this.g[g]=a&65535,this.w=this.b=this.j=a,this.i=a^e);break;case 3328:h=this.g[7]+((a&63)<<1)&65535;0<=(c=L(this,h|65536))&&(this.g[7]=this.g[5],this.g[5]=c,this.g[6]=h+2&65535);break;case 3392:a&56?0<=(h=Fc(this,a,0))&&(61440!==(this.I&61440)&&
(h&=65535),this.C=this.I>>12&3,0<=(c=L(this,h))&&(this.C=this.I>>14&3,0<=Cc(this,c)&&(this.b=this.j=c,this.i=0))):(g=a&7,c=6!==g||(this.I>>2&12288)===(this.I&12288)?this.g[g]:this.fa[this.I>>12&3],0<=Cc(this,c)&&(this.b=this.j=c,this.i=0));break;case 3456:0<=(e=Ec(this))&&((this.L&57344||(this.M=22),a&56)?0<=(h=Fc(this,a,0))&&(h&=65535,this.C=this.I>>12&3,0<=(f=Dc(this,h,4))&&(this.C=this.I>>14&3,0<=N(this,f,e)&&(this.b=this.j=e,this.i=0))):(g=a&7,6!==g||(this.I>>2&12288)===(this.I&12288)?this.g[g]=
e:this.fa[this.I>>12&3]=e,this.b=this.j=e,this.i=0));break;case 3520:0<=(f=S(this,a,4))&&(a=-(this.b>>15&1),0<=N(this,f,a)&&(this.j=a,this.i=0));break;case 35328:a&56?0<=(f=S(this,a,5))&&0<=R(this,f,0)&&(this.b=this.w=this.i=this.j=0):(this.g[a&7]&=65280,this.b=this.w=this.i=this.j=0);break;case 35392:0<=(e=Q(this,f=S(this,a,7)))&&(a=~e,0<=R(this,f,a)&&(this.b=this.j=a<<8,this.w=65536,this.i=0));break;case 35456:0<=(e=Q(this,f=S(this,a,7)))&&(a=e+1,0<=R(this,f,a)&&(this.b=this.j=a<<8,this.i=(a&(a^
e))<<8));break;case 35520:0<=(e=Q(this,f=S(this,a,7)))&&(a=e-1,0<=R(this,f,a)&&(this.b=this.j=a<<8,this.i=((a^e)&e)<<8));break;case 35584:0<=(e=Q(this,f=S(this,a,7)))&&(a=-e,0<=R(this,f,a)&&(this.w=this.b=this.j=a<<8,this.i=(a&e)<<8));break;case 35648:0<=(e=Q(this,f=S(this,a,7)))&&(a=e+(this.w>>16&1),0<=R(this,f,a)&&(this.b=this.j=this.w=a<<8,this.i=(a&(a^e))<<8));break;case 35712:0<=(e=Q(this,f=S(this,a,7)))&&(a=e-(this.w>>16&1),0<=R(this,f,a)&&(this.b=this.j=this.w=a<<8,this.i=((a^e)&e)<<8));break;
case 35776:0<=(e=Gc(this,a))&&(this.b=this.j=e<<8,this.w=this.i=0);break;case 35840:0<=(e=Q(this,f=S(this,a,7)))&&(a=((this.w&65536)>>8|e)>>1,0<=R(this,f,a)&&(this.w=e<<16,this.b=this.j=a<<8,this.i=this.b^this.w>>1));break;case 35904:0<=(e=Q(this,f=S(this,a,7)))&&(a=e<<1|this.w>>16&1,0<=R(this,f,a)&&(this.w=this.b=this.j=a<<8,this.i=(a^e)<<8));break;case 35968:0<=(e=Q(this,f=S(this,a,7)))&&(a=e&128|e>>1,0<=R(this,f,a)&&(this.w=e<<16,this.b=this.j=a<<8,this.i=this.b^this.w>>1));break;case 36032:0<=
(e=Q(this,f=S(this,a,7)))&&(a=e<<1,0<=R(this,f,a)&&(this.w=this.b=this.j=a<<8,this.i=(a^e)<<8));break;case 36160:a&56?0<=(h=Fc(this,a,0))&&(this.C=this.I>>12&3,0<=(c=L(this,h|65536))&&(this.C=this.I>>14&3,0<=Cc(this,c)&&(this.b=this.j=c,this.i=0))):(g=a&7,c=6!==g||(this.I>>2&12288)===(this.I&12288)?this.g[g]:this.fa[this.I>>12&3],0<=Cc(this,c)&&(this.b=this.j=c,this.i=0));break;case 36224:0<=(e=Ec(this))&&((this.L&57344||(this.M=22),a&56)?0<=(h=Fc(this,a,0))&&(this.C=this.I>>12&3,0<=(f=Dc(this,h|
65536,4))&&(this.C=this.I>>14&3,0<=N(this,f,e)&&(this.b=this.j=e,this.i=0))):(g=a&7,6!==g||(this.I>>2&12288)===(this.I&12288)?this.g[g]=e:this.fa[this.I>>12&3]=e,this.b=this.j=e,this.i=0));break;default:switch(a&65528){case 128:0<=(c=Ec(this))&&(g=a&7,this.g[7]=this.g[g],this.g[g]=c);break;case 152:this.I&49152||(this.I=this.I&63519|(a&7)<<5,this.W=1);break;case 160:case 168:a&1&&(this.w=0);a&2&&(this.i=0);a&4&&(this.j=1);a&8&&(this.b=0);break;case 176:case 184:a&1&&(this.w=65536);a&2&&(this.i=32768);
a&4&&(this.j=0);a&8&&(this.b=32768);break;default:switch(a){case 0:49152&this.I?I(this,4):(this.eb=3,mc(this),console.log("HALT at "+this.g[7].toString(8)));break;case 1:g=0;if(0<(a=this.J.length))for(;0<a--;)g+=this.J[a].Ya,this.J[a].Ya=0;0===g&&0===this.eb&&(this.eb=2,mc(this));break;case 3:I(this,12);break;case 4:I(this,16);break;case 5:this.I&49152||Ac(this);break;case 2:case 6:f=this.g[6];0<=(h=L(this,f|65536))&&(f=f+2&65535,0<=(c=L(this,f|65536))&&(this.g[6]=f+2&65535,c&=63743,this.I&49152&&
(c=c&63519|this.I&63712),this.g[7]=h,Bc(this,c),this.G&=-17,2===a&&(this.G|=this.I&16)));break;default:I(this,8)}}}}}}this.G&&(this.G&2?I(this,168):this.G&4?I(this,4):this.G&16&&I(this,12),this.G=0)}while(0<this.R)}return this.A.complete?this.U-this.R:void 0===this.A.complete?0:-1};Pa(function(){for(var a=z(document,"pdp11","cpu"),b=0;b<a.length;b++){var d=a[b],c=w(d),c=new zc(c);lb(c,d)}});
function Jc(a){t.call(this,"ROM",a,Jc);this.i=null;this.C=a.addr;this.j=a.size;this.G=a.writable;this.w=a.alias;this.D=a.file;this.J=ea(this.D);if(this.D){a=this.D;var b=fa(this.J);"json"!=b&&"hex"!=b&&(a=ka()+"/api/v1/dump?file="+this.D+"&format=bytes&decimal=true");var d=this;wa(a,null,!0,function(a,b,f){Kc(d,a,b,f)})}}v(Jc);Jc.prototype.za=function(a,b,d,c){this.H=b;this.b=d;this.F=c;Lc(this)};
Jc.prototype.sa=function(){if(this.qa){if(this.F){var a=this.F,b=this.id,d=this.C,c=this.j,e=this.qa,f=[],h;for(h in e){var g=e[h];"number"==typeof g&&(e[h]=g={o:g});var k=g.o,l=g.a;if(void 0!==k){var n=f,k=[k>>>0,h],q=sa(n,k,a.jb);0>q&&n.splice(-(q+1),0,k)}l&&(g.a=l.replace(/''/g,'"'))}a.G.push({Lb:b,B:d,Gb:c,qa:e,hb:f})}delete this.qa}return!0};Jc.prototype.ra=function(){return!0};
function Kc(a,b,d,c){if(c)a.ea("Unable to load system ROM (error "+c+": "+b+")");else{$a(a.pb,b,d);if("["==d.charAt(0)||"{"==d.charAt(0))try{var e=eval("("+d+")"),f=e.bytes,h=e.data;if(f)a.i=f;else if(h)for(a.i=Array(4*h.length),c=d=0;d<h.length;d++)a.i[c++]=h[d]&255,a.i[c++]=h[d]>>8&255,a.i[c++]=h[d]>>16&255,a.i[c++]=h[d]>>24&255;else a.i=e;a.qa=e.symbols;if(!a.i.length){r("Empty ROM: "+b);return}if(1==a.i.length){r(a.i[0]);return}}catch(g){a.ea("ROM data error: "+g.message);return}else for(b=d.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.i=Array(b.length),e=0;e<b.length;e++)a.i[e]=da(b[e]);Lc(a)}}
function Lc(a){if(!pb(a))if(!a.D)A(a);else if(a.i&&a.H){a.j||(a.j=a.i.length);if(a.i.length!=a.j)qb(a,"ROM size ("+p(a.i.length,8,!0)+") does not match specified size ("+p(a.j,8,!0)+")");else{var b;b=a.C;if(wb(a.H,b,a.j,a.G?1:Qb)){var d;for(d=0;d<a.i.length;d++){var c=a.H,e=b+d;c.P[(e&c.j)>>>c.aa].Ia(e&c.i,a.i[d]&255,e)}b=!0}else b=!1;if(b){b=[];"number"==typeof a.w?b.push(a.w):null!=a.w&&a.w.length&&(b=a.w);for(d=0;d<b.length;d++){for(var f=a,c=b[d],e=f.H,h=f.j,g=[],k=f.C>>>e.aa;0<h&&k<e.P.length;)g.push(e.P[k++]),
h-=e.la;e=f.H;f=f.j;h=0;for(c>>>=e.aa;0<f&&c<e.P.length;){k=g[h++];if(!k)break;e.P[c++]=k;f-=e.la}}delete a.i}}A(a)}}Pa(function(){for(var a=z(document,"pdp11","rom"),b=0;b<a.length;b++){var d=a[b],c=w(d),c=new Jc(c);lb(c,d)}});function Mc(a){t.call(this,"RAM",a,Mc);this.w=a.addr;this.j=a.size;this.i=!1}v(Mc);m=Mc.prototype;m.za=function(a,b,d,c){this.H=b;this.b=d;this.F=c;A(this)};m.sa=function(a,b){b||this.reset();return!0};m.ra=function(a){return a?this.save():!0};
m.reset=function(){!this.i&&this.j&&wb(this.H,this.w,this.j,1)&&(this.i=!0);this.i||r("No RAM allocated")};m.save=function(){return null};m.restore=function(){return!0};Pa(function(){for(var a=z(document,"pdp11","ram"),b=0;b<a.length;b++){var d=a[b],c=w(d),c=new Mc(c);lb(c,d)}});function Nc(a){t.call(this,"Keyboard",a,Nc,65536);A(this)}v(Nc);Nc.prototype.ha=function(){return!1};Nc.prototype.za=function(a,b,d,c){this.D=a;this.b=d;this.F=c;this.ja=null};
Pa(function(){for(var a=z(document,"pdp11","keyboard"),b=0;b<a.length;b++){var d=a[b],c=w(d),c=new Nc(c);lb(c,d)}});function Oc(a){t.call(this,"Debugger",a,Oc);this.R=this.ga=this.L=0;this.T=!1;this.w=-1;this.j=[];this.V={}}v(Oc);var Pc={"||":0,"&&":1,"|":2,"^":3,"&":4,"!=":5,"==":5,">=":6,">":6,"<=":6,"<":6,">>>":7,">>":7,"<<":7,"-":8,"+":8,"%":9,"/":9,"*":9};Oc.prototype.ab=function(){return-1};Oc.prototype.bb=function(){};
function Qc(a,b,d,c){if(d)if(b){0>a.w&&a.j.length&&(a.w=0);if(0>a.w||b!=a.j[a.w])a.j.splice(0,0,b),a.w=0;a.w--}else a.T?b="end":b=a.j[a.w+1];a=[];if(b){b=b.toLowerCase().replace(/""/g,"'");d=0;var e=null;c=c||";";for(var f=0;f<=b.length;f++){var h=b.charAt(f);if('"'==h||"'"==h)e?h==e&&(e=null):e=h;else if(h==c&&!e||!h)a.push(oa(b.substring(d,f))),d=f+1}}return a}
function Rc(a,b,d){for(d=d||-1;d--&&b.length;){var c=b.pop();if(2>a.length)return!1;var e=a.pop(),f=a.pop();switch(c){case "*":c=f*e;break;case "/":if(!e)return!1;c=f/e;break;case "%":if(!e)return!1;c=f%e;break;case "+":c=f+e;break;case "-":c=f-e;break;case "<<":c=f<<e;break;case ">>":c=f>>e;break;case ">>>":c=f>>>e;break;case "<":c=f<e?1:0;break;case "<=":c=f<=e?1:0;break;case ">":c=f>e?1:0;break;case ">=":c=f>=e?1:0;break;case "==":c=f==e?1:0;break;case "!=":c=f!=e?1:0;break;case "&":c=f&e;break;
case "^":c=f^e;break;case "|":c=f|e;break;case "&&":c=f&&e?1:0;break;case "||":c=f||e?1:0;break;default:return!1}a.push(c|0)}return!0}
function Sc(a,b,d){var c;if(b){b=Tc(a,b);for(var e=0,f=!1,h=b,g=[],k=[],l=b.split(/(\|\||&&|\||^|&|!=|==|>=|>>>|>>|>|<=|<<|<|-|\+|%|\/|\*)/);e<l.length;){var n=l[e++],q=n.length,n=oa(n);if(!n){f=!0;break}n=Uc(a,n,null,!1===d);if(void 0===n){f=!0;d=!1;break}g.push(n);if(e==l.length)break;var n=l[e++],y=n.length;k.length&&Pc[n]<Pc[k[k.length-1]]&&Rc(g,k,1);k.push(n);b=b.substr(q+y)}Rc(g,k)&&1==g.length||(f=!0);f?d&&a.u("error parsing '"+h+"' at character "+(h.length-b.length)):(c=g.pop(),d&&Vc(a,null,
c))}return c}function Tc(a,b){for(var d;(d=b.match(/\{(.*?)}/))&&!(0<=d[1].indexOf("{"));){var c=Sc(a,d[1]);b=b.replace("{"+d[1]+"}",null!=c?p(c):"undefined")}for(;(d=b.match(/\[(.*?)]/))&&!(0<=d[1].indexOf("["));)b=b.replace("["+d[1]+"]","unimplemented");for(d=b;c=d.match(/\$([a-z]+)/i);){var e=null;switch(c[1].toLowerCase()){case "ops":e=a.R-a.ga}if(null==e)break;d=d.replace(c[0],e.toString())}return d}
function Uc(a,b,d,c){var e;null!=b?(e=a.ab(b),0<=e?e=a.bb(e):(e=a.V[b],null==e&&(e=da(b))),null!=e||c||a.u("invalid "+(d?d:"value")+": "+b)):c||a.u("missing "+(d||"value"));return e}
function Vc(a,b,d){var c,e=!1;if(void 0!==d){var e=!0,f=d,h=0;c="";if(!h||4<h)h=4;for(var g=0;g<h;g++){c&&(c=","+c);var k=f&255,l=8,n="";l?32<l&&(l=32):l=32;if(null==k||isNaN(k))for(;0<l--;)n="?"+n;else for(;0<l--;)n=(k&1?"1":"0")+n,k>>=1;c=n+c;f>>=8}f=d;h=0;g="";h?11<h&&(h=11):h=f&-65536?11:6;if(null==f||isNaN(f))for(;0<h--;)g="?"+g;else for(;0<h--;)g=String.fromCharCode((f&7)+48)+g,f>>=3;c=p(d,0,!0)+" "+d+". "+("0o"+g)+" "+("0b"+c)}a.u((null!=b?b+": ":"")+c);return e}
function Wc(a,b){if(b)return Vc(a,b,a.V[b]);var d=0;for(b in a.V)Vc(a,b,a.V[b]),d++;return 0<d}function Xc(a){Oc.call(this,a);this.N=V();this.pa=V();this.S=V();this.G=[];this.i=this.O=this.C=[];Yc(this);this.ca=0;Zc(this);this.ja=[];$c(this,a.messages);this.ka=a.commands;var b=this;window?void 0===window.pdp11&&(window.pdp11=function(a){return fc(b,a)}):void 0===global.pdp11&&(global.pdp11=function(a){return fc(b,a)})}v(Xc,Oc);
var ad={"?":"help/print","a [#]":"assemble","b [#]":"breakpoint",c:"clear output","d [#]":"dump memory","e [#]":"edit memory",f:"frequencies","g [#]":"go [to #]",h:"halt","if":"eval expression","int [#]":"request interrupt",k:"stack trace",ln:"list nearest symbol(s)",m:"messages",p:"step over",print:"print expression",r:"dump/set registers",reset:"reset machine",s:"set options","t [#]":"trace","u [#]":"unassemble",v:"print version","var":"assign variable"},bd=["NONE"],cd=["PC","PSW"],dd=[];m=Xc.prototype;
m.za=function(a,b,d,c){this.H=b;this.b=d;this.D=a;(a=cc(a,"messages"))&&$c(this,a);this.oa=dd;ed(this,function(a){a:{var b=c.H.P,d=a[0],g=a=0,k=b.length;if(d){a=W(X(c,d));if(-1===a){c.u("invalid address: "+d);break a}g=a>>>c.H.aa;k=1}c.u("blockid   physical   blockaddr   used    size    type");c.u("--------  ---------  ----------  ------  ------  ----");for(var d=-1,l=0;k--;){var n=b[g];n.type==d?l++||c.u("..."):(d=n.type,l=yb[d],n&&c.u(p(n.id)+"  %"+p(g<<c.H.aa)+"  %%"+p(n.B)+"  "+p(n.Sa,4,!0)+"  "+
p(n.size,4,!0)+"  "+l),d!=Pb&&(d=-1),l=0);a+=c.H.la;g++}}});A(this)};
m.ha=function(a,b,d){var c=this;switch(b){case "debugInput":return this.$=this.K[b]=d,d.onkeydown=function(a){var b;if(13==a.keyCode)b=d.value,d.value="",fc(c,b,!0);else if(27==a.keyCode)d.value=b="";else if(38==a.keyCode?(b=null,c.w<c.j.length-1&&(b=c.j[++c.w])):40==a.keyCode&&(0<c.w?b=c.j[--c.w]:(b="",c.w=-1)),null!=b){var h=b.length;d.value=b;d.setSelectionRange(h,h)}null!=b&&a.preventDefault&&a.preventDefault()},!0;case "debugEnter":return this.K[b]=d,Ja(d,function(){if(c.$){var a=c.$.value;c.$.value=
"";fc(c,a,!0);return!0}return!1}),!0;case "step":return this.K[b]=d,Ja(d,function(a){var b=!1;ob(c,!0)||(nb(c,!0),b=c.Ha(a?1:0),nb(c,!1));return b}),!0}return!1};m.Ra=function(){this.$&&this.$.focus()};function W(a){a=a&&a.B;null==a&&(a=-1);return a}m.ua=function(a,b){var d=255,c=W(a);-1!==c&&(d=zb(this.H,c),b&&fd(a,b));return d};m.Ua=function(a,b){var d=65535,c=W(a);if(-1!==c){var d=this.H,e=c&d.i,f=(c&d.j)>>>d.aa,d=e!=d.i?d.P[f].xb(e,c):d.P[f++].Qa(e,c)|d.P[f&d.G].Qa(0,c+1)<<8;b&&fd(a,b)}return d};
m.gb=function(a,b,d){var c=W(a);if(-1!==c){var e=this.H;e.P[(c&e.j)>>>e.aa].Ia(c&e.i,b&255,c);d&&fd(a,d);F(this.b,!0)}};m.Bb=function(a,b,d){var c=W(a);if(-1!==c){var e=this.H,f=c&e.i,h=(c&e.j)>>>e.aa;f!=e.i?e.P[h].Ab(f,b&65535,c):(e.P[h++].Ia(f,b&255,c),e.P[h&e.G].Ia(0,b>>8&255,c+1));d&&fd(a,d);F(this.b,!0)}};function V(a){return{B:a,ma:!1}}function gd(a){return[a.B,a.ma]}function hd(a){return{B:a[0],ma:a[1]}}
function X(a,b,d){var c;d=(d?a.N:a.pa).B;if(void 0!==b){c=b=Tc(a,b);var e;if(c.match(/^[a-z_][a-z0-9_]*$/i))for(c=c.toUpperCase(),d=0;d<a.G.length;d++){var f=a.G[d].qa[c];if(void 0!==f){c=f.o;void 0!==c&&(e=V(c));break}}if(c=e)return c;d=Sc(a,b,void 0)}null!=d&&(c=V(d));return c}function id(a,b,d){d&&(d=d.match(/(['"])(.*?)\1/))&&(b.Cb=Qc(a,b.yb=d[2]))}function fd(a,b){null!=a.B&&(a.B+=b||1)}
function jd(a,b,d){var c="";for(d=d||256;c.length<d;){var e=a.ua(b,1);if(!e||36==e||127<=e)break;c+=32<=e?String.fromCharCode(e):"."}return c}function $c(a,b){a.F=a;a.Y=a.Db=536870912;a.da=null;a.fa=[];var d=Qc(a,b.replace("keys","key").replace("kbd","keyboard"),!1,"|");if(d.length)for(var c in C)0<=va(d,c)&&(a.Y|=C[c],a.u(c+" messages enabled"))}function ed(a,b){for(var d in C)if(64==C[d]){a.ja[d]=b;break}}
m.ab=function(a,b){var d;a=a.toUpperCase();null==b?d=va(cd,a):(d=va(cd,a.substr(b,2)),0>d&&(d=va(cd,a.substr(b,1))));return d};m.bb=function(a){var b;if(0<=a){var d=this.b;switch(a){case 12:b=d.g[7];break;case 14:b=d.I&-14|0|(d.ta&255?0:4)|(d.ta&256?1:0)}}return b};
function kd(a,b){b=Tc(a,b);for(var d=0,c,e;0<=(d=b.indexOf("@",d));){e=a.ab(b,d+1);if(0<=e){c=0;var f=a.bb(e);if(void 0!==f)switch(e){case 12:case 14:c=4}b=b.substr(0,d)+(c?p(f,c):"??")+b.substr(d+1+cd[e].length)}d++}for(d=0;0<=(d=b.indexOf("#",d));)e=b.substr(d+1,2),c=da(e),null!=c&&32<=c&&128>c?(c=e+" '"+String.fromCharCode(c)+"'",b=b.replace("#"+e,c),d+=c.length):d++;for(d=0;0<=(d=b.indexOf("$",d));)e=b.substr(d+1,9),(c=X(a,e))?(c=e+' "'+jd(a,c)+'"',b=b.replace("$"+e,c),d+=c.length):d++;for(d=
0;0<=(d=b.indexOf("^",d));)e=b.substr(d+1,9),(c=X(a,e))?(fd(c),c=e+' "'+jd(a,c,11)+'"',b=b.replace("^"+e,c),d+=c.length):d++;return b}m.message=function(a,b){b&&(a+=" at "+p(V(this.b.g[7]).B,4));if(this.Y&1073741824)this.fa.push(a);else if(!this.da||a!=this.da)if(this.da=a,this.Y&-2147483648&&(this.ba(),a+=" (cpu halted)"),this.u(a),this.b){var d=this.b;mc(d);d.da=0;F(d)}};
function Zc(a){var b;if(Hc(a)){if(!a.M||!a.M.length){a.M=Array(1E3);for(b=0;b<a.M.length;b++)a.M[b]=V();a.W=0;a.u("instruction history buffer allocated")}if(!a.J||!a.J.length)for(a.J=Array(256),b=0;b<a.J.length;b++)a.J[b]=[b,0]}else a.M&&a.M.length&&a.u("instruction history buffer freed"),a.W=0,a.M=[],a.J=[]}m.Ca=function(a){if(!ld(this))return!1;this.b.Ca(a);return!0};
m.Ha=function(a,b,d){if(!ld(this))return!1;this.L=0;a||Hc(this)&&Ic(this,this.b.g[7],0);try{var c=this.b.Ha(a);0<c&&(this.L+=c,kc(this.b,c,!0),gc(this.b,c),this.R++)}catch(e){"number"!=typeof e&&(this.L=0,qb(this.b,e.stack||e.message))}!1!==d&&F(this.b);this.ia(b||!1);return 0<this.L};m.ba=function(a){this.b&&this.b.ba(a)};m.ia=function(a){void 0===a&&(a=!0);this.N=V(this.b.g[7]);a&&1!=this.U?md(this):nd(this)};
function ld(a){var b;if(b=a.b&&pb(a.b))b=a.b,b.A.X?b=!0:(b.u(b.toString()+" not powered"),b=!1);b&&!ob(a.b)?(a=a.b,a.A.error?(a.u(a.toString()+" error"),a=!0):a=!1,a=!a):a=!1;return a}m.sa=function(a,b){return!b&&(this.reset(!0),a&&this.restore&&!this.restore(a))?!1:!0};m.ra=function(a,b){b&&this.u(a?"suspending":"shutting down");return a?this.save():!0};m.reset=function(a){Zc(this);this.R=this.ga=0;this.da=null;this.L=0;this.N=V(this.b.g[7]);this.A.Z=!1;od(this);a||this.ia()};
m.save=function(){var a=new G(this);H(a,0,gd(this.N));H(a,1,gd(this.S));H(a,2,[this.j,this.T,this.Y]);H(a,3,this.G);return a.data()};m.restore=function(a){var b=0;void 0!==a[2]&&(this.N=hd(a[b++]),this.S=hd(a[b++]),this.j=a[b][0],"string"==typeof this.j&&(this.j=[this.j]),this.T=a[b][1],this.Y|=a[b][2]);a[3]&&(this.G=a[3]);return!0};m.start=function(a,b){this.U||this.u("running");this.A.Z=!0;this.Ka=a;this.La=b};
m.stop=function(a,b){if(this.A.Z){this.A.Z=!1;this.L=b-this.La;if(!this.U){var d="stopped";if(this.L){var c=a-this.Ka,e=0<c?Math.round(1E3*this.L/c):0,d=d+" (";Hc(this)&&(d+=this.R+" opcodes, ",this.ga-=this.R,this.R=0);d+=this.L+" cycles, "+c+" ms, "+e+" hz)"}else mb(this,-2147483648)&&(d+=" (use the 't' command to execute blocked faults)");this.u(d)}this.ia(!0);this.Ra();od(this,this.b.g[7])}};function Hc(a){return 1<a.i.length||!!a.ca}
function Ic(a,b,d){var c=a.b;if(0<d&&(a.ca&&!--a.ca||Yb(a,b,1,a.i)))return!0;0<=d&&a.J.length&&(a.R++,b=zb(a.H,b),null!=b&&(a.J[b][1]++,b=a.M[a.W],b.B=c.g[7],b.ma=!1,++a.W==a.M.length&&(a.W=0)));return!1}function Yc(a){var b,d;a.i=["bp"];if(void 0!==a.O)for(b=1;b<a.O.length;b++){d=a.O[b];var c=a.H;Zb(c.P[W(d)>>>c.aa],!1)}a.O=["br"];if(void 0!==a.C)for(b=1;b<a.C.length;b++)d=a.C[b],c=a.H,Zb(c.P[W(d)>>>c.aa],!0);a.C=["bw"];a.na=0}
m.xa=function(a,b,d){var c=!0;d||pd(this,a,b,!1,!0);if(a!=this.i){var e=W(b);if(-1===e)this.u("invalid address: "+p(b.B,4)),c=!1;else{var f=this.H;f.P[e>>>f.aa].xa(e&f.i,a==this.C)}}c&&(a.push(b),d?b.ma=!0:(qd(this,a,a.length-1,"set"),Zc(this)));return c};function pd(a,b,d,c,e){var f=!1;d=W(d);for(var h=1;h<b.length;h++){var g=b[h];if(d==W(g)&&(!c||g.ma)){f=!0;g.ma||e||qd(a,b,h,"cleared");b.splice(h,1);b!=a.i&&(c=a.H,Zb(c.P[d>>>c.aa],b==a.C));g.ma||Zc(a);break}}return f}
function rd(a,b){for(var d=1;d<b.length;d++)qd(a,b,d);return b.length-1}function qd(a,b,d,c){d=b[d];a.u(b[0]+" "+p(d.B,4)+(c?" "+c:d.yb?' "'+d.yb+'"':""))}function od(a,b){if(void 0!==b)Yb(a,b,1,a.i,!0),a.U=0;else for(var d=1;d<a.i.length;d++){var c=a.i[d];if(c.ma){if(!pd(a,a.i,c,!0))break;d=0}}}
function Yb(a,b,d,c,e){var f=!1;if(!a.na++)for(var h=1;!f&&h<c.length;h++){var g=c[h];if(!e||g.ma)for(var k=W(g),l=0;l<d;l++)if(b+l==k){var n,f=!0;g.ma&&(pd(a,c,g,!0),e=!0);if(n=g.Cb){for(var f=!1,q=0;q<n.length;q++)if(!sd(a,n[q],!0)){if(n[q].indexOf("if")){f=!0;break}for(var y=q+1;y<n.length&&n[y].indexOf("else");y++)q++;if(y==n.length){f=!0;break}}a.b.A.Z||(f=!0)}if(f){e||qd(a,c,h,"hit");break}}}a.na--;return f}
function Rd(a,b,d,c){for(var e=V(b.B),f=a.ua(b,1),h=a.oa[f]||[0],g="",k=bd[h[0]],l=h.length-1,n=0,q,y=1;y<=l;y++){var J="";q=h[y];if(void 0!==q){var E=q&240;if(E){var ga=q&15;ga?n=ga:q|=n;q&61440||(q|=1==y?8192:4096);if(E&32)a:{var J=a,E=q,ga=b,B=" ";switch(E&15){case 1:B=p(J.ua(ga,1),2);break;case 2:B=p(J.ua(ga,1)<<24>>24,4);break;case 3:B=p(J.Ua(ga,2),4);break;default:J="imm("+p(E,4,!0)+")";break a}E&64?B="["+B+"]":E&16||(B="0x"+B);J=B}else E&16?J=cd[(q&3840)>>8]:E&128&&(J=(f>>3&7).toString());
if(!J||!J.length){g="INVALID";break}0<g.length&&(g+=",");g+=J||"???"}}}f="";h=p(e.B,4)+" ";if(-1!==e.B&&-1!==b.B){do if(f+=p(a.ua(e,1),2),null==e.B)break;while(e.B!=b.B)}h+=na(f,10);h=h+(q&32768?"*":" ")+na(k,7);g&&(h+=" "+g);d&&(h=na(h,40)+";"+d,h=a.b.A.Ea?h+("cycles="+hc(a.b).toString()+" cs="+p(a.b.Na)):h+(null!=c?"="+c.toString():""));return h}m.jb=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
function Sd(a,b,d){var c=[],e=W(b)>>>0;for(b=0;b<a.G.length;b++){var f=a.G[b],h=f.B>>>0,g=f.Gb;if(e>=h&&e<h+g){e=sa(f.hb,[e-h],a.jb);0<=e?Td(a,b,e,c):d&&(e=~e,Td(a,b,e-1,c),Td(a,b,e,c));break}}return c}function Td(a,b,d,c){var e={},f=a.G[b].hb,h=0,g=null;0<=d&&d<f.length&&(h=f[d][0],g=f[d][1]);g&&(e=a.G[b].qa[g],g="."==g.charAt(0)?null:e.l||g);c.push(g);c.push(h);c.push(e.a);c.push(e.c)}
function Ud(a,b){if("?"==b)a.u("frequency commands:"),a.u("\tclear\tclear all frequency counts");else{var d,c=0;if(a.J)if("clear"==b){for(d=0;d<a.J.length;d++)a.J[d]=[d,0];a.u("frequency data cleared");c++}else if(void 0!==b)a.u("unknown frequency command: "+b),c++;else{var e=a.J.slice();e.sort(function(a,b){return b[1]-a[1]});for(d=0;d<e.length;d++){var f=e[d][0],h=e[d][1];h&&(a.u((bd[a.oa[f][0]]+"  ").substr(0,5)+" ("+p(f,2,!0)+"): "+h+" times"),c++)}}c||a.u("no frequency data available")}}
function Vd(a,b){var d=b.match(/^\s*([A-Z_]?[A-Z0-9_]*)\s*(=?)\s*(.*)$/i);if(d){if(!d[1])return Wc(a)||a.u("no variables"),!0;if(!d[2])return Wc(a,d[1]);if(!d[3])return delete a.V[d[1]],!0;var c=Sc(a,d[3]);return void 0!==c?(a.V[d[1]]=c,!0):!1}a.u("invalid assignment:"+b);return!1}
function Wd(a,b,d){var c=null;if(b=X(a,b,!0)){var e=Sd(a,b,!0);if(e.length){var f,h;e[0]&&(h="",(f=b.B-e[1])&&(h=" + "+p(f,4,!0)),f=e[0]+" ("+p(e[1],4)+")"+h,d&&a.u(f),c=f);4<e.length&&e[4]&&(h="",(f=e[5]-b.B)&&(h=" - "+p(f,4,!0)),f=e[4]+" ("+p(e[5],4)+")"+h,d&&a.u(f),c||(c=f))}else d&&a.u("no symbols")}return c}
function md(a,b){var d;if(b&&"?"==b[1])a.u("register commands:"),a.u("\tr\tdump registers"),a.u("\trx [#]\tset flag or register x to [#]");else{var c=a.b;null==d&&(d=!0);if(null!=b&&1<b.length){var e=b[1],f=null,h=e.indexOf("=");if(0<h)f=e.substr(h+1),e=e.substr(0,h);else if(2<b.length)f=b[2];else{a.u("missing value for "+b[1]);return}var h=!1,g=Sc(a,f);if(void 0!==g)switch(h=!0,e.toUpperCase()){case "PC":c.g[7]=g;a.N=V(c.g[7]);break;case "CF":c.ta=g?c.ta|256:c.ta&255;break;case "ZF":c.ta=g?c.ta&
-256:c.ta|255;break;case "SF":break;default:a.u("unknown register: "+e);return}if(!h){a.u("invalid value: "+f);return}F(c);a.u("updated registers:")}a.u("no regs");d&&(a.N=V(c.g[7]),nd(a,p(a.N.B,4)))}}function Xd(a,b){b=oa(b);var d=b.match(/^(['"])(.*?)\1$/);d?a.u(kd(a,d[2])):Sc(a,b,!0)}function Yd(a,b,d){var c="t"!=b;d=Uc(a,d,null,!0)||1;var e=1==d?0:1;"tc"==b&&(e=d,d=1);Ia(d,function(){return nb(a,!0)&&a.Ha(e,c,!1)},function(){F(a.b);nb(a,!1)})}
function nd(a,b,d,c){if(b=X(a,b,!0)){void 0===c&&(c=1);var e=256;if(void 0!==d){c=X(a,d,!0);if(!c||c.B<b.B)return;e=c.B-b.B;if(256<e){a.u("range too large");return}c=-1}d=0;for(var f;0<e&&c--;){f=ob(a,!1)||a.U?a.L:null;var h=null!=f?"cycles":null,g=Sd(a,b),k=b.B;if(g[0]&&c&&(!d&&c||0>g[0].indexOf("+"))){var l=g[0]+":";g[2]&&(l+=" "+g[2]);a.u(l)}g[3]&&(h=g[3],f=null);f=Rd(a,b,h,f);a.u(f);a.N=b;e-=b.B-k;d++}}}
function sd(a,b,d){var c=!0;try{b.length&&"end"!=b?d||a.u(">> "+b):(a.T&&(a.u("ended assemble at "+p(a.S.B,4)),a.N=a.S,a.T=!1),b="");var e=b.charAt(0);if('"'==e||"'"==e)return!0;a.da=null;if(pb(a)&&0<b.length){a.T&&(b="a "+p(a.S.B,4)+" "+b);var f=b.replace(/ +/g," ").split(" ");if(f&&f.length)for(var h=f[0],g=h.charAt(0),k=1;k<h.length;k++){var l=h.charAt(k);if("?"==g||"r"==g||"a">l||"z"<l){f[0]=h.substr(k);f.unshift(h.substr(0,k));break}}switch(f[0].charAt(0)){case "a":var n=X(a,f[1],!0);if(n)if(a.S=
n,void 0===f[2])a.u("begin assemble at "+p(n.B,4)),a.T=!0,F(a.b);else{var q;a.u("not supported yet");q=[];if(q.length){for(var y=0;y<q.length;y++)a.gb(n,q[y],1);a.u(Rd(a,a.S))}}break;case "b":a:{var J=f[0],E=f[1],ga=b;if("?"==E)a.u("breakpoint commands:"),a.u("\tbp [a]\tset exec breakpoint at addr [a]"),a.u("\tbr [a]\tset read breakpoint at addr [a]"),a.u("\tbw [a]\tset write breakpoint at addr [a]"),a.u("\tbc [a]\tclear breakpoint at addr [a]"),a.u("\tbl\tlist all breakpoints"),a.u("\tbn [n]\tbreak after [n] instruction(s)");
else{var B=J.charAt(1);if("l"==B){var Aa=0,Aa=Aa+rd(a,a.i),Aa=Aa+rd(a,a.O);(Aa+=rd(a,a.C))||a.u("no breakpoints")}else if("n"==B)a.ca=Uc(a,E),a.u("break after "+a.ca+" instruction(s)");else if(void 0===E)a.u("missing breakpoint address");else{var O=V();if("*"!=E&&(O=X(a,E,!0),!O))break a;"c"==B?null==O.B?(Yc(a),a.u("all breakpoints cleared")):pd(a,a.i,O)||pd(a,a.O,O)||pd(a,a.C,O)||a.u("breakpoint missing: "+p(O.B,4)):null!=O.B&&(id(a,O,ga),"p"==B?a.xa(a.i,O):"r"==B?a.xa(a.O,O):"w"==B?a.xa(a.C,O):
a.u("unknown breakpoint command: "+B))}}}break;case "c":a.ya&&(a.ya.value="");break;case "d":a:{var Ba,Ca=f[0],Y=f[1],pa=f[2],re=f[3];if("?"==Y){var Z="";for(Ba in C)a.ja[Ba]&&(Z&&(Z+=","),Z+=Ba);Z+=",state,symbols";a.u("dump memory commands:");a.u("\tdb [a] [#]    dump # bytes at address a");a.u("\tdw [a] [#]    dump # words at address a");a.u("\tdd [a] [#]    dump # dwords at address a");a.u("\tdh [#] [#]    dump # instructions from history");Z.length&&a.u("dump extension commands:\n\t"+Z)}else if("state"==
Y){var td=Zd(a.D,!0);"console"==pa?console.log(td):(a.ya&&(a.ya.value=""),a.u(td))}else if("symbols"==Y)for(var nc=0;nc<a.G.length;nc++){var oc=a.G[nc],Da;for(Da in oc.qa)if("."!=Da.charAt(0)){var ud=oc.qa[Da].o;if(void 0!==ud){var vd=oc.qa[Da].l;vd&&(Da=vd);a.u(p(ud,4)+" "+Da)}}}else{if("d"==Ca){for(Ba in C)if(f[1]==Ba){var wd=a.ja[Ba];wd?(f.shift(),f.shift(),wd(f)):a.u("no dump registered for "+Y);break a}Y||(Ca=a.Ma||"db")}else a.Ma=Ca;if("dh"==Ca){var xd=Y,yd=pa,zd="",Ad=0,K=a.W,aa=a.M;if(aa.length){var P=
+xd||a.wa,Ea=+yd||10;isNaN(P)?P=Ea:zd="more ";P>aa.length&&(a.u("note: only "+aa.length+" available"),P=aa.length);K-=P;0>K&&(null==aa[aa.length-1].B?(P=K+P,K=0):K+=aa.length);var pc=[];"call"==yd&&(Ea=1E5,pc=["CALL"]);for(void 0!==xd&&a.u(P+" instructions earlier:");0<Ea&&K!=a.W;){var Bd=aa[K++];if(null==Bd.B)break;var cb=V(Bd.B),se=P--,Cd=Rd(a,cb,"history",se);(!pc.length||0<=Cd.indexOf(pc[0]))&&a.u(Cd);cb.Wa&&(K+=cb.Wa,Ea-=cb.Wa,P-=cb.Wa);K>=aa.length&&(K=0);a.wa=P;Ad++;Ea--}}Ad||(a.u("no "+zd+
"history available"),a.wa=void 0)}else{var Bb=X(a,Y);if(Bb){var Cb=0;pa&&("l"==pa.charAt(0)&&(pa=pa.substr(1)||re),Cb=Uc(a,pa)>>>0,65536<Cb&&(Cb=65536));for(var qa="",Db="dd"==Ca?4:"dw"==Ca?2:1,Eb=Db*Cb||128,te=Eb+15>>4||1;te--&&0<Eb;){var Fb=0,qc=0,db,eb="",rc="",Y=p(Bb.B,4);for(db=16;0<db&&0<Eb;db--){var Gb=a.ua(Bb,1),Fb=Fb|Gb<<(qc++<<3);qc==Db&&(eb+=p(Fb,2*Db),eb+=1==Db?9==db?"-":" ":"  ",Fb=qc=0);rc+=32<=Gb&&128>Gb?String.fromCharCode(Gb):".";Eb--}qa&&(qa+="\n");qa+=Y+"  "+eb+(0==db?" "+rc:"")}qa&&
a.u(qa);a.pa=Bb}}}}break;case "e":if("else"==f[0])break;var Hb=1,Dd=255,Ed=a.ua,Fd=a.gb;"ew"==f[0]&&(Hb=2,Dd=65535,Ed=a.Ua,Fd=a.Bb);var Gd=Hb<<1,Hd=f[1];if(null==Hd)a.u("edit memory commands:"),a.u("\teb [a] [...]  edit bytes at address a"),a.u("\tew [a] [...]  edit words at address a");else{var Ib=X(a,Hd);if(Ib)for(var Jb=2;Jb<f.length;Jb++){var fb=Sc(a,f[Jb]);if(void 0===fb){a.u("unrecognized value: "+f[Jb]);break}fb&~Dd&&a.u("warning: "+p(fb)+" exceeds "+Hb+"-byte value");var ue=Ed.call(a,Ib);
a.u("changing "+p(Ib.B,4)+" from "+p(ue,Gd,!0)+" to "+p(fb,Gd,!0));Fd.call(a,Ib,fb,Hb)}}break;case "f":Ud(a,f[1]);break;case "g":a:{var Id=f[1],ve=b;if(void 0!==Id){var sc=X(a,Id,!0);if(!sc)break a;id(a,sc,ve);a.xa(a.i,sc,!0)}a.Ca(!0)||d||a.u("cpu busy or unavailable, run command ignored")}break;case "h":a:{var tc;if(a.A.Z)tc="halting",a.ba();else{if(ob(a,!0))break a;tc="already halted"}d||a.u(tc)}break;case "i":if("if"==f[0]){var uc;var gb=b.substr(2),gb=oa(gb);Sc(a,gb)?(d||a.u("true: "+gb),uc=!0):
(d||a.u("false: "+gb),uc=!1);uc||(c=!1)}break;case "k":var we=f[0];if("?"==f[1])a.u("stack trace commands:"),a.u("\tk\tshow frame addresses"),a.u("\tks\tshow symbol information");else{var vc=0,Jd=V(),hb=V(a.b.g[6]);for(a.u("stack trace for "+p(hb.B,4));10>vc;){for(var ra=null,xe=256;65536>hb.B>>>0;){Jd.B=a.Ua(hb,2);if(null==hb.B||!xe--)break;for(var ye=a,Kb=Jd,Kd=null,ib=Kb.B,Ld=ib,wc=1;6>=wc&&ib;wc++){if(2<wc){Kb.B=ib;var Lb=Rd(ye,Kb);if(0<=Lb.indexOf("CALL")){var Md=Lb.indexOf(" ");if(ib+(Lb.indexOf(" ",
Md+1)-Md-1)/2==Ld){Kd=Lb;break}}}ib--}Kb.B=Ld;if(ra=Kd)break}if(!ra||null==ra)break;var Nd=null;if("ks"==we){var Od=ra.match(/[0-9A-F]+$/);Od&&(Nd=Wd(a,Od[0]))}ra=na(ra,50)+"  ;"+(Nd||"stack="+p(hb.B,4));a.u(ra);vc++}vc||a.u("no return addresses found")}break;case "l":if("ln"==f[0]){Wd(a,f[1],!0);break}break;case "m":a:{var ba,ca=null,x=f[1];"?"==x&&(x=void 0);if(void 0!==x){var ha=0;if("all"==x)ha=1878917119,x=null;else if("on"==x)ca=!0,x=null;else if("off"==x)ca=!1,x=null;else{"keys"==x&&(x="key");
"kbd"==x&&(x="keyboard");for(ba in C)if(x==ba){ha=C[ba];ca=!!(a.Y&ha);break}if(!ha){a.u("unknown message category: "+x);break a}}if(ha)if("on"==f[2])a.Y|=ha,ca=!0;else if("off"==f[2]&&(a.Y&=~ha,ca=!1,1073741824==ha)){for(var xc=0;xc<a.fa.length;xc++)a.u(a.fa[xc]);a.fa=[]}}var ze=0,ia="";for(ba in C)if(!x||x==ba){var Ae=!!(a.Y&C[ba]);if(null===ca||ca==Ae)ia&&(ia+=","),++ze%10||(ia+="\n\t"),"key"==ba&&(ba="keys"),ia+=ba}void 0===x&&a.u("message commands:\n\tm [category] [on|off]\tturn categories on/off");
a.u((null!==ca?ca?"messages on:  ":"messages off: ":"message categories:\n\t")+(ia||"none"));Zc(a)}break;case "p":if("print"==f[0]){Xd(a,b.substr(5));break}var Be="pr"==f[0]?1:0;if(a.U)a.u("step in progress");else{var Pd=V(a.b.g[7]);a.ua(Pd);a.U?(a.xa(a.i,Pd,!0),a.Ca()||(a.D&&a.D.Ra(),a.U=0)):Yd(a,Be?"tr":"t")}break;case "r":if("reset"==b){a.D&&a.D.reset();break}md(a,f);break;case "s":a:switch(f[1]){case "cs":var jb;void 0!==f[3]&&(jb=+f[3]);switch(f[2]){case "int":a.b.Fa=jb;break;case "start":a.b.Oa=
jb;break;case "stop":a.b.Ga=jb;break;default:a.u("unknown cs option");break a}void 0!==jb&&ec(a.b);a.u("checksums "+(a.b.A.Ea?"enabled":"disabled"));break;case "sp":void 0!==f[2]&&(jc(a.b,+f[2])||a.u("warning: using 1x multiplier, previous target not reached"));a.u("target speed: "+(a.b.Aa.toFixed(2)+"Mhz")+" ("+a.b.Ba+"x)");break;case "?":a.u("debugger options:");a.u("\tcs int #\tset checksum cycle interval to #");a.u("\tcs start #\tset checksum cycle start count to #");a.u("\tcs stop #\tset checksum cycle stop count to #");
a.u("\tsp #\t\tset speed multiplier to #");break;default:f[1]&&a.u("unknown option: "+f[1])}break;case "t":Yd(a,f[0],f[1]);break;case "u":nd(a,f[1],f[2],8);break;case "v":if("var"==f[0]){Vd(a,b.substr(3))||(c=!1);break}a.u("PDP11js version 1.30.0 ("+a.b.rb+",RELEASE"+(rb?",TYPEDARRAYS":",LONGARRAYS")+")");a.u(window?window.navigator.userAgent:"");break;case "?":if(f[1]){Xd(a,b.substr(1));break}var kb="commands:",yc;for(yc in ad)kb+="\n"+na(yc,9)+ad[yc];Hc(a)||(kb+="\nnote: frequency/history disabled if no exec breakpoints");
a.u(kb);break;default:a.u("unknown command: "+b),c=!1}}}catch(Qd){a.u("debugger error: "+(Qd.stack||Qd.message)),c=!1}return c}function fc(a,b,d){b=Qc(a,b,d);for(var c in b)if(!sd(a,b[c]))return!1;return!0}Pa(function(){for(var a=z(document,"pdp11","debugger"),b=0;b<a.length;b++){var d=a[b],c=w(d),c=new Xc(c);lb(c,d)}});
function $d(a,b,d){t.call(this,"Computer",a,$d,67108864);this.A.X=!1;ae(this,b);this.N=cc(this,"autoPower",a);this.w=0;this.U=a.busWidth||a.buswidth;this.i=be;this.L=null;this.G=this.S=!1;this.V=cc(this,"url")||"";(Math.random()+.1).toString(36);this.j=ce(this);if(this.b=bb("CPU",this.id)){this.F=bb("Debugger",this.id);this.H=new ub({id:this.pb+".bus",busWidth:this.U},this.b,this.F);var c,e=ab(this.id);if((this.D=bb("Panel",this.id))&&this.D.ya)for(b=0;b<e.length;b++)c=e[b],c.ea=this.D.ea,c.u=this.D.u,
c.ya=this.D.ya;this.u("PDP11js v1.30.0\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>");this.u("Portions adapted from the PDP-11/70 Emulator v1.3 by Paul Nankervis <paulnank@hotmail.com>");for(b=0;b<e.length;b++)c=e[b],c.za&&c.za(this,this.H,this.b,this.F);b=null;c=a.resume;void 0!==c&&(1<c.length?b=this.J=c:this.i=parseInt(c,10));var f;if(a=cc(this,"state")||(f=!0,a.state))b=this.O=a,f||(this.G=!0,this.i=be),this.i&&(this.M=
new G(this,"1.30.0"),de(this.M)?b=null:delete this.M);!b&&this.i&&(b=ee(this))&&(this.G=!0);if(b){var h=this;wa(b,null,!0,function(a,b,c){c?(h.J=null,h.G=!1,h.ea("Unable to load machine state from server (error "+c+(b?": "+oa(b):"")+")")):(h.L=b,h.S=!0);A(h)})}else A(this);this.K.power||(this.N=!0);!d&&this.N&&fe(this,this.Pa)}else r("Unable to find CPU component")}v($d);var be=0;
function ae(a,b){if(!b){var d;if("object"==typeof resources&&(d=resources.parms))try{b=eval("("+d+")")}catch(c){r(c.message+" ("+d+")")}}a.T=b}function cc(a,b,d){var c=b.toLowerCase(),c=Ua[b]||Ua[c];void 0===c&&a.T&&(c=a.T[b]);void 0===c&&d&&(c=d[b]);void 0===c&&"object"==typeof resources&&resources[b]&&(c=b);return c}function fe(a,b,d){for(var c=ab(a.id),e=0;e<=c.length;e++){var f=e<c.length?c[e]:a;if(!pb(f)){pb(f,function(){fe(a,b,d)});return}}b.call(a,d)}
function ge(a,b){var d=new G(a,"1.30.0","validate");if(de(d)&&he(d)){var c=ie(d,"timestamp"),e=b?ie(b,"timestamp"):"unknown";c!=e&&(a.ea("Machine state may be out-of-date\n("+c+" vs. "+e+")\nCheck your browser's local storage limits"),b||d.clear())}}m=$d.prototype;
m.Pa=function(a){void 0===a&&(a=this.i||(this.L?1:be));if(!this.w){this.w++;var b=!1,d=!1;this.R=!1;var c=this.M||new G(this,"1.30.0");if(-1==a)b=!0;else if(a>be){if(de(c,this.L)){this.C=new G(this,"1.30.0","failsafe");de(this.C)&&(je(this,c),a=2,ke(this.C));H(this.C,"timestamp",ua());le(this.C);var e=this.i&&!this.G;if(1==a||xa("Click OK to restore the previous PDP11js machine state, or CANCEL to reset the machine.")){if(d=he(c)){var f=ie(c,"code"),h=ie(c,"data");f&&("ok"==f?de(c,h):("error"==f&&
"no machine state"!=h?(this.ea("Error: "+h),"unable to verify user"==h&&(Ga("user",""),this.j=null)):this.u(f+": "+h),ke(c),de(c)?(d=he(c),e=!0):d=!1))}e&&ge(this,d?c:null)}else 2==a&&c.clear()}else ge(this);delete this.L;delete this.M}e=ab(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.b&&(d=me(this,h,c,b,d));b=[c,a,d];-1!=a?fe(this,this.lb,b):this.lb(b)}};
function me(a,b,d,c,e){if(!b.A.X){b.A.X=!0;if(b.sa){var f=null;e&&((f=ie(d,b.id))||(f=ie(d,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.sa(f,c)&&f&&(r("Unable to restore state for "+b.type),a.O&&!a.S?(d.clear(),a.i=be,window&&window.location.reload()):a.R=!0,b.sa(null),e=!1)}if(!c&&b.ob)for(a=b.ob.split("|"),d=0;d<a.length;d++)b.status(a[d])}return e}
m.lb=function(a){var b=a[0],d=0>a[1];a=a[2];this.W=!0;this.A.X=!0;var c=this.K.power;c&&(c.textContent="Shutdown");this.b&&(me(this,this.b,b,d,a),this.b.Ja());this.R&&(je(this,b),b.clear());!d&&this.C&&(this.C.clear(),delete this.C);this.w=0};
function je(a,b){if(xa("There may be a problem with your PDP11js machine.\n\nTo help us diagnose it, click OK to send this PDP11js machine state to http://www.pcjs.org.")){var d=a.j||"",c=b.toString(),e={app:"PDP11js",ver:"1.30.0"};e.url=a.V;e.user=d;e.type="bug";e.data=c;wa("http://www.pcjs.org/api/v1/report",e,!0)}}
function Zd(a,b,d){var c,e="none";if(a.w)return null;a.w--;var f=new G(a,"1.30.0"),h=new G(a,"1.30.0","validate"),g=ua();H(h,"timestamp",g);H(f,"timestamp",g);H(f,"version","1.30.0");H(f,"url",window?window.location.href:null);H(f,"browser",window?window.navigator.userAgent:"");a.b&&a.b.ra&&(d&&a.b.ba(),c=a.b.ra(b,d),"object"===typeof c&&H(f,a.b.id,c),d&&(a.b.A.X=!1,!1===c&&(e=null)));for(var g=ab(a.id),k=0;k<g.length;k++){var l=g[k];l.A.X&&(l.ra&&(c=l.ra(b,d),"object"===typeof c&&H(f,l.id,c)),d&&
(l.A.X=!1,!1===c&&(e=null)))}e&&(d?(g=c=!1,b?(a.j&&ne(a,a.j,f.toString()),le(h)&&le(f)||(e=null,c=g=!0)):a.i&&(c=!0,g=3==a.i),c&&f.clear(g)):e=f.toString());d&&(a.A.X=!1,b=a.K.power)&&(b.textContent="Power");a.w=0;return e}m.reset=function(){this.H&&this.H.reset&&(this.F&&mb(this,0)&&this.F.message("Resetting "+this.H.type,void 0),this.H.reset());for(var a=ab(this.id),b=0;b<a.length;b++){var d=a[b];d!==this&&d!==this.H&&d.reset&&(this.F&&mb(this,0)&&this.F.message("Resetting "+d.type,void 0),d.reset())}};
m.start=function(a,b){for(var d=ab(this.id),c=0;c<d.length;c++){var e=d[c];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};m.stop=function(a,b){for(var d=ab(this.id),c=0;c<d.length;c++){var e=d[c];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
m.ha=function(a,b,d){var c=this;switch(b){case "power":return this.K[b]=d,d.onclick=function(){c.w||(c.A.X?Zd(c,!1,!0):fe(c,c.Pa))},!0;case "reset":return this.K[b]=d,d.onclick=function(){if(c.A.X&&!c.w)if(c.i&&!c.J){var a=xa("Click OK to save changes to this PDP11js machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Zd(c,a,!0);!a&&c.O?window&&window.location.reload():c.Pa(be)}else c.reset(),c.b&&c.b.Ja()},!0;case "save":if(ja()){d.parentNode.removeChild(d);break}this.K[b]=
d;d.onclick=function(){var a=ce(c,!0);if(a){var b=!!(c.i&&!c.J||c.O),d=Zd(c,b);b?ne(c,a,d):c.ea("Resume disabled, machine state not saved")}};return!0}return!1};
function ce(a,b){var d=a.j;d||(d=Fa("user"),void 0!==d?!d&&b&&(d=null,window&&(d=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),d&&((d=oe(a,d))||a.ea("The user ID is invalid."))):b&&a.ea("Browser local storage is not available"));return d}
function oe(a,b){a.j=null;var d=wa(ka()+"/api/v1/user?req=verify&user="+b),c=d[1];if(!d[0]&&c)try{d=eval("("+c+")"),d.code&&"ok"==d.code&&(Ga("user",d.data),a.j=d.data)}catch(e){r(e.message+" ("+c+")")}return a.j}function ee(a){var b=null;a.j&&(b=ka()+"/api/v1/user?req=load&user="+a.j+"&state="+pe(a,"1.30.0"));return b}
function ne(a,b,d){if(d){var c={req:"store"};c.user=b;c.state=pe(a,"1.30.0");c.data=d;b=wa(ka()+"/api/v1/user",c);c=b[0];if(b[1]){if(c){var e=c.indexOf("\n");0<e&&(c=c.substr(0,e));c.indexOf("Error: ")||(c=c.substr(7))}c='{"code":'+b[1]+',"data":"'+c+'"}'}b=JSON.parse(c);b&&"ok"==b.code?a.ea("Machine state saved to server"):d&&(d=b&&b.data||"unable to save machine state",d="error"==b.code?"Error: "+d:"Error "+b.code+": "+d,a.ea(d),Ga("user",""),a.j=null)}}m.Ra=function(){};
m.ia=function(a){this.b&&this.b.ia(a);this.D&&this.D.ia(a)};Pa(function(){for(var a=z(document,"pdp11-machine"),b=0;b<a.length;b++)for(var d=a[b],c=w(d),d=z(d,"pdp11","computer"),e=0;e<d.length;e++){var f=d[e],h=w(f),h=new $d(h,c,!0);lb(h,f);h.N&&fe(h,h.Pa)}});Ka.show.push(function(){for(var a=z(document,"pdp11","computer"),b=0;b<a.length;b++){var d=w(a[b]);(d=bb("Computer",d.id))&&d.W&&!d.A.X&&d.Pa(-1)}});
Ka.exit.push(function(){for(var a=z(document,"pdp11","computer"),b=0;b<a.length;b++){var d=w(a[b]);(d=bb("Computer",d.id))&&d.A.X&&Zd(d,!(!d.i||d.J),!0)}});function G(a,b,d){this.id=a.id;this.key=pe(a,b,d);this.F=a.F;ke(this,a.Jb)}function pe(a,b,d){a=a.id;if(b){var c=b.indexOf(".");0<c&&(a+=".v"+b.substr(0,c))}d&&(a+="."+d);return a}
G.prototype={constructor:G,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){ke(this);var b=[];try{for(var d=0,c=window.localStorage.length;d<c;d++)b.push(window.localStorage.key(d))}catch(e){}for(d=0;d<b.length;d++)if((c=b[d])&&(a||c.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(c)}catch(e){}b.splice(d,1);d=0}}};
function ke(a,b){a[a.id]={};b&&H(a,"parms",b);a.b=!1}function le(a){var b=!0;if(za()){var d=JSON.stringify(a[a.id]);Ga(a.key,d)||(r("Unable to store "+d.length+" bytes in browser local storage"),b=!1)}return b}function he(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(d){r(d.message||d),b=!1}return b}function de(a,b){return b?(a[a.id]=b,a.b=!0):a.b?!0:za()&&(b=Fa(a.key))?(a[a.id]=b,a.b=!0):!1}function ie(a,b){return a[a.id][b]||null}function H(a,b,d){try{a[a.id][b]=d}catch(c){}}var qe=0;
function Ce(a,b,d,c,e,f){e("Loading "+a+"...");wa(a,null,!0,function(h,g,k){k?(g||(g="unable to load "+a+" ("+k+")"),f(g,null)):De(g,a,b,d,c,e,f)})}
function De(a,b,d,c,e,f,h){function g(a,f){if(f)h(f,null);else{if(d){$a(d,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);c?"}"==c.slice(-1)?(c=c.slice(0,-1),1<c.length&&(c+=",")):c='{state:"'+c+'",':c="{";c+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+d+"$2"+(c?" parms='"+c+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPNAME">).*?(<\/xsl:variable>)/,"$1PDP11js$2"),
a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pdp11$2"));g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(q){g=null,a=q.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?Ee(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function Ee(a,b,d){var c;if(c=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=c[2];b("Loading "+e+"...");wa(e,null,!0,function(f,h,g){if(g||!h)d(a,"unable to resolve XML reference: "+c[0]+" ("+g+")");else{if(f=c[3])if(g=h.match(new RegExp("<"+c[1]+"[^>]*>"))){for(var k=g[0],l,n=/( [a-z]+=)(['"])(.*?)\2/g;l=n.exec(f);)k=0>k.indexOf(l[1])?k.replace(">",l[0]+">"):k.replace(new RegExp(l[1]+"(['\"])(.*?)\\1"),l[0]);g[0]!=k&&(h=h.replace(g[0],k))}else{d(a,"missing <"+c[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(c[0],h);Ee(a,b,d)}})}else d(a,null)}
function Fe(a,b,d,c){function e(a){if(void 0===g){var b=h&&z(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=ma(a))}function f(a){e("Error: "+a);k&&(--qe||Ra(!0));k=!1}var h,g,k=!0;qe++;Za[a]={};try{if(h=document.getElementById(a)){var l;if("object"==typeof resources&&(l=resources.css)){var n=document.head||document.getElementsByTagName("head")[0],q=document.createElement("style");q.type="text/css";q.styleSheet?q.styleSheet.cssText=l:q.appendChild(document.createTextNode(l));n.appendChild(q)}d||
(d="/versions/pdp11/1.30.0/components.xsl");l=function(c,g){g?Ce(d,null,null,!1,e,function(c,k){if(k)if($a(a,d,c),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var l=g.transformNode(k);l?(h.outerHTML=l,--qe||Ra(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(l=new XSLTProcessor,l.importStylesheet(k),(l=l.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(l,h),--qe||Ra(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(c)}):f(c)};"<"!=b.charAt(0)?Ce(b,a,c,!0,e,l):De(b,null,a,c,!1,e,l)}else f("missing machine element: "+a)}catch(y){f(y.message)}return k}window.embedPDP11=function(a,b,d,c){Ra(!1);return Fe(a,b,d,c)};window.enableEvents=Ra;window.sendEvent=Sa;})();
