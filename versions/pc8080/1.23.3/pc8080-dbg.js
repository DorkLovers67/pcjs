(function(){var m;function aa(a,b){var c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var e,d=a,f=b;(f&&10!=f?16==f?null!==d.match(/^[0-9a-f]+$/i):2==f&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(e=parseInt(a,b))&&(c=e|0)}return c}
function n(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function t(a){return"0x"+n(a,4)}function ba(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function da(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function ea(a,b){return-1!==a.indexOf(b,a.length-b.length)}var ga={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ha(a){return a.replace(/[&<>"']/g,function(a){return ga[a]})}function ka(a,b){return(a+"                                        ").slice(0,b)}function la(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}
function ma(a,b,c){var d=0,e=a.length,f=0;for(void 0===c&&(c=function(a,b){return a>b?1:a<b?-1:0});d<e;){var h=d+e>>1,g;g=c(b,a[h]);0<g?d=h+1:(e=h,f=!g)}return f?d:~d}var na=Date.now||function(){return+new Date};function oa(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function pa(a,b){var c;if(Array.prototype.indexOf)return a.indexOf(b,c);c=c||0;0>c&&(c+=a.length);0>c&&(c=0);for(var d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1}
function qa(a,b,c,d){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return d&&d(a,f,e),[f,e];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),d&&d(a,f,e))});if(b&&"object"==
typeof b){var k="",l;for(l in b)b.hasOwnProperty(l)&&(k&&(k+="&"),k+=l+"="+encodeURIComponent(b[l]));k=k.replace(/%20/g,"+");g.open("POST",a,!!c);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(k)}else g.open("GET",a,!!c),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();c||(f=g.responseText,200!=g.status&&(e=g.status||-1),d&&d(a,f,e),h=[f,e]);return h}function ra(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function sa(){return window?window.navigator.userAgent:""}function v(a){window&&window.alert(a)}function ta(a){var b=!1;window&&(b=window.confirm(a));return b}var ua=null;function va(){if(null==ua){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}ua=a}return ua}
function wa(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}function xa(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function ya(a){if(window){var b=sa();return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}function za(a,b,c){function d(){--a;0<=a&&(b()||(a=0));0<a?setTimeout(d,0):c()}d()}
function Aa(a,b){function c(){b(100===d)&&(e=setTimeout(c,d),d=100)}var d=0,e=null,f=!1;a.onmousedown=function(){f||e||(d=500,c())};a.ontouchstart=function(){e||(d=500,c())};a.onmouseup=a.onmouseout=function(){e&&(clearTimeout(e),e=null)};a.ontouchend=a.ontouchcancel=function(){e&&(clearTimeout(e),e=null);f=!0}}var Ba={init:[],show:[],exit:[]},Ca=!1,Da=!0;function Ia(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function Ja(a){Ba.init.push(a)}
function Ka(a){if(Da)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){La("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks.",void 0,void 0)}}function Ma(a){!Da&&a?(Da=!0,Ca&&Na("init")):Da=a}function Na(a){Ba[a]&&Ka(Ba[a])}Ia("onload",function(){Ca=!0;Ka(Ba.init)});Ia("onpageshow",function(){Ka(Ba.show)});Ia(ya("Opera")||ya("iOS")?"onunload":"onbeforeunload",function(){Ka(Ba.exit)});
function w(a,b,c,d){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.wc=b.comment;this.Hc=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.Xb=this.id.substr(0,b),this.Lb=this.id.substr(b+1)):this.Lb=this.id;this[a]=c;this.D={Na:!1,jb:!1,Vb:!1,sa:!1,lb:!1};this.Ob=null;this.D.lb=!1;this.M={};this.H=null;this.qa=d||0;Oa.push(this)}var Pa=void 0,Sa={};
if(window){Pa||(Pa=window.location.search.substr(1));for(var Ta,Ua=/\+/g,Va=/([^&=]+)=?([^&]*)/g;Ta=Va.exec(Pa);)Sa[decodeURIComponent(Ta[1].replace(Ua," "))]=decodeURIComponent(Ta[2].replace(Ua," "))}function Wa(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function Za(a,b){b||(b=w);a.prototype=Wa(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var Oa=[],$a={};function ab(a,b,c){$a[a]&&b&&($a[a][b]=c)}function La(a,b,c){b||v((c?c+": ":"")+a)}function bb(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<Oa.length;b++){var d=Oa[b];a&&d.id.indexOf(a)||c.push(d)}return c}
function cb(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<Oa.length;d++)if(c)c==Oa[d]&&(c=null);else if(!(a!=Oa[d].type||b&&Oa[d].id.indexOf(b)))return Oa[d]}return null}function y(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){v(c.message+" ("+a+")")}return b}function db(a,b){var c,d=eb;b&&(void 0===c&&(c="Panel"),(c=cb(c,a.id))&&(c=c.M[b])&&a.ma(null,d,c))}
function fb(a,b){for(var c=B(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var e=c[d].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var k=g.split(" "),l=0;l<k.length;l++)switch(g=k[l],g){case "pc8080-binding":(g=y(h))&&g.binding&&a.ma(g.type,g.binding,h,g.value),l=k.length}}}}
function B(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
w.prototype={constructor:w,parent:null,toString:function(){return this.name?this.name:this.id||this.type},ma:function(a,b,c){switch(b){case "clear":return this.M[b]||(this.M[b]=c,c.onclick=function(a){return function(){a.M.print&&(a.M.print.value="")}}(this)),!0;case "print":return this.M[b]||(this.Ga=this.M[b]=c,c.value="",this.g=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.ja=function(a){this.g(a,this.Lb)}),!0;default:return!1}},log:function(){},g:function(){},status:function(a){this.g(this.Lb+": "+a)},ja:function(a,b,c){La(a,b,c||this.type)},Ea:function(){return this.D.sa=!0},Ia:function(a,b){b&&(this.D.sa=!1);return!0}};function D(a,b,c,d,e,f,h){a.H&&(!0===h?h=0:null==h&&(h=a.qa),gb(a.H,a,b,c,d,e,f,h))}function hb(a,b){a.H&&ib(a,0)&&a.H.message(b,void 0)}function ib(a,b){if(a.H){a===a.H?b|=0:b=b||a.qa;var c=a.H.qa&b;return!!b&&c===b||!!(c&a.H.ud)}return!1}
function jb(a,b){if(a.D.Vb)return a.D.jb&&(a.D.jb=!1),a.D.Vb=!1;if(a.D.lb)return a.g(a.toString()+" error"),!1;a.D.jb=b;return a.D.jb}function kb(a,b){a.D.jb&&(b?a.D.Vb=!0:void 0===b&&a.g(a.toString()+" busy"));return a.D.jb}function E(a){if(!a.D.lb&&(a.D.Na=!0,a.D.Na)){var b=a.Ob;a.Ob=null;b&&b()}}function lb(a,b){b&&(a.D.Na?b():a.Ob=b);return a.D.Na}function ob(a,b){a.D.lb=!0;a.ja(b)}
var pb="undefined"!==typeof ArrayBuffer,qb=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function rb(a){w.call(this,"Panel",a,rb)}Za(rb);m=rb.prototype;m.ma=function(a,b,c,d){return this.A&&this.A.ma(a,b,c,d)||this.b&&this.b.ma(a,b,c,d)||this.J&&this.J.ma(a,b,c,d)||this.H&&this.H.ma(a,b,c,d)?!0:this.parent.ma.call(this,a,b,c,d)};m.Qa=function(a,b,c,d){this.A=a;this.w=b;this.b=c;this.H=d;this.J=sb(a,"Keyboard")};m.Ea=function(a,b){b||tb();return!0};m.Ia=function(){return!0};m.Ja=function(){};
function tb(){for(var a=!1,b=B(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],e=y(d),f;a:{f=e.id;if(void 0!==f)for(var h=void 0,h=0;h<Oa.length;h++)if(Oa[h].id===f){f=Oa[h];break a}f=null}f||(a=!0,f=new rb(e));fb(f,d);a&&E(f)}}Ja(tb);
function ub(a,b,c){w.call(this,"Bus",a,ub);this.b=b;this.H=c;this.J=a.busWidth||16;this.N=Math.pow(2,this.J);this.B=this.N-1|0;this.pa=16>=this.J?10:20>=this.J?12:24>=this.J?14:15;this.Ha=1<<this.pa;this.O=this.Ha>>2;this.w=this.Ha-1;this.L=this.N/this.Ha|0;this.K=this.L-1;this.A=[];this.u=[];this.I=this.F=!1;this.P=[];this.Z=[];a=new F;vb(a,this.H);this.X=Array(this.L);for(b=0;b<this.L;b++)this.X[b]=a;E(this)}Za(ub);m=ub.prototype;m.reset=function(){};m.Ea=function(a,b){b||this.reset();return!0};
function wb(a,b,c,d){for(var e=b,f=c,h=e>>>a.pa;0<f&&h<a.X.length;){var g=a.X[h],k=h*a.Ha,l=a.Ha-(e-k);l>f&&(l=f);if(g&&g.size){if(g.type==d){if(e+f<=g.G)return g.Hb+=g.G-e,g.G=e,!0;if(e>=g.G+g.Hb){l=g.size-(e-k);l>f&&(l=f);g.Hb=e-g.G+l;e=k+a.Ha;f-=l;h++;continue}}return xb(1,e,f)}e=new F(e,l,a.Ha,d);vb(e,a.H,g);a.X[h++]=e;e=k+a.Ha;f-=l}return 0>=f?(a.status(Math.floor(c/1024)+"Kb "+yb[d]+" at "+t(b)),!0):xb(2,b,c)}m.aa=function(a){return this.X[(a&this.B)>>>this.pa].sb(a&this.w,a)};
function zb(a,b){return a.X[(b&a.B)>>>a.pa].Gb(b&a.w,b)}m.Sa=function(a){var b=a&this.w,c=(a&this.B)>>>this.pa;return b!=this.w?this.X[c].Kc(b,a):this.X[c++].sb(b,a)|this.X[c&this.K].sb(0,a+1)<<8};function Ab(a,b){var c=b&a.w,d=(b&a.B)>>>a.pa;return c!=a.w?a.X[d].dc(c,b):a.X[d++].Gb(c,b)|a.X[d&a.K].Gb(0,b+1)<<8}m.ra=function(a,b){this.X[(a&this.B)>>>this.pa].ub(a&this.w,b&255,a)};function Bb(a,b,c){a.X[(b&a.B)>>>a.pa].Ib(b&a.w,c&255,b)}
m.Tb=function(a,b){var c=a&this.w,d=(a&this.B)>>>this.pa;c!=this.w?this.X[d].Mc(c,b&65535,a):(this.X[d++].ub(c,b&255,a),this.X[d&this.K].ub(0,b>>8&255,a+1))};function Cb(a,b){if(void 0===b)return a.I=!a.I,a.I;void 0===a.A[b]&&(a.A[b]=[null,!1]);a.A[b][1]=!a.A[b][1];return a.A[b][1]}function Db(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,h=+e+d,g=c[e].bind(b);if(void 0!==g)for(var k=+e+d;k<=h;k++)void 0!==f.A[k]?v("Input port "+t(k)+" already registered"):f.A[k]=[g,!1]}}
function Eb(a,b,c){for(var d=1,e=0,f=0;0<d;){var h=a.A[b],g=a.P[b]||1,k=1==g?255:2==g?65535:-1,l=k;void 0!==h?(h[0]&&(l=h[0](b,c),void 0===l?l=k:l&=k),a.H&&a.I!=h[1]&&Fb(a.H,b,l)):a.H&&(gb(a.H,a,b,null,c),a.I&&Fb(a.H,b,l));e|=l<<f;f+=g<<3;b+=g;d-=g}return e}function Gb(a,b){if(void 0===b)return a.F=!a.F,a.F;void 0===a.u[b]&&(a.u[b]=[null,!1]);a.u[b][1]=!a.u[b][1];return a.u[b][1]}
function Hb(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,h=+e+d,g=c[e].bind(b);if(void 0!==g)for(var k=+e+d;k<=h;k++)void 0!==f.u[k]?v("Output port "+t(k)+" already registered"):f.u[k]=[g,!1]}}function Ib(a,b,c,d){for(var e=1,f=0;0<e;){var h=a.u[b],g=a.Z[b]||1,k=1==g?255:2==g?65535:-1,k=(c>>>=f)&k;if(void 0!==h){if(h[0])h[0](b,k,d);a.H&&a.F!=h[1]&&Jb(a.H,b,k)}else a.H&&(gb(a.H,a,b,k,d),a.F&&Jb(a.H,b,k));f+=g<<3;b+=g;e-=g}}
function xb(a,b,c){v("Memory block error ("+a+": "+n(b)+","+n(c)+")");return!1}var Sb;if(pb){var Tb=new ArrayBuffer(2);(new DataView(Tb)).setUint16(0,256,!0);Sb=256===(new Uint16Array(Tb))[0]}else Sb=!1;var Ub=Sb;
function F(a,b,c,d){this.id=Vb+=2;this.b=null;this.G=a;this.Hb=b;this.size=c||0;this.type=d||Wb;this.A=d==Xb;vb(this);this.Oa=this.tc=!1;if(c)if(pb)this.I=new ArrayBuffer(c),this.F=new DataView(this.I,0,c),this.w=new Uint8Array(this.I,0,c),this.K=new Uint16Array(this.I,0,c>>1),this.b=new Int32Array(this.I,0,c>>2),Yb(this,Ub?Zb:$b);else{this.b=Array(c>>2);for(a=0;a<this.b.length;a++)this.b[a]=0;Yb(this,ac)}else Yb(this)}var Wb=0,Xb=2,yb=["NONE","RAM","ROM","VID","H/W"],Vb=0;
F.prototype={constructor:F,parent:null,save:function(){var a,b;if(pb)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.F.getInt32(b<<2,!0);else a=this.b;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(pb)for(b=0;b<a.length;b++)this.F.setInt32(b<<2,a[b],!0);else this.b=a;return this.Oa=!0}return!1},Ya:function(a,b){b?0===this.u++&&bc(this,cc,!1):0===this.M++&&dc(this,cc,!1)},L:function(){this.H&&ib(this.H,129)&&this.H.message("attempt to read invalid block %"+n(this.G),!0);
return 255},B:function(a,b){this.H&&ib(this.H,129)&&this.H.message("attempt to write "+t(b)+" to invalid block %"+n(this.G),!0)},N:function(a,b){return this.sb(a++,b++)|this.sb(a,b)<<8},J:function(a,b,c){this.ub(a++,b&255,c++);this.ub(a,b>>8,c)},ca:function(a){return this.b[a>>2]>>>((a&3)<<3)&255},ha:function(a){var b=a>>2;a=(a&3)<<3;var c=this.b[b]>>a;return 24>a?c&65535:c&255|(this.b[b+1]&255)<<8},ya:function(a,b){var c=a>>2,d=(a&3)<<3;this.b[c]=this.b[c]&~(255<<d)|b<<d;this.Oa=!0},Fa:function(a,
b){var c=a>>2,d=(a&3)<<3;24>d?this.b[c]=this.b[c]&~(65535<<d)|b<<d:(this.b[c]=this.b[c]&16777215|b<<24,c++,this.b[c]=this.b[c]&-256|b>>8);this.Oa=!0},P:function(a,b){if(this.H&&null!=this.G){var c=this.H;ec(c,this.G+a,1,c.P)&&c.na(!0)}return this.Gb(a,b)},ea:function(a,b){if(this.H&&null!=this.G){var c=this.H;ec(c,this.G+a,2,c.P)&&c.na(!0)}return this.dc(a,b)},va:function(a,b,c){if(this.H&&null!=this.G){var d=this.H;ec(d,this.G+a,1,d.F)&&d.na(!0)}this.A?this.B(a,b,c):this.Ib(a,b,c)},Ca:function(a,
b,c){if(this.H&&null!=this.G){var d=this.H;ec(d,this.G+a,2,d.F)&&d.na(!0)}this.A?this.B(a,b,c):this.fc(a,b,c)},O:function(a){return this.w[a]},Z:function(a){return this.w[a]},da:function(a){return this.F.getUint16(a,!0)},ga:function(a){return a&1?this.w[a]|this.w[a+1]<<8:this.K[a>>1]},ia:function(a,b){this.w[a]=b;this.Oa=!0},wa:function(a,b){this.w[a]=b;this.Oa=!0},za:function(a,b){this.F.setUint16(a,b,!0);this.Oa=!0},Da:function(a,b){a&1?(this.w[a]=b,this.w[a+1]=b>>8):this.K[a>>1]=b;this.Oa=!0}};
function vb(a,b,c){a.H=b;a.M=a.u=0;c&&((a.M=c.M)&&dc(a,cc,!1),(a.u=c.u)&&bc(a,cc,!1))}function fc(a,b){b?0===--a.u&&(a.ub=a.A?a.B:a.Ib,a.Mc=a.A?a.J:a.fc):0===--a.M&&(a.sb=a.Gb,a.Kc=a.dc)}function bc(a,b,c){c&&a.u||(a.ub=!a.A&&b[2]||a.B,a.Mc=!a.A&&b[3]||a.J);if(c||void 0===c)a.Ib=b[2]||a.B,a.fc=b[3]||a.J}function dc(a,b,c){c&&a.M||(a.sb=b[0]||a.L,a.Kc=b[1]||a.N);if(c||void 0===c)a.Gb=b[0]||a.L,a.dc=b[1]||a.N}function Yb(a,b){b||(b=gc);dc(a,b,void 0);bc(a,b,void 0)}
var gc=[],ac=[F.prototype.ca,F.prototype.ha,F.prototype.ya,F.prototype.Fa],cc=[F.prototype.P,F.prototype.ea,F.prototype.va,F.prototype.Ca];if(pb)var $b=[F.prototype.O,F.prototype.da,F.prototype.ia,F.prototype.za],Zb=[F.prototype.Z,F.prototype.ga,F.prototype.wa,F.prototype.Da];
function hc(a,b){w.call(this,"CPU",a,hc,1);var c=a.cycles||b,d=a.multiplier||1;this.i={};this.i.rb=c;this.i.Qb=0;this.i.cb=d;this.i.$b=Math.round(this.i.rb/1E4)/100;this.i.ab=this.i.$b*this.i.cb;this.D.xa=!1;this.D.Wb=!1;this.D.sc=a.autoStart;this.D.uc=!1;this.D.kb=!1;this.i.Ab=this.i.ob=0;this.i.Bb=a.csStart;this.i.nb=a.csInterval;this.i.pb=a.csStop;this.Z=this.eb.bind(this);E(this)}Za(hc);var ic=["power","reset"];m=hc.prototype;
m.Qa=function(a,b,c,d){this.A=a;this.w=b;this.H=d;for(b=0;b<ic.length;b++)(c=this.M[ic[b]])&&this.A.ma(null,ic[b],c);this.L=(b=sb(a,"Video"))&&Math.max(b.Xd,b.zb)||60;this.I=sb(a,"ChipSet");a=jc(a,"autoStart");null!=a&&(this.D.sc="true"==a?!0:"false"==a?!1:!!a);E(this)};m.reset=function(){this.i.Qb=0};m.save=function(){return null};m.restore=function(){return!1};
m.Ea=function(a,b){if(!b){if(a&&this.restore){kc(this);if(!this.restore(a))return!1;lc(this)}else this.reset();if(this.H){var c=this.H;c.g("Type ? for help with PC8080 Debugger commands");c.Ja();if(c.Da){var d=c.Da;c.Da=null;mc(c,d)}}else this.g("No debugger detected")}nc(this);return!0};m.Ia=function(a){return a?this.save():!0};function Ac(a){(a.D.sc||!a.H&&void 0===a.M.run)&&a.eb(!0)}m.vc=function(){return 0};
function lc(a){void 0===a.i.Bb&&(a.i.Bb=0);void 0===a.i.nb&&(a.i.nb=-1);void 0===a.i.pb&&(a.i.pb=-1);a.D.kb=0<=a.i.Bb&&0<a.i.nb;a.D.kb&&(a.i.Ab=0,a.i.ob=a.i.Bb-a.J)}function Bc(a,b){if(a.D.kb){var c=!1;a.i.Ab=a.i.Ab+a.vc()|0;a.i.ob-=b;0>=a.i.ob&&(a.i.ob+=a.i.nb,c=!0);0<=a.i.pb&&a.i.pb<=Cc(a)&&(a.i.nb=a.i.pb=-1,lc(a),a.na(),c=!0);c&&a.g(Cc(a)+" cycles: checksum="+n(a.i.Ab))}}
m.ma=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.M[b]=c;a=!0;break;case "run":this.M[b]=c;c.onclick=function(){var a;if(a=d.A)if(a=d.A,a.D.sa)a=!0;else{var b=null,c,g=bb(a.id);for(c=0;c<g.length&&(b=g[c],b===a||b.D.Na);c++);if(c==g.length)for(c=0;c<g.length&&(b=g[c],b===a||b.D.sa);c++);c==g.length&&(b=a);v("The "+b.type+" component ("+b.id+") is not "+(b.D.Na?"powered yet":"ready yet"+(b.Ob?" (waiting for notification)":""))+".");a=!1}a&&(d.D.xa?d.na(!0):d.eb(!0))};a=
!0;break;case "speed":this.M[b]=c;a=!0;break;case "setSpeed":this.M[b]=c,c.onclick=function(){Dc(d,d.i.cb<<1,!0)},c.textContent=this.i.ab.toFixed(2)+"Mhz",a=!0}return a};function Ec(a,b,c){a.J+=b;c&&(a.B=a.b=0)}
function Fc(a,b){var c=30;c<a.L&&(c=a.L);2>c&&(c=2);var d=1;b&&1<a.i.cb&&a.i.$a&&(d=a.i.$a/a.i.$b);a.i.Bc=Math.round(1E3/30);a.i.Fd=Math.floor(a.i.rb/c*d);a.i.bc=Math.floor(a.i.rb/30*d);a.i.Dc=Math.floor(a.i.rb/a.L*d);a.i.Cc=Math.floor(a.i.rb/2*d);b||(a.i.qb=a.i.bc,a.i.Db=a.i.Dc,a.i.Cb=a.i.Cc);a.i.cc=0}function Cc(a){return a.J+a.F+a.B-a.b}function kc(a){a.i.$a=0;a.J=a.F=a.B=a.b=0;lc(a);Dc(a,1)}
function Dc(a,b,c){var d=!1;if(void 0!==b){.8>a.i.$a/a.i.ab?b=1:d=!0;a.i.cb=b;b=a.i.$b*a.i.cb;if(a.i.ab!=b){a.i.ab=b;b=a.i.ab.toFixed(2)+"Mhz";var e=a.M.setSpeed;e&&(e.textContent=b);a.g("target speed: "+b)}c&&a.A&&a.A.fb()}Ec(a,a.F);a.F=0;a.i.mb=na();a.i.bb=0;Fc(a);return d}
m.eb=function(a){if(jb(this,!0)){if(!this.D.xa){Dc(this);this.A&&this.A.start(this.i.mb,Cc(this));this.D.xa=!0;this.D.Wb=!0;this.I&&this.I.start();var b=this.M.run;b&&(b.textContent="Halt");this.A&&(this.A.Ja(!0),a&&this.A.fb(!0))}this.i.cc>=this.i.rb&&Fc(this,!0);this.i.Eb=0;this.i.Pb=na();this.i.bb&&(a=this.i.Pb-this.i.bb,a>this.i.Bc&&(this.i.mb+=a,this.i.mb>this.i.Pb&&(this.i.mb=this.i.Pb)));try{do{this.tb(this.D.kb?1:this.i.Fd);var c=this.B-this.b;this.F+=c;this.i.Eb+=c;Ec(this,0,!0);Bc(this,
c);this.i.Db-=c;0>=this.i.Db&&(this.i.Db+=this.i.Dc,this.A&&Gc(this.A,this.i.Qb++),this.i.Qb>this.L&&(this.i.Qb=0));this.i.Cb-=c;0>=this.i.Cb&&(this.i.Cb+=this.i.Cc,this.A&&this.A.Ja());this.i.qb-=c;if(0>=this.i.qb){this.i.qb+=this.i.bc;break}}while(this.D.xa)}catch(e){this.na();nc(this);this.A&&this.A.stop(na(),Cc(this));jb(this,!1);ob(this,e.stack||e.message);return}c=setTimeout;a=this.Z;this.i.bb=na();b=this.i.Bc;this.i.Eb&&(b=Math.round(b*this.i.Eb/this.i.bc));var b=b-(this.i.bb-this.i.Pb),d=
this.i.bb-this.i.mb;d&&(this.i.$a=Math.round(this.F/(10*d))/100,864E5<=d&&(this.J=0,Dc(this)));if(0>b||this.i.$a<this.i.ab)b=0;this.i.cc+=this.i.Eb;this.i.bb+=b;c(a,b)}else nc(this),this.A&&this.A.stop(na(),Cc(this))};m.tb=function(){return 0};m.na=function(a){kb(this,!0);this.B-=this.b;this.b=0;Ec(this,this.F);this.F=0;if(this.D.xa){this.D.xa=!1;this.I&&this.I.stop();var b=this.M.run;b&&(b.textContent="Run")}this.D.Nb=a};function nc(a,b){a.A&&(Gc(a.A,-1),a.A.Ja(b))}
function Hc(a){this.Ac=+a.model||8080;hc.call(this,a,1E6);this.N=Ic;kc(this);this.D.Nb=this.D.vd=!1;this.P=0;this.K=[];this.O=0;Jc(this)}Za(Hc,hc);function Kc(a,b){a.K.push(b)}m=Hc.prototype;m.reset=function(){this.D.xa&&this.na();Jc(this);kc(this);this.D.lb=!1;this.parent.reset.call(this)};function Jc(a){a.j=0;a.S=0;a.T=0;a.U=0;a.V=0;a.W=0;a.Y=0;a.la=0;G(a,a.O);Lc(a,0);a.u=0}function Mc(a,b){a.O=b;G(a,b)}
m.vc=function(){var a=this.j+this.S+this.T+this.U+this.V+this.W+this.Y|0;return a=a+this.la+this.R+Nc(this)|0};
m.save=function(){var a=new H(this);I(a,0,[this.j,this.S,this.T,this.U,this.V,this.W,this.Y,this.la,this.R,Nc(this)]);I(a,1,[this.u,this.J,this.i.cb]);for(var b=this.w,c=0,d=[],e=0;e<b.L;e++){var f=b.X[e];if(f.Oa||f.tc){d[c++]=e;var h=c++;a:if(f=f.save()){for(var g=0,k=0,l=[];g<f.length;){for(var q=f[g],p=g+1;p<f.length&&f[p]===q;)p++;l[k++]=p-g;l[k++]=q;g=p}if(l.length<f.length){f=l;break a}}d[h]=f}}I(a,2,d);return a.data()};
m.restore=function(a){var b=a[0];this.j=b[0];this.S=b[1];this.T=b[2];this.U=b[3];this.V=b[4];this.W=b[5];this.Y=b[6];this.la=b[7]&65535;G(this,b[8]);Lc(this,b[9]);b=a[1];this.u=b[0];this.J=b[1];Dc(this,b[3]);a:{b=this.w;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.O){for(var f=0,h=Array(b.O),g=0;g<e.length-1;)for(var k=e[g++],l=e[g++];k--;)h[f++]=l;e=h}f=b.X[d];if(!f||!f.restore(e)){v("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
m.ma=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.M[b]=c;this.P++;d=!0;break;default:d=this.parent.ma.call(this,a,b,c)}return d};function Oc(a){return a.S<<8|a.T}function Pc(a,b){a.S=b>>8&255;a.T=b&255}function Qc(a){return a.U<<8|a.V}function Rc(a,b){a.U=b>>8&255;a.V=b&255}function J(a){return a.W<<8|a.Y}
function Sc(a,b){a.W=b>>8&255;a.Y=b&255}function G(a,b){a.R=b&65535}function Tc(a){return a.ba&256?1:0}function Uc(a,b){a.ba=a.ba&255|b}function Vc(a){return qb[a.fa&255]?4:0}function Wc(a){return(a.fa^a.ua)&16?16:0}function Xc(a){return a.ba&255?0:64}function Yc(a){return a.fa&128?128:0}function Nc(a){return a.ta&-214|Yc(a)|Xc(a)|Wc(a)|Vc(a)|Tc(a)}function Lc(a,b){a.ba=a.fa=a.ua=0;b&1&&(a.ba|=256);b&4||(a.fa|=1);b&16&&(a.ua|=16);b&64||(a.ba|=255);b&128&&(a.fa^=192);a.ta=a.ta&-726|b&512|2}
function Zc(a,b){a.ua=a.j^b;return a.fa=(a.ba=a.j+b)&255}function $c(a,b){a.ua=a.j^b;return a.fa=(a.ba=a.j+b+(a.ba&256?1:0))&255}function ad(a,b){a.ba=a.fa=a.ua=a.j&b;(a.j|b)&8&&(a.ua^=16);return a.ba}function bd(a,b){a.ua=b^255;b=a.fa=b+255&255;a.ba=a.ba&-256|b;return b}function cd(a,b){a.ua=b;b=a.fa=b+1&255;a.ba=a.ba&-256|b;return b}function dd(a,b){return a.fa=a.ba=a.ua=a.j|b}function L(a,b){b^=255;a.ua=a.j^b;return a.fa=(a.ba=a.j+b+1^256)&255}
function ed(a,b){b^=255;a.ua=a.j^b;return a.fa=(a.ba=a.j+b+(a.ba&256?0:1)^256)&255}function fd(a,b){return a.fa=a.ba=a.ua=a.j^b}m.aa=function(a){return this.w.aa(a)};m.ra=function(a,b){this.w.ra(a,b)};function M(a){var b=a.aa(a.R);G(a,a.R+1);return b}function N(a){var b=a.w.Sa(a.R);G(a,a.R+2);return b}function P(a){var b=a.w.Sa(a.la);a.la=a.la+2&65535;return b}function Q(a,b){a.la=a.la-2&65535;a.w.Tb(a.la,b)}function zd(a,b){a.u=a.u&-8|b|8}
function S(a,b,c,d){d=d||2;a.M[b]&&(void 0===c&&(ob(a,"Value for "+b+" is invalid"),a.na()),c=!a.D.xa||a.D.uc?n(c,d):"--------".substr(0,d),a.M[b].textContent!=c&&(a.M[b].textContent=c))}
m.Ja=function(a){this.P&&(a||!this.D.xa||this.D.uc)&&(S(this,"A",this.j),S(this,"B",this.S),S(this,"C",this.T),S(this,"BC",Oc(this),4),S(this,"D",this.U),S(this,"E",this.V),S(this,"DE",Qc(this),4),S(this,"H",this.W),S(this,"L",this.Y),S(this,"HL",J(this),4),S(this,"SP",this.la,4),S(this,"PC",this.R,4),a=Nc(this),S(this,"PS",a,4),S(this,"IF",a&512?1:0,1),S(this,"SF",a&128?1:0,1),S(this,"ZF",a&64?1:0,1),S(this,"AF",a&16?1:0,1),S(this,"PF",a&4?1:0,1),S(this,"CF",a&1?1:0,1));if(a=this.M.speed)a.textContent=
this.D.xa&&this.i.$a?this.i.$a.toFixed(2)+"Mhz":"Stopped"};m.tb=function(a){this.D.Nb=!0;var b=this.D.vd=this.H&&Ad(this.H),c=a?this.D.Wb?0:1:-1;this.D.Wb=!1;this.B=this.b=a;do{if(this.u){if(a&&this.u&8&&this.ta&512){var d=199|(this.u&7)<<3;this.u&=-17;this.u&=-16;this.ta&=-513;this.N[d].call(this)}if(this.u&16){this.b=0;break}}if(b){if(Bd(this.H,this.R,c)){this.na();break}c=1}this.N[M(this)].call(this)}while(0<this.b);return this.D.Nb?this.B-this.b:void 0===this.D.Nb?0:-1};
Ja(function(){for(var a=B(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Hc(d);fb(d,c)}});function Cd(){this.b-=4}function Dd(){G(this,N(this));this.b-=10}function Ed(){G(this,P(this));this.b-=10}function Fd(){var a=N(this);Q(this,this.R);G(this,a);this.b-=17}
var Ic=[Cd,function(){Pc(this,N(this));this.b-=10},function(){this.ra(Oc(this),this.j);this.b-=7},function(){Pc(this,Oc(this)+1);this.b-=5},function(){this.S=cd(this,this.S);this.b-=5},function(){this.S=bd(this,this.S);this.b-=5},function(){this.S=M(this);this.b-=7},function(){var a=this.j<<1;this.j=a&255|a>>8;Uc(this,a&256);this.b-=4},Cd,function(){var a;Sc(this,a=J(this)+Oc(this));Uc(this,a>>8&256);this.b-=10},function(){this.j=this.aa(Oc(this));this.b-=7},function(){Pc(this,Oc(this)-1);this.b-=
5},function(){this.T=cd(this,this.T);this.b-=5},function(){this.T=bd(this,this.T);this.b-=5},function(){this.T=M(this);this.b-=7},function(){var a=this.j<<8&256;this.j=(a|this.j)>>1;Uc(this,a);this.b-=4},Cd,function(){Rc(this,N(this));this.b-=10},function(){this.ra(Qc(this),this.j);this.b-=7},function(){Rc(this,Qc(this)+1);this.b-=5},function(){this.U=cd(this,this.U);this.b-=5},function(){this.U=bd(this,this.U);this.b-=5},function(){this.U=M(this);this.b-=7},function(){var a=this.j<<1;this.j=a&255|
Tc(this);Uc(this,a&256);this.b-=4},Cd,function(){var a;Sc(this,a=J(this)+Qc(this));Uc(this,a>>8&256);this.b-=10},function(){this.j=this.aa(Qc(this));this.b-=7},function(){Rc(this,Qc(this)-1);this.b-=5},function(){this.V=cd(this,this.V);this.b-=5},function(){this.V=bd(this,this.V);this.b-=5},function(){this.V=M(this);this.b-=7},function(){var a=this.j<<8;this.j=(Tc(this)<<8|this.j)>>1;Uc(this,a&256);this.b-=4},Cd,function(){Sc(this,N(this));this.b-=10},function(){var a=N(this);this.w.Tb(a,J(this));
this.b-=16},function(){Sc(this,J(this)+1);this.b-=5},function(){this.W=cd(this,this.W);this.b-=5},function(){this.W=bd(this,this.W);this.b-=5},function(){this.W=M(this);this.b-=7},function(){var a=0,b=Tc(this);if(Wc(this)||9<(this.j&15))a|=6;if(b||154<=this.j)a|=96,b=1;this.j=Zc(this,a);Uc(this,b?256:0);this.b-=4},Cd,function(){var a;Sc(this,a=J(this)+J(this));Uc(this,a>>8&256);this.b-=10},function(){var a;a=N(this);a=this.w.Sa(a);Sc(this,a);this.b-=16},function(){Sc(this,J(this)-1);this.b-=5},function(){this.Y=
cd(this,this.Y);this.b-=5},function(){this.Y=bd(this,this.Y);this.b-=5},function(){this.Y=M(this);this.b-=7},function(){this.j=~this.j&255;this.b-=4},Cd,function(){this.la=N(this)&65535;this.b-=10},function(){this.ra(N(this),this.j);this.b-=13},function(){this.la=this.la+1&65535;this.b-=5},function(){var a=J(this);this.ra(a,cd(this,this.aa(a)));this.b-=10},function(){var a=J(this);this.ra(a,bd(this,this.aa(a)));this.b-=10},function(){this.ra(J(this),M(this));this.b-=10},function(){this.ba|=256;this.b-=
4},Cd,function(){var a;Sc(this,a=J(this)+this.la);Uc(this,a>>8&256);this.b-=10},function(){this.j=this.aa(N(this));this.b-=13},function(){this.la=this.la-1&65535;this.b-=5},function(){this.j=cd(this,this.j);this.b-=5},function(){this.j=bd(this,this.j);this.b-=5},function(){this.j=M(this);this.b-=7},function(){Uc(this,Tc(this)?0:256);this.b-=4},function(){this.b-=5},function(){this.S=this.T;this.b-=5},function(){this.S=this.U;this.b-=5},function(){this.S=this.V;this.b-=5},function(){this.S=this.W;
this.b-=5},function(){this.S=this.Y;this.b-=5},function(){this.S=this.aa(J(this));this.b-=7},function(){this.S=this.j;this.b-=5},function(){this.T=this.S;this.b-=5},function(){this.b-=5},function(){this.T=this.U;this.b-=5},function(){this.T=this.V;this.b-=5},function(){this.T=this.W;this.b-=5},function(){this.T=this.Y;this.b-=5},function(){this.T=this.aa(J(this));this.b-=7},function(){this.T=this.j;this.b-=5},function(){this.U=this.S;this.b-=5},function(){this.U=this.T;this.b-=5},function(){this.b-=
5},function(){this.U=this.V;this.b-=5},function(){this.U=this.W;this.b-=5},function(){this.U=this.Y;this.b-=5},function(){this.U=this.aa(J(this));this.b-=7},function(){this.U=this.j;this.b-=5},function(){this.V=this.S;this.b-=5},function(){this.V=this.T;this.b-=5},function(){this.V=this.U;this.b-=5},function(){this.b-=5},function(){this.V=this.W;this.b-=5},function(){this.V=this.Y;this.b-=5},function(){this.V=this.aa(J(this));this.b-=7},function(){this.V=this.j;this.b-=5},function(){this.W=this.S;
this.b-=5},function(){this.W=this.T;this.b-=5},function(){this.W=this.U;this.b-=5},function(){this.W=this.V;this.b-=5},function(){this.b-=5},function(){this.W=this.Y;this.b-=5},function(){this.W=this.aa(J(this));this.b-=7},function(){this.W=this.j;this.b-=5},function(){this.Y=this.S;this.b-=5},function(){this.Y=this.T;this.b-=5},function(){this.Y=this.U;this.b-=5},function(){this.Y=this.V;this.b-=5},function(){this.Y=this.W;this.b-=5},function(){this.b-=5},function(){this.Y=this.aa(J(this));this.b-=
7},function(){this.Y=this.j;this.b-=5},function(){this.ra(J(this),this.S);this.b-=7},function(){this.ra(J(this),this.T);this.b-=7},function(){this.ra(J(this),this.U);this.b-=7},function(){this.ra(J(this),this.V);this.b-=7},function(){this.ra(J(this),this.W);this.b-=7},function(){this.ra(J(this),this.Y);this.b-=7},function(){var a=this.R-1;if(this.K.length)for(var b=0;b<this.K.length;b++)if(this.K[b](a))return;this.u|=16;this.b-=7;this.H&&ib(this,-2147483648)?(G(this,a),this.H.na()):this.ta&512||(this.H&&
G(this,a),this.na())},function(){this.ra(J(this),this.j);this.b-=7},function(){this.j=this.S;this.b-=5},function(){this.j=this.T;this.b-=5},function(){this.j=this.U;this.b-=5},function(){this.j=this.V;this.b-=5},function(){this.j=this.W;this.b-=5},function(){this.j=this.Y;this.b-=5},function(){this.j=this.aa(J(this));this.b-=7},function(){this.b-=5},function(){this.j=Zc(this,this.S);this.b-=4},function(){this.j=Zc(this,this.T);this.b-=4},function(){this.j=Zc(this,this.U);this.b-=4},function(){this.j=
Zc(this,this.V);this.b-=4},function(){this.j=Zc(this,this.W);this.b-=4},function(){this.j=Zc(this,this.Y);this.b-=4},function(){this.j=Zc(this,this.aa(J(this)));this.b-=7},function(){this.j=Zc(this,this.j);this.b-=4},function(){this.j=$c(this,this.S);this.b-=4},function(){this.j=$c(this,this.T);this.b-=4},function(){this.j=$c(this,this.U);this.b-=4},function(){this.j=$c(this,this.V);this.b-=4},function(){this.j=$c(this,this.W);this.b-=4},function(){this.j=$c(this,this.Y);this.b-=4},function(){this.j=
$c(this,this.aa(J(this)));this.b-=7},function(){this.j=$c(this,this.j);this.b-=4},function(){this.j=L(this,this.S);this.b-=4},function(){this.j=L(this,this.T);this.b-=4},function(){this.j=L(this,this.U);this.b-=4},function(){this.j=L(this,this.V);this.b-=4},function(){this.j=L(this,this.W);this.b-=4},function(){this.j=L(this,this.Y);this.b-=4},function(){this.j=L(this,this.aa(J(this)));this.b-=7},function(){this.j=L(this,this.j);this.b-=4},function(){this.j=ed(this,this.S);this.b-=4},function(){this.j=
ed(this,this.T);this.b-=4},function(){this.j=ed(this,this.U);this.b-=4},function(){this.j=ed(this,this.V);this.b-=4},function(){this.j=ed(this,this.W);this.b-=4},function(){this.j=ed(this,this.Y);this.b-=4},function(){this.j=ed(this,this.aa(J(this)));this.b-=7},function(){this.j=ed(this,this.j);this.b-=4},function(){this.j=ad(this,this.S);this.b-=4},function(){this.j=ad(this,this.T);this.b-=4},function(){this.j=ad(this,this.U);this.b-=4},function(){this.j=ad(this,this.V);this.b-=4},function(){this.j=
ad(this,this.W);this.b-=4},function(){this.j=ad(this,this.Y);this.b-=4},function(){this.j=ad(this,this.aa(J(this)));this.b-=7},function(){this.j=ad(this,this.j);this.b-=4},function(){this.j=fd(this,this.S);this.b-=4},function(){this.j=fd(this,this.T);this.b-=4},function(){this.j=fd(this,this.U);this.b-=4},function(){this.j=fd(this,this.V);this.b-=4},function(){this.j=fd(this,this.W);this.b-=4},function(){this.j=fd(this,this.Y);this.b-=4},function(){this.j=fd(this,this.aa(J(this)));this.b-=7},function(){this.j=
fd(this,this.j);this.b-=4},function(){this.j=dd(this,this.S);this.b-=4},function(){this.j=dd(this,this.T);this.b-=4},function(){this.j=dd(this,this.U);this.b-=4},function(){this.j=dd(this,this.V);this.b-=4},function(){this.j=dd(this,this.W);this.b-=4},function(){this.j=dd(this,this.Y);this.b-=4},function(){this.j=dd(this,this.aa(J(this)));this.b-=7},function(){this.j=dd(this,this.j);this.b-=4},function(){L(this,this.S);this.b-=4},function(){L(this,this.T);this.b-=4},function(){L(this,this.U);this.b-=
4},function(){L(this,this.V);this.b-=4},function(){L(this,this.W);this.b-=4},function(){L(this,this.Y);this.b-=4},function(){L(this,this.aa(J(this)));this.b-=7},function(){L(this,this.j);this.b-=4},function(){Xc(this)||(G(this,P(this)),this.b-=6);this.b-=5},function(){Pc(this,P(this));this.b-=10},function(){var a=N(this);Xc(this)||G(this,a);this.b-=10},Dd,function(){var a=N(this);Xc(this)||(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},function(){Q(this,Oc(this));this.b-=11},function(){this.j=Zc(this,
M(this));this.b-=7},function(){Q(this,this.R);G(this,0);this.b-=11},function(){Xc(this)&&(G(this,P(this)),this.b-=6);this.b-=5},Ed,function(){var a=N(this);Xc(this)&&G(this,a);this.b-=10},Dd,function(){var a=N(this);Xc(this)&&(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},Fd,function(){this.j=$c(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,8);this.b-=11},function(){Tc(this)||(G(this,P(this)),this.b-=6);this.b-=5},function(){Rc(this,P(this));this.b-=10},function(){var a=N(this);Tc(this)||
G(this,a);this.b-=10},function(){var a=M(this);Ib(this.w,a,this.j,this.R+-2&65535);this.b-=10},function(){var a=N(this);Tc(this)||(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},function(){Q(this,Qc(this));this.b-=11},function(){this.j=L(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,16);this.b-=11},function(){Tc(this)&&(G(this,P(this)),this.b-=6);this.b-=5},Ed,function(){var a=N(this);Tc(this)&&G(this,a);this.b-=10},function(){var a=M(this);this.j=Eb(this.w,a,this.R+-2&65535)&255;this.b-=
10},function(){var a=N(this);Tc(this)&&(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},Fd,function(){this.j=ed(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,24);this.b-=11},function(){Vc(this)||(G(this,P(this)),this.b-=6);this.b-=5},function(){Sc(this,P(this));this.b-=10},function(){var a=N(this);Vc(this)||G(this,a);this.b-=10},function(){var a=P(this);Q(this,J(this));Sc(this,a);this.b-=18},function(){var a=N(this);Vc(this)||(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},function(){Q(this,
J(this));this.b-=11},function(){this.j=ad(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,32);this.b-=11},function(){Vc(this)&&(G(this,P(this)),this.b-=6);this.b-=5},function(){G(this,J(this));this.b-=5},function(){var a=N(this);Vc(this)&&G(this,a);this.b-=10},function(){var a=J(this);Sc(this,Qc(this));Rc(this,a);this.b-=5},function(){var a=N(this);Vc(this)&&(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},Fd,function(){this.j=fd(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,
40);this.b-=11},function(){Yc(this)||(G(this,P(this)),this.b-=6);this.b-=5},function(){var a=P(this);Lc(this,a&255|this.ta&-256);this.j=a>>8;this.b-=10},function(){var a=N(this);Yc(this)||G(this,a);this.b-=10},function(){this.ta&=-513;this.b-=4},function(){var a=N(this);Yc(this)||(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},function(){Q(this,Nc(this)&255|this.j<<8);this.b-=11},function(){this.j=dd(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,48);this.b-=11},function(){Yc(this)&&(G(this,
P(this)),this.b-=6);this.b-=5},function(){this.la=J(this)&65535;this.b-=5},function(){var a=N(this);Yc(this)&&G(this,a);this.b-=10},function(){this.ta|=512;this.b-=4},function(){var a=N(this);Yc(this)&&(Q(this,this.R),G(this,a),this.b-=6);this.b-=11},Fd,function(){L(this,M(this));this.b-=7},function(){Q(this,this.R);G(this,56);this.b-=11}];
function T(a){w.call(this,"ChipSet",a,T,32768);var b=a.model;b&&!Gd[b]&&La("Unrecognized ChipSet model: "+b);this.B=Gd[b]||{};a.sound&&(this.ha=null,window&&(this.ha=window.AudioContext||window.webkitAudioContext),this.ha&&new this.ha);E(this)}Za(T);
var U={Aa:1978.1,qd:{Ba:0,ce:1,ge:16,ne:32,we:64,ve:128,vb:14},Wa:{Ba:1,Rc:1,kd:2,fd:4,gd:16,hd:32,jd:64,vb:8},rd:{Ba:2,be:3,Ee:4,de:8,re:16,se:32,te:64,ee:128,vb:0},Ae:{Ba:3},ye:{Ba:2,oe:7},Ce:{Ba:3,Fe:1,Be:2,ue:4,le:8,fe:16,Zd:32},ze:{Ba:4},De:{Ba:5,he:1,ie:2,je:4,ke:8,Ge:16}},V={Aa:100,Ka:{Ba:66,pc:1,lc:2,ed:4,qe:8,pe:16,nc:32,mc:64,ic:128},Qc:{Ba:66,INIT:0},Ua:{Ba:194,ae:0,hc:16,ld:32,oc:48,Vc:0,Wc:32},Jb:{Ba:162,xe:0,Yc:0,Uc:0,Xc:0,Tc:0},La:{me:{Ba:98},Ta:{Oc:0,Nc:1,nd:2,sd:4,Sc:5,md:6,od:7},
Kb:16383}},Gd={SI1978:U,VT100:V};T.prototype.ma=function(){return!1};T.prototype.Qa=function(a,b,c,d){this.w=b;this.b=c;this.H=d;this.A=a;this.J=sb(a,"Keyboard");this.Fa=sb(a,"SerialPort");this.video=sb(a,"Video");Db(b,this,this.B.Rb);Hb(b,this,this.B.Sb)};T.prototype.Ea=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};T.prototype.Ia=function(a){return a?this.save():!0};U.INIT=[[U.qd.vb,U.Wa.vb,U.rd.vb,0,0,0,0]];
V.INIT=[[V.Qc.INIT,V.Ka.lc|V.Ka.ed],[V.Ua.Vc,V.Ua.Wc],[V.Jb.Yc,V.Jb.Uc,V.Jb.Xc,V.Jb.Tc],[0,0,0,0,[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11856,11824,11840,11808,11776,12E3,12E3,11857,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]];
m=T.prototype;m.reset=function(){this.B.INIT&&!this.restore(this.B.INIT)&&this.ja("reset error")};m.save=function(){var a=new H(this);switch(this.B.Aa){case U.Aa:I(a,0,[this.Ca,this.F,this.Da,this.ca,this.ga,this.ya,this.za]);break;case V.Aa:I(a,0,[this.ia,this.K]),I(a,1,[this.N,this.O]),I(a,2,[this.I,this.da,this.wa,this.va]),I(a,3,[this.Z,this.u,this.P,this.ea,this.L])}return a.data()};
m.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.B.Aa){case U.Aa:return this.Ca=b[0],this.F=b[1],this.Da=b[2],this.ca=b[3],this.ga=b[4],this.ya=b[5],this.za=b[6],!0;case V.Aa:return this.ia=b[0],this.K=b[1],b=a[1],this.N=b[0],this.O=b[1],b=a[2],this.I=b[0],this.da=b[1],this.wa=b[2],this.va=b[3],b=a[3],this.Z=b[0],this.u=b[1],this.P=b[2],this.ea=b[3],this.L=b[4],!0}return!1};m.start=function(){};m.stop=function(){};m.zd=function(a,b){var c=this.Ca;D(this,a,null,b,"STATUS0",c,!0);return c};
m.Ad=function(a,b){var c=this.F;D(this,a,null,b,"STATUS1",c,!0);return c};m.Bd=function(a,b){var c=this.Da;D(this,a,null,b,"STATUS2",c,!0);return c};m.yd=function(a,b){var c=this.ca>>8-this.ga&255;D(this,a,null,b,"SHIFT.RESULT",c,!0);return c};m.Jd=function(a,b,c){D(this,a,b,c,"SHIFT.COUNT",null,!0);this.ga=b};m.Ld=function(a,b,c){D(this,a,b,c,"SOUND1",null,!0);this.ya=b};m.Kd=function(a,b,c){D(this,a,b,c,"SHIFT.DATA",null,!0);this.ca=b<<8|this.ca>>8};
m.Md=function(a,b,c){D(this,a,b,c,"SOUND2",null,!0);this.za=b};m.Nd=function(a,b,c){D(this,a,b,c,"WATCHDOG",null,!0)};function Hd(a){var b=0,c=0,d=~a.Z;for(a=0;10>a;a++)d&1&&(b=9-a),d>>=1;for(a=0;10>a;a++)d&1&&(c=9-a),d>>=1;return 10*b+c}
m.Cd=function(a,b){var c=this.K,c=c&~V.Ka.mc;if((Cc(this.b)&64)<<1&&(c|=V.Ka.mc,c!=this.K)){var d,e;d=this.P&1;e=this.P>>1&7;switch(e){case V.La.Ta.od:break;case V.La.Ta.Nc:this.Z=this.Z<<1|d;break;case V.La.Ta.Sc:d=Hd(this);this.L[d]=V.La.Kb;hb(this,"doNVRCommand(): erase data at addr "+t(d));break;case V.La.Ta.Oc:this.u=this.u<<1|d;break;case V.La.Ta.sd:d=Hd(this);e=this.u&V.La.Kb;this.L[d]=e;hb(this,"doNVRCommand(): write data "+t(e)+" to addr "+t(d));break;case V.La.Ta.md:d=Hd(this);e=this.L[d];
null==e&&(e=V.La.Kb);this.u=e;hb(this,"doNVRCommand():  read data "+t(e)+" from addr "+t(d));break;case V.La.Ta.nd:this.u<<=1;this.ea=this.u&V.La.Kb+1;break;default:hb(this,"doNVRCommand(): unrecognized command 0x"+n(e,2))}}c&=~V.Ka.nc;this.ea&&(c|=V.Ka.nc);c&=~V.Ka.ic;this.J&&this.J.Zb()&&(c|=V.Ka.ic);c&=~V.Ka.pc;this.Fa&&this.Fa.Zb()&&(c|=V.Ka.pc);this.K=c;D(this,a,null,b,"FLAGS",c);return c};m.Od=function(a,b,c){D(this,a,b,c,"BRIGHTNESS");this.ia=b};
m.Rd=function(a,b,c){D(this,a,b,c,"NVR.LATCH");this.P=b};m.Qd=function(a,b,c){D(this,a,b,c,"DC012");a=b&3;switch(b>>2&3){case 0:this.I=this.I&-4|a;break;case 1:this.I=this.I&-13|a<<2;this.video&&(b=this.video,a=this.I,hb(b,"updateScrollOffset("+a+")"),b.gb!==a&&(b.gb=a,Id(b,-1)));break;case 2:switch(a){case 0:this.da=~this.da;break;case 2:case 3:this.wa=3-a}break;case 3:this.va=a}};
m.Pd=function(a,b,c){D(this,a,b,c,"DC011");b&V.Ua.ld?(b&=V.Ua.oc,this.O!=b&&(this.O=b,this.video&&(a=this.video,b=this.O==V.Ua.oc?50:60,hb(a,"updateRate("+b+")"),a.Yb=b))):(b&=V.Ua.hc,this.N!=b&&(this.N=b,this.video&&(a=this.N==V.Ua.hc?132:80,b=this.video,hb(b,"updateDimensions("+a+","+(80<a&&this.K&V.Ka.lc?14:24)+")"),b.ea=a,b.oa=b.xc,80<a&&b.oa--,Jd(b)&&Kd(b))))};U.Rb={0:T.prototype.zd,1:T.prototype.Ad,2:T.prototype.Bd,3:T.prototype.yd};
U.Sb={2:T.prototype.Jd,3:T.prototype.Ld,4:T.prototype.Kd,5:T.prototype.Md,6:T.prototype.Nd};V.Rb={66:T.prototype.Cd};V.Sb={66:T.prototype.Od,98:T.prototype.Rd,162:T.prototype.Qd,194:T.prototype.Pd};Ja(function(){for(var a=B(document,"pc8080","chipset"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new T(d);fb(d,c)}});
function Ld(a){w.call(this,"ROM",a,Ld);this.A=null;this.F=a.addr;this.u=a.size;this.J=a.writable;this.B=a.alias;this.I=a.file;this.K=ba(this.I);if(this.I){a=this.I;var b=da(this.K);"json"!=b&&"hex"!=b&&(a=ra()+"/api/v1/dump?file="+this.I+"&format=bytes&decimal=true");var c=this;qa(a,null,!0,function(a,b,f){Md(c,a,b,f)})}}Za(Ld);var Nd=[0,5];Ld.prototype.Qa=function(a,b,c,d){this.w=b;this.b=c;this.H=d;Od(this)};
Ld.prototype.Ea=function(){if(this.Ra){if(this.H){var a=this.H,b=this.id,c=this.F,d=this.u,e=this.Ra,f=[],h;for(h in e){var g=e[h];"number"==typeof g&&(e[h]=g={o:g});var k=g.o,l=g.a;if(void 0!==k){var q=f,k=[k>>>0,h],p=ma(q,k,a.Xa);0>p&&q.splice(-(p+1),0,k)}l&&(g.a=l.replace(/''/g,'"'))}a.J.push({He:b,G:c,Ed:d,Ra:e,qc:f})}delete this.Ra}return!0};Ld.prototype.Ia=function(){return!0};
function Md(a,b,c,d){if(d)a.ja("Unable to load system ROM (error "+d+": "+b+")");else{ab(a.Xb,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,h=e.data;if(f)a.A=f;else if(h)for(a.A=Array(4*h.length),d=c=0;c<h.length;c++)a.A[d++]=h[c]&255,a.A[d++]=h[c]>>8&255,a.A[d++]=h[c]>>16&255,a.A[d++]=h[c]>>24&255;else a.A=e;a.Ra=e.symbols;if(!a.A.length){v("Empty ROM: "+b);return}if(1==a.A.length){v(a.A[0]);return}}catch(g){a.ja("ROM data error: "+g.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.A=Array(b.length),e=0;e<b.length;e++)a.A[e]=aa(b[e],16);Od(a)}}
function Od(a){if(!lb(a))if(!a.I)E(a);else if(a.A&&a.w){a.u||(a.u=a.A.length);if(a.A.length!=a.u)ob(a,"ROM size (0x"+n(a.A.length)+") does not match specified size ("+("0x"+n(a.u))+")");else if(Pd(a,a.F)){var b=[];"number"==typeof a.B?b.push(a.B):null!=a.B&&a.B.length&&(b=a.B);for(var c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.w,h=d.u,g=[],k=d.F>>>f.pa;0<h&&k<f.X.length;)g.push(f.X[k++]),h-=f.Ha;f=d.w;d=d.u;h=0;for(e>>>=f.pa;0<d&&e<f.X.length;){k=g[h++];if(!k)break;f.X[e++]=k;d-=f.Ha}}delete a.A}E(a)}}
function Pd(a,b){if(wb(a.w,b,a.u,a.J?1:Xb)){var c;for(c=0;c<a.A.length;c++)Bb(a.w,b+c,a.A[c]);if(a.J&&256==b){for(c=0;c<Nd.length;c++)Bb(a.w,Nd[c],118);Kc(a.b,function(a){return function(b){if(0<=Nd.indexOf(b)){var c=!1,h=a.b,g=a.H;if(5==b)switch(c=!0,h.T){case 2:Qd(a,String.fromCharCode(h.V));break;case 9:for(var k=Qc(h),l="",q=255;q--;){var p=a.b.aa(k++);if(36==p)break;l+=String.fromCharCode(p)}Qd(a,l);break;default:c=!1}c?Ed.call(h):g&&(a.g("\nCP/M vector "+t(b)),G(h,b),g.na());b=!0}else b=!1;
return b}}(a));Mc(a.b,b)}return!0}return!1}function Qd(a,b){b=b.replace(/\r/g,"");a.Ga&&(a.Ga.value+=b,a.Ga.scrollTop=a.Ga.scrollHeight)}Ja(function(){for(var a=B(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Ld(d);fb(d,c)}});function Rd(a){w.call(this,"RAM",a,Rd);this.B=a.addr;this.u=a.size;this.A=!1}Za(Rd);m=Rd.prototype;m.Qa=function(a,b,c,d){this.w=b;this.b=c;this.H=d;E(this)};m.Ea=function(a,b){b||this.reset();return!0};m.Ia=function(a){return a?this.save():!0};
m.reset=function(){!this.A&&this.u&&wb(this.w,this.B,this.u,1)&&(this.A=!0);this.A||v("No RAM allocated")};m.save=function(){return null};m.restore=function(){return!0};Ja(function(){for(var a=B(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Rd(d);fb(d,c)}});function Sd(a){w.call(this,"Keyboard",a,Sd,65536);(a=a.model)&&!Td[a]&&La("Unrecognized Keyboard model: "+a);this.w=Td[a]||{};this.reset();E(this)}Za(Sd);
var Ud={Aa:1978.1,C:{},gc:{65:37,68:39,76:32},wb:{},Va:{"1p":49,"2p":50,coin:51,left:37,right:39,fire:32}},W={Aa:100,C:{},gc:{},wb:{},Va:{setup:120},Pc:{Ba:130,INIT:127},Ma:{Ba:130,cd:1,bd:2,ad:4,$c:8,dd:16,kc:32,jc:63,pd:64,$d:128,INIT:0},Zc:127};W.C[46]=3;W.C[80]=5;W.C[79]=6;W.C[89]=7;W.C[84]=8;W.C[87]=9;W.C[81]=10;W.C[39]=16;W.C[221]=20;W.C[219]=21;W.C[73]=22;W.C[85]=23;W.C[82]=24;W.C[69]=25;W.C[49]=26;W.C[37]=32;W.C[40]=34;W.C[117]=35;W.C[19]=35;W.C[192]=36;W.C[189]=37;W.C[57]=38;W.C[55]=39;
W.C[52]=40;W.C[51]=41;W.C[27]=42;W.C[38]=48;W.C[114]=49;W.C[112]=50;W.C[8]=51;W.C[187]=52;W.C[48]=53;W.C[56]=54;W.C[54]=55;W.C[53]=56;W.C[50]=57;W.C[9]=58;W.C[103]=64;W.C[115]=65;W.C[113]=66;W.C[96]=67;W.C[118]=68;W.C[220]=69;W.C[76]=70;W.C[75]=71;W.C[71]=72;W.C[70]=73;W.C[65]=74;W.C[104]=80;W.C[2013]=81;W.C[98]=82;W.C[97]=83;W.C[222]=85;W.C[186]=86;W.C[74]=87;W.C[72]=88;W.C[68]=89;W.C[83]=90;W.C[110]=96;W.C[116]=97;W.C[101]=98;W.C[100]=99;W.C[13]=100;W.C[190]=101;W.C[188]=102;W.C[78]=103;
W.C[66]=104;W.C[88]=105;W.C[119]=106;W.C[105]=112;W.C[99]=113;W.C[102]=114;W.C[109]=115;W.C[191]=117;W.C[77]=118;W.C[32]=119;W.C[86]=120;W.C[67]=121;W.C[90]=122;W.C[120]=123;W.C[17]=124;W.C[16]=125;W.C[20]=126;W.wb={l4:W.Ma.cd,l3:W.Ma.bd,l2:W.Ma.ad,l1:W.Ma.$c,locked:W.Ma.dd,local:W.Ma.kc,online:~W.Ma.kc};var Td={SI1978:Ud,VT100:W};
Sd.prototype.ma=function(a,b,c){var d=this,e=a+"-"+b;if(void 0===this.M[e]){if("led"==a&&this.w.wb[b])return this.M[e]=c,!0;switch(b){case "kbd":return c.onkeydown=function(a){return Vd(d,a,!0)},c.onkeyup=function(a){return Vd(d,a,!1)},!0;default:if(this.w.Va&&void 0!==this.w.Va[b])return this.M[e]=c,a=function(a,b){return function(){Wd(a,b,!0)}}(this,this.w.Va[b]),b=function(a,b){return function(){Wd(a,b,!1);a.A&&a.A.fb()}}(this,this.w.Va[b]),"ontouchstart"in window?(c.ontouchstart=a,c.ontouchend=
b):(c.onmousedown=a,c.onmouseup=c.onmouseout=b),!0}}return!1};Sd.prototype.Qa=function(a,b,c,d){this.A=a;this.b=c;this.H=d;this.I=sb(a,"ChipSet");Db(b,this,this.w.Rb);Hb(b,this,this.w.Sb)};Sd.prototype.Ea=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};Sd.prototype.Ia=function(a){return a?this.save():!0};W.INIT=[[W.Ma.INIT,W.Pc.INIT,-1]];m=Sd.prototype;m.reset=function(){this.u=[];this.w.INIT&&!this.restore(this.w.INIT)&&this.ja("reset error")};
m.save=function(){var a=new H(this);switch(this.w.Aa){case W.Aa:I(a,0,[this.J,this.F,-1])}return a.data()};m.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.w.Aa){case Ud.Aa:return!0;case W.Aa:return this.J=b[0],Xd(this,this.J&W.Ma.jc),this.F=b[1],this.B=b[2],!0}return!1};function Xd(a,b){for(var c in a.w.wb){var d=a.M["led-"+c];if(d){var e=a.w.wb[c],f=!!(b&e);e&e-1&&(f=!(b&~e));d.style.backgroundColor=f?"#ff0000":"#000000"}}}
function Vd(a,b,c){var d=!0,e;a:if(e=b.keyCode,e=a.w.gc[e]||e,!a.w.C[e]){for(var f in a.w.Va)if(a.w.Va[f]===e){e=f;break a}e=null}e&&(d=Wd(a,e,c),b.preventDefault());return d}
function Wd(a,b,c){var d;a:{for(d=0;d<a.u.length;d++)if(a.u[d].ec==b)break a;d=-1}if(c)0>d?a.u.push({ec:b,ac:Date.now(),Mb:!1}):(a.u[d].ac=Date.now(),a.u[d].Mb=!1);else if(0<=d){if(!a.u[d].Mb){var e=a.u[d].ac;if(e&&100>Date.now()-e)return a.u[d].Mb=!0,Yd(a),!0}a.u.splice(d,1)}if(a.I){d=0;switch(b){case "1p":d=U.Wa.fd;break;case "2p":d=U.Wa.kd;break;case "coin":d=U.Wa.Rc;break;case "left":d=U.Wa.hd;break;case "right":d=U.Wa.jd;break;case "fire":d=U.Wa.gd}d&&(a=a.I,b=d,a.F&=~b,c&&(a.F|=b))}return!0}
function Yd(a){for(var b=0,c=-1;b<a.u.length;){if(a.u[b].Mb){var d=a.u[b].ec,e=100-(Date.now()-a.u[b].ac);if(0<e){if(0>c||c>e)c=e}else{Wd(a,d,!1);b=0;continue}}b++}0<=c&&setTimeout(function(){Yd(a)},c)}m.Zb=function(){return!0};m.Dd=function(a,b){var c=this.F;0<=this.B&&(this.B<this.u.length?(c=this.u[this.B],this.B++,c=W.C[c.ec],c&128&&(c&=127)):(this.B=-1,c=W.Zc),this.F=c,zd(this.b,1));D(this,a,null,b,"KBDUART.ADDRESS",c);return c};
m.Sd=function(a,b,c){D(this,a,b,c,"KBDUART.STATUS");this.J=b;Xd(this,b&W.Ma.jc);b&W.Ma.pd&&(this.B=0,zd(this.b,1))};W.Rb={130:Sd.prototype.Dd};W.Sb={130:Sd.prototype.Sd};Ja(function(){for(var a=B(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new Sd(d);fb(d,c)}});
function Zd(a,b,c,d,e){var f=this;this.Fc=ya("Gecko/");var h=["","moz","ms","webkit"];w.call(this,"Video",a,Zd,262144);this.ca=a.screenWidth;this.P=a.screenHeight;this.ya=a.bufferAddr;this.Vd=a.bufferRAM;var g=a.bufferFormat;this.ga=g&&$d[g.toUpperCase()]||ae;this.ea=a.bufferCols;this.ha=a.bufferRows;this.xc=this.oa=a.cellWidth||1;this.ka=a.cellHeight||1;this.Fa=null;this.Ec=!1;this.Za=a.bufferBits||1;this.Wd=a.bufferLeft||0;if(this.B=a.bufferRotate)this.B=this.B%360,0<this.B&&(this.B-=360),-90!=
this.B&&(this.ja("unsupported buffer rotation: "+this.B),this.B=0);this.zb=a.interruptRate;this.Xd=a.refreshRate||60;this.O=b;this.I=c;this.Ca=(this.Yd=d)||b||null;this.Td=this.ca;this.Ud=this.P;this.yc=this.ca/this.ea|0;this.zc=this.P/this.ha|0;1<this.ka&&(this.ha++,this.gb=0);b=a.smoothing;(c=Sa.smoothing)&&(b="true"==c);if(null!=b)for(c=0;c<h.length;c++)if(d=(d=h[c])?d+"ImageSmoothingEnabled":"imageSmoothingEnabled",void 0!==this.I[d]){this.I[d]=b;break}if(this.F=a.screenRotate)this.F=this.F%360,
0<this.F&&(this.F-=360),-90!=this.F?(this.ja("unsupported screen rotation: "+this.F),this.F=0):(this.I.translate(0,this.P),this.I.rotate(this.F*Math.PI/180),this.I.scale(this.P/this.ca,this.ca/this.P));if(this.u=e)if(this.u.ib=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen,this.u.ib){for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenchange","on"+d in document){document.addEventListener(d,function(){be(f,document.fullscreenElement||document.msFullscreenElement||
document.mozFullScreenElement||document.webkitFullscreenElement?!0:!1)},!1);break}for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenerror","on"+d in document){document.addEventListener(d,function(){be(f,null)},!1);break}}if(this.ia=a.fontROM)"json"!=da(this.ia)&&(this.ia=ra()+"/api/v1/dump?file="+this.ia+"&format=bytes"),qa(this.ia,null,!0,function(a,b,c){ce(f,a,b,c)});this.yb={}}Za(Zd);var ae=0,$d={SI1978:1,VT100:2};
function Jd(a){a.L=a.ea*a.oa;a.da=a.ha*a.ka;var b=a.L,c=a.da;a.B&&(b=a.da,c=a.L);a.Z=0;if(!a.Vd&&(a.Z=(a.L*a.Za>>3)*a.da,!wb(a.w,a.ya,a.Z,3)))return!1;a.Z?(a.Gc=a.I.createImageData(b,c),a.Jc=16/a.Za|0,de(a,a.Z>>1)):de(a,(a.ea+1)*a.ha);a.N=document.createElement("canvas");a.N.width=b;a.N.height=c;a.hb=a.N.getContext("2d");a.va={};a.Da=1<<a.Za;a.wa=Array(a.Da+2);a.wa[0]=[0,0,0,255];a.wa[1]=[255,255,255,255];1==a.ga&&(a.wa[a.Da+0]=[255,255,0,255],a.wa[a.Da+1]=[0,255,0,255]);2==a.ga&&(a.Yb=60,a.xb=!1,
a.Xa=Array(a.ea));return!0}Zd.prototype.Qa=function(a,b,c,d){this.A=a;this.w=b;this.b=c;this.H=d;Jd(this);if(this.J=sb(a,"Keyboard")){for(var e in this.yb)this.J.ma("led",e,this.yb[e]);this.O&&this.J.ma(this.Yd?"textarea":"canvas","kbd",this.Ca)}this.ia||E(this)};
function ce(a,b,c,d){if(d)a.ja("Unable to load font ROM (error "+d+": "+b+")");else{ab(a.Xb,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){v("Empty font ROM: "+b);return}if(1==f.length){v(f[0]);return}if(2048==f.length)a.Fa=f,Kd(a);else{a.ja("Unrecognized font data length ("+f.length+")");return}}catch(h){a.ja("Font ROM data error: "+h.message);return}(a.I||a.H)&&E(a)}}
function Kd(a){a.Fa&&(a.Ec=2==a.ga,a.va[96]=[ee(a,a.oa,a.ka),ee(a,a.oa,a.ka,a.xb)],a.va[64]=[ee(a,2*a.oa,a.ka),ee(a,2*a.oa,a.ka,a.xb)],a.va[32]=a.va[0]=[ee(a,2*a.oa,2*a.ka),ee(a,2*a.oa,2*a.ka,a.xb)])}
function ee(a,b,c,d){var e=8>=a.xc?8:16,f=8<e?15:0,h=a.Fa.length/e,g=!1===d,k={oa:b,ka:c};k.canvas=document.createElement("canvas");k.canvas.width=16*b;k.canvas.height=h/16*c;k.context=k.canvas.getContext("2d");for(var l=k.context.createImageData(b,c),q=0;q<h;q++){for(var p=0,r=p;p<a.ka;p++)for(var u=q*e+(f+p&e-1),u=d&&8==p?255:a.Fa[u],x=0;x<c/a.ka;x++){for(var z=0,A=0,K=A;A<a.oa;A++){for(var C=u&128>>(7<A?7:A),z=a.Ec&&!C&&z?z:C,R=0;R<b/a.oa;R++)g&&(z=!z),fe(a,l,K,r,z?1:0),K++;z=C}r++}k.context.putImageData(l,
(q&15)*b,(q>>4)*c)}return k}
Zd.prototype.Ea=function(){if(2==this.ga){for(var a={0:[32,"SET-UP A"],2:[64,'TO EXIT PRESS "SET-UP"'],22:[96,"        T       T       T       T       T       T       T       T       T"],23:[96,"1234567890","1234567890","1234567890","1234567890","1234567890","1234567890","1234567890","1234567890"],24:[]},b=this.ya,c=-1,d=-1,e,f=-(60==this.Yb?2:5);f<this.ha;f++){var h=a[f];if(0<=c){var g=!1,c=b+2;h?h.length?d=h[0]:(c=b-1,g=!0):32==d&&(h=a[f-1],d=0);e=d&96|c>>8&15|16;Bb(this.w,b++,e);Bb(this.w,b++,
c&255);if(g)break}if(h)for(c=0,e=1;e<h.length;e++){for(var g=h[e],k=0;k<g.length;k++)Bb(this.w,b++,g.charCodeAt(k)|c);c^=128}Bb(this.w,b++,127);c=b}ge(this)}return!0};Zd.prototype.ma=function(a,b,c){var d=this;if("led"==a||"rled"==a)return this.yb[b]=c,!0;switch(b){case "fullScreen":return this.M[b]=c,this.u&&this.u.ib?c.onclick=function(){d.ib()}:c.parentNode.removeChild(c),!0}return!1};
Zd.prototype.ib=function(){var a=!1;if(this.u){if(this.u.ib){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.ca/this.P;b>c&&(a=Math.round(c/b*100)+"%")}this.Fc?(this.O.style.width=a,this.O.style.width=a,this.O.style.display="block",this.O.style.margin="auto"):(this.u.style.width=a,this.u.style.height="auto");this.u.style.backgroundColor="black";this.u.ib();a=!0}this.Ca&&this.Ca.focus()}return a};
function be(a,b){!b&&a.u&&(a.Fc?a.O.style.width=a.O.style.height="":a.u.style.width=a.u.style.height="");hb(a,"notifyFullScreen("+b+")")}function de(a,b){a.Ic=b;a.za=!1;if(void 0===a.K||a.K.length!=a.Ic)a.K=Array(a.Ic)}function fe(a,b,c,d,e){d=a.B?(b.height-c-1)*b.width+d:c+d*b.width;e&&1==a.ga&&(208<=c&&236>c?e=a.Da+0:28<=c&&72>c&&(e=a.Da+1));a=a.wa[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
function ge(a,b){for(var c=a.ya,d=-1,e=0,f=60==a.Yb?2:5,h=0,g=0;e<a.ha;){var k=0,l=c,q=d,p=a.ea;for(96!=q&&(p>>=1);;){var r=zb(a.w,l++);if(127==(r&127)){var u=zb(a.w,l++),d=u&96,c=(u&15)<<8|zb(a.w,l),c=c+(u&16?8192:16384);break}if(k<p)a.Xa[k++]=r;else break}if(f)f--;else{for(;k<a.Xa.length;)a.Xa[k++]=0;if(0<=q)for(l=a.za&&a.K[h]==p,a.K[h++]=p,p=0;p<k;p++){r=a.Xa[p];if(!l||r!==a.K[h]){a.K[h]=r;var u=a,x=a.hb,z=r&127;if(r=u.va[q][r&128?1:0]){var A=(z&15)*r.oa,z=(z>>4)*r.ka,K=void 0,C=void 0,R=void 0,
ia=void 0,ca=r.oa,ja=r.ka;x?(K=p*u.oa,C=e*u.ka,R=u.oa,ia=u.ka):(K=p*u.yc,C=e*u.zc,R=u.yc,ia=u.zc);r.oa>u.oa&&(K*=2,R*=2);r.ka>u.ka&&(0==q&&(z+=u.ka),ja=u.ka);x?x.drawImage(r.canvas,A,z,ca,ja,K,C,R,ia):(K+=0,C+=0,u.I.drawImage(r.canvas,A,z,ca,ja,K,C,R,ia))}g++}h++}e++}}a.za=!0;(g||b)&&a.hb&&a.I.drawImage(a.N,0,a.gb,a.L,a.da-a.ka,0,0,a.Td,a.Ud)}
function Id(a,b){var c=!0,d=!0;if(0<=b){d=!1;a.zb&&(120==a.zb?b&1?(zd(a.b,2),c=!1):zd(a.b,1):zd(a.b,4));var e;if(e=c&&a.za&&a.Z){e=a.w;for(var f=a.Z,h=!0,g=a.ya>>>e.pa;0<f&&g<e.X.length;)e.X[g].Oa&&(e.X[g].Oa=h=!1,e.X[g].tc=!0),f-=e.Ha,g++;e=h}e&&(c=!1)}if(c)if(1<a.oa)switch(a.ga){case 2:ge(a,d)}else{var f=a.ya,h=f+a.Z,k=g=0,l=0,c=a.L,q=0,d=a.da,p=e=0,r=a.Za,u=(1<<r)-1;a.Wd&&(r=-r,p=16+r);for(;f<h;){var x=Ab(a.w,f);if(a.za&&x===a.K[g])k+=a.Jc;else{a.K[g]=x;var z=p;z&&(x=x>>8|(x&255)<<8);k<c&&(c=k);
for(var A=a.Jc;A--;){var K=x>>z&u;fe(a,a.Gc,k++,l,K);z+=r}k>q&&(q=k);l<d&&(d=l);l>=e&&(e=l+1)}f+=2;g++;if(k>=a.L&&(k=0,l++,l>a.da))break}a.za=!0;c<a.L&&(f=q-c,e-=d,a.B&&(h=c,g=f,c=d,f=e,d=a.L-(h+g),e=g),a.hb.putImageData(a.Gc,0,0,c,d,f,e),a.I.drawImage(a.N,0,0,a.N.width,a.N.height,0,0,a.ca,a.P))}}
Ja(function(){for(var a=B(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=y(c),e=document.createElement("canvas");if(void 0===e||!e.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e.setAttribute("class","pcjs-canvas");e.setAttribute("width",d.screenWidth);e.setAttribute("height",d.screenHeight);e.style.backgroundColor=d.screenColor;e.style.height="auto";0<=sa().indexOf("MSIE")&&(c.onresize=function(a,b,c,d){return function(){b.style.height=
(a.clientWidth*d/c|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||Sa.aspect);f&&.3<=f&&3.33>=f&&(Ia("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,e,f)),window.onresize());c.appendChild(e);f=document.createElement("textarea");ya("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"));c.appendChild(f);var h=e.getContext("2d"),d=new Zd(d,e,h,f,c);fb(d,c)}});
function he(a){this.da=+a.adapter;switch(this.da){case 0:this.ea=0;this.ia=2;break;default:v("Unrecognized serial adapter #"+this.da);return}this.B=this.F=null;this.ga=a.tabSize;this.ca=a.charBOL;this.J=0;w.call(this,"SerialPort",a,he,8388608);a=a.binding;"console"==a?this.F="":db(this,a);this.ha=function(a){return function(){ie(a)}}(this)}Za(he);var je=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],ke=[!1,0,0,133,142,39,238],eb="buffer";m=he.prototype;
m.ma=function(a,b,c,d){var e=this;switch(b){case eb:return this.M[b]=this.B=c,c.onkeydown=function(a){a=a||window.event;var b=a.keyCode;if(8===b||a.ctrlKey&&65<=b&&90>=b)a.preventDefault&&a.preventDefault(),64<b&&(b-=64),le(e,b);return!0},c.onkeypress=function(a){a=a||window.event;le(e,a.which||a.keyCode);a.preventDefault&&a.preventDefault();return!0},c.removeAttribute("readonly"),!0;default:if(d)return this.M[b]=c,d=d.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),c.onclick=function(){e.L=d;ie(e);e.A&&
e.A.fb();return!0},!0}return!1};m.Qa=function(a,b,c,d){this.A=a;this.w=b;this.b=c;this.H=d;this.I=sb(a,"ChipSet");Db(b,this,me,this.ea);Hb(b,this,ne,this.ea);E(this)};m.Ea=function(a,b){if(!b)if(!a||!this.restore)this.reset();else if(!this.restore(a))return!1;return!0};m.Ia=function(a){return a?this.save():!0};m.reset=function(){oe(this)};m.save=function(){var a=new H(this),b=0,c=[];c[b++]=this.Na;c[b++]=this.P;c[b++]=this.Z;c[b++]=this.u;c[b++]=this.K;c[b++]=this.O;c[b]=this.N;I(a,0,c);return a.data()};
m.restore=function(a){return oe(this,a[0])};function oe(a,b){var c=0;void 0===b&&(b=ke);a.Na=b[c++];a.P=b[c++];a.Z=b[c++];a.u=b[c++];a.K=b[c++];a.O=b[c++];a.N=b[c];return!0}function le(a,b){return a.u&2?!1:(a.P=b,a.u|=2,zd(a.b,a.ia),!0)}function ie(a){if(a.L&&(le(a,a.L.charCodeAt(0))&&(a.L=a.L.substr(1)),a.L)){var b=je[a.N&15],c=((a.K&12)>>2)+6;a.K&16&&c++;c+=((a.K&192)>>6)+1>>1;setTimeout(a.ha,1E3/Math.round(b/c))}}m.Zb=function(){return!!(this.u&1)};
m.xd=function(a,b){var c=this.P;D(this,a,null,b,"DATA",c);this.u&=-3;return c};m.wd=function(a,b){var c=this.u;D(this,a,null,b,"STATUS",c);return c};
m.Id=function(a,b,c){D(this,a,b,c,"DATA");this.Z=b;this.u&=-6;if(this.B)13==b?this.J=0:8==b?(this.B.value=this.B.value.slice(0,-1),0<this.J&&this.J--):(a=String.fromCharCode(b),c=32<=b?1:0,9==b&&(b=this.ga||8,c=b-this.J%b,this.ga&&(a=ka("",c))),this.ca&&!this.J&&c&&(a=String.fromCharCode(this.ca)+a),this.B.value+=a,this.B.scrollTop=this.B.scrollHeight,this.J+=c),b=!0;else if(null!=this.F){if(10==b||1024<=this.F.length)this.g(this.F),this.F="";10!=b&&(this.F+=String.fromCharCode(b));b=!0}else b=!1;
b&&(this.u|=5)};m.Hd=function(a,b,c){D(this,a,b,c,"CONTROL");this.Na?(this.O=b,this.O&64&&(this.Na=!1)):(this.K=b,this.Na=!0)};m.Gd=function(a,b,c){D(this,a,b,c,"BAUDRATES");this.N=b};var me={0:he.prototype.xd,1:he.prototype.wd},ne={0:he.prototype.Id,1:he.prototype.Hd,2:he.prototype.Gd};Ja(function(){for(var a=B(document,"pc8080","serial"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new he(d);fb(d,c)}});
function pe(a){w.call(this,"Debugger",a,pe);this.style=qe;this.ca=this.za=this.L=0;this.O=X();this.Za=X();this.I=-1;this.B=[];this.ea=!1;this.da=X();this.J=[];this.ga={};this.u=this.P=this.F=[];re(this);this.va=0;se(this);this.Ca=[];te(this,a.messages);this.Da=a.commands;var b=this;window?void 0===window.$&&(window.$=function(a){return mc(b,a)}):void 0===global.$&&(global.$=function(a){return mc(b,a)})}Za(pe);
var ue={"?":"help/print","a [#]":"assemble","b [#]":"breakpoint",c:"clear output","d [#]":"dump memory","e [#]":"edit memory",f:"frequencies","g [#]":"go [to #]",h:"halt","i [#]":"input port #","if":"eval expression","int [#]":"request interrupt",k:"stack trace",ln:"list nearest symbol(s)",m:"messages","o [#]":"output port #",p:"step over",print:"print expression",r:"dump/set registers",reset:"reset machine",s:"set options","t [#]":"trace","u [#]":"unassemble",v:"print version","var":"assign variable"},
qe=8080,ve="NONE ACI ADC ADD ADI ANA ANI CALL CC CM CNC CNZ CP CPE CPO CZ CMA CMC CMP CPI DAA DAD DCR DCX DI EI HLT IN INR INX JMP JC JM JNC JNZ JP JPE JPO JZ LDA LDAX LHLD LXI MOV MVI NOP ORA ORI OUT PCHL POP PUSH RAL RAR RET RC RM RNC RNZ RP RPE RPO RZ RLC RRC RST SBB SBI SHLD SPHL STA STAX STC SUB SUI XCHG XRA XRI XTHL".split(" "),we="NONE ADC ADC ADD ADD AND AND CALL CALLC CALLS CALLNC CALLNZ CALLNS CALLP CALLNP CALLZ NOT CMC CMP CMP DAA ADD DEC DEC CLI STI HLT IN INC INC JMP JC JS JNC JNZ JNS JP JNP JZ MOV MOV MOV MOV MOV MOV NOP OR OR OUT JMP POP PUSH RCL RCR RET RETC RETS RETNC RETNZ RETNS RETP RETNP RETZ ROL ROR RST SBB SBB MOV MOV MOV MOV STC SUB SUB XCHG XOR XOR XCHG".split(" "),
xe="B C D E H L M A BC DE HL SP PC PS PSW".split(" "),ye=[[45],[42,2067,32],[71,2131,18193],[29,2067],[28,17],[22,17],[44,17,32],[63],[45,32768],[21,18963,2067],[40,18193,2131],[23,2067],[28,273],[22,273],[44,273,32],[64],[45,32768],[42,2323,32],[71,2387,18193],[29,2323],[28,529],[22,529],[44,529,32],[52],[45,32768],[21,18963,2323],[40,18193,2387],[23,2323],[28,785],[22,785],[44,785,32],[53],[45,32768],[42,2579,32],[68,115,18963],[29,2579],[28,1041],[22,1041],[44,1041,32],[20],[45,32768],[21,18963,
2579],[41,18963,115],[23,2579],[28,1297],[22,1297],[44,1297,32],[16,18193],[45,32768],[42,2835,32],[70,115,18193],[29,2835],[28,1617],[22,1617],[44,1617,32],[72],[45,32768],[21,18963,2835],[39,18193,115],[23,2835],[28,1809],[22,1809],[44,1809,32],[17],[43,17,17],[43,17,273],[43,17,529],[43,17,785],[43,17,1041],[43,17,1297],[43,17,1617],[43,17,1809],[43,273,17],[43,273,273],[43,273,529],[43,273,785],[43,273,1041],[43,273,1297],[43,273,1617],[43,273,1809],[43,529,17],[43,529,273],[43,529,529],[43,529,
785],[43,529,1041],[43,529,1297],[43,529,1617],[43,529,1809],[43,785,17],[43,785,273],[43,785,529],[43,785,785],[43,785,1041],[43,785,1297],[43,785,1617],[43,785,1809],[43,1041,17],[43,1041,273],[43,1041,529],[43,1041,785],[43,1041,1041],[43,1041,1297],[43,1041,1617],[43,1041,1809],[43,1297,17],[43,1297,273],[43,1297,529],[43,1297,785],[43,1297,1041],[43,1297,1297],[43,1297,1617],[43,1297,1809],[43,1617,17],[43,1617,273],[43,1617,529],[43,1617,785],[43,1617,1041],[43,1617,1297],[26],[43,1617,1809],
[43,1809,17],[43,1809,273],[43,1809,529],[43,1809,785],[43,1809,1041],[43,1809,1297],[43,1809,1617],[43,1809,1809],[3,18193,17],[3,18193,273],[3,18193,529],[3,18193,785],[3,18193,1041],[3,18193,1297],[3,18193,1617],[3,18193,1809],[2,18193,17],[2,18193,273],[2,18193,529],[2,18193,785],[2,18193,1041],[2,18193,1297],[2,18193,1617],[2,18193,1809],[73,18193,17],[73,18193,273],[73,18193,529],[73,18193,785],[73,18193,1041],[73,18193,1297],[73,18193,1617],[73,18193,1809],[66,18193,17],[66,18193,273],[66,
18193,529],[66,18193,785],[66,18193,1041],[66,18193,1297],[66,18193,1617],[66,18193,1809],[5,18193,17],[5,18193,273],[5,18193,529],[5,18193,785],[5,18193,1041],[5,18193,1297],[5,18193,1617],[5,18193,1809],[76,18193,17],[76,18193,273],[76,18193,529],[76,18193,785],[76,18193,1041],[76,18193,1297],[76,18193,1617],[76,18193,1809],[46,18193,17],[46,18193,273],[46,18193,529],[46,18193,785],[46,18193,1041],[46,18193,1297],[46,18193,1617],[46,18193,1809],[18,18193,17],[18,18193,273],[18,18193,529],[18,18193,
785],[18,18193,1041],[18,18193,1297],[18,18193,1617],[18,18193,1809],[58],[50,2067],[34,51],[30,51],[11,51],[51,2067],[4,18193,33],[65,128],[62],[54],[38,51],[30,32819],[15,51],[7,51],[1,18193,33],[65,128],[57],[50,2323],[33,51],[48,33,18193],[10,51],[51,2323],[74,18193,33],[65,128],[55],[54,32768],[31,51],[27,18193,33],[8,51],[7,32819],[67,18193,33],[65,128],[61],[50,2579],[37,51],[78,19283,18963],[14,51],[51,2579],[6,18193,33],[65,128],[60],[49,2579],[36,51],[75,18963,18707],[13,51],[7,32819],[77,
18193,33],[65,128],[59],[50,3603],[35,51],[24],[12,51],[51,3603],[47,18193,33],[65,128],[56],[69,19219,18963],[32,51],[25],[9,51],[7,32819],[19,18193,33],[65,128]],ze={cpu:1,bus:64,mem:128,port:256,chipset:32768,keyboard:65536,key:131072,video:262144,fdc:524288,disk:2097152,serial:8388608,speaker:33554432,computer:67108864,log:268435456,warn:536870912,buffer:1073741824,halt:-2147483648};m=pe.prototype;
m.Qa=function(a,b,c,d){this.w=b;this.b=c;this.A=a;(a=jc(a,"messages"))&&te(this,a);this.Fa=ye;Ae(this,function(a){a:{var b=d.w.X,c=a[0],g=a=0,k=b.length;if(c){a=Be(Ce(d,c));if(-1===a){d.g("invalid address: "+c);break a}g=a>>>d.w.pa;k=1}d.g("blockid   physical   blockaddr   used    size    type");d.g("--------  ---------  ----------  ------  ------  ----");for(var c=-1,l=0;k--;){var q=b[g];q.type==c?l++||d.g("..."):(c=q.type,l=yb[c],q&&d.g(n(q.id)+"  %"+n(g<<d.w.pa)+"  %%"+n(q.G)+"  "+t(q.Hb)+"  "+
t(q.size)+"  "+l),c!=Wb&&(c=-1),l=0);a+=d.w.Ha;g++}}});E(this)};
m.ma=function(a,b,c){var d=this;switch(b){case "debugInput":return this.ia=this.M[b]=c,c.onkeydown=function(a){var b;if(13==a.keyCode)b=c.value,c.value="",mc(d,b,!0);else if(27==a.keyCode)c.value=b="";else if(38==a.keyCode?d.I<d.B.length-1&&(b=d.B[++d.I]):40==a.keyCode&&(0<d.I?b=d.B[--d.I]:(b="",d.I=-1)),null!=b){var h=b.length;c.value=b;c.setSelectionRange(h,h)}null!=b&&a.preventDefault&&a.preventDefault()},!0;case "debugEnter":return this.M[b]=c,Aa(c,function(){if(d.ia){var a=d.ia.value;d.ia.value=
"";mc(d,a,!0);return!0}return!1}),!0;case "step":return this.M[b]=c,Aa(c,function(a){var b=!1;kb(d,!0)||(jb(d,!0),b=d.tb(a?1:0),jb(d,!1));return b}),!0}return!1};m.fb=function(){this.ia&&this.ia.focus()};function Be(a){a=a&&a.G;null==a&&(a=-1);return a}m.aa=function(a,b){var c=255,d=Be(a);-1!==d&&(c=zb(this.w,d),b&&De(a,b));return c};m.Sa=function(a,b){var c=65535,d=Be(a);-1!==d&&(c=Ab(this.w,d),b&&De(a,b));return c};m.ra=function(a,b,c){var d=Be(a);-1!==d&&(Bb(this.w,d,b),c&&De(a,c),nc(this.b,!0))};
m.Tb=function(a,b,c){var d=Be(a);if(-1!==d){var e=this.w,f=d&e.w,h=(d&e.B)>>>e.pa;f!=e.w?e.X[h].fc(f,b&65535,d):(e.X[h++].Ib(f,b&255,d),e.X[h&e.K].Ib(0,b>>8&255,d+1));c&&De(a,c);nc(this.b,!0)}};function X(a){return{G:a,Pa:!1}}function Ee(a){return[a.G,a.Pa]}function Fe(a){return{G:a[0],Pa:a[1]}}
function Ce(a,b,c){var d;c=(c?a.O:a.Za).G;if(void 0!==b){d=b=Ge(a,b);var e;if(d.match(/^[a-z_][a-z0-9_]*$/i))for(d=d.toUpperCase(),c=0;c<a.J.length;c++){var f=a.J[c].Ra[d];if(void 0!==f){d=f.o;void 0!==d&&(e=X(d));break}}if(d=e)return d;c=He(a,b,void 0)}null!=c&&(d=X(c));return d}function Ie(a,b,c){c&&(c=c.match(/(['"])(.*?)\1/))&&(b.td=Je(a,b.Lc=c[2]))}function De(a,b){null!=a.G&&(a.G+=b||1)}function Y(a){return n(a,4)}
function Ke(a,b,c){var d="";for(c=c||256;d.length<c;){var e=a.aa(b,1);if(!e||36==e||127<=e)break;d+=32<=e?String.fromCharCode(e):"."}return d}function te(a,b){a.H=a;a.qa=a.ud=536870912;a.wa=null;a.ya=[];var c=Je(a,b.replace("keys","key").replace("kbd","keyboard"),!1,"|");if(c.length)for(var d in ze)0<=pa(c,d)&&(a.qa|=ze[d],a.g(d+" messages enabled"))}function Ae(a,b){for(var c in ze)if(64==ze[c]){a.Ca[c]=b;break}}
function Le(a,b){var c;a=a.toUpperCase();null==b?c=pa(xe,a):(c=pa(xe,a.substr(b,2)),0>c&&(c=pa(xe,a.substr(b,1))));return c}function Me(a,b){var c=0,d=Ne(a,b);if(void 0!==d)switch(b){case 7:case 0:case 1:case 2:case 3:case 4:case 5:case 6:c=2;break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:c=4}return c?n(d,c):"??"}
function Ne(a,b){var c;if(0<=b){var d=a.b;switch(b){case 7:c=d.j;break;case 0:c=d.S;break;case 1:c=d.T;break;case 8:c=Oc(d);break;case 2:c=d.U;break;case 3:c=d.V;break;case 9:c=Qc(d);break;case 4:c=d.W;break;case 5:c=d.Y;break;case 10:c=J(d);break;case 6:c=d.aa(J(d));break;case 11:c=d.la;break;case 12:c=d.R;break;case 13:c=Nc(d);break;case 14:c=Nc(d)&255|d.j<<8}}return c}
function Oe(a,b){b=Ge(a,b);for(var c=0,d,e;0<=(c=b.indexOf("@",c));)e=Le(b,c+1),0<=e&&(b=b.substr(0,c)+Me(a,e)+b.substr(c+1+xe[e].length)),c++;for(c=0;0<=(c=b.indexOf("#",c));)e=b.substr(c+1,2),d=aa(e,16),null!=d&&32<=d&&128>d?(d=e+" '"+String.fromCharCode(d)+"'",b=b.replace("#"+e,d),c+=d.length):c++;for(c=0;0<=(c=b.indexOf("$",c));)e=b.substr(c+1,9),(d=Ce(a,e))?(d=e+' "'+Ke(a,d)+'"',b=b.replace("$"+e,d),c+=d.length):c++;for(c=0;0<=(c=b.indexOf("^",c));)e=b.substr(c+1,9),(d=Ce(a,e))?(De(d),d=e+' "'+
Ke(a,d,11)+'"',b=b.replace("^"+e,d),c+=d.length):c++;return b}m.message=function(a,b){b&&(a+=" at "+Y(X(this.b.R).G));if(this.qa&1073741824)this.ya.push(a);else if(!this.wa||a!=this.wa)if(this.wa=a,this.qa&-2147483648&&(this.na(),a+=" (cpu halted)"),this.g(a),this.b){var c=this.b;c.i.qb=0;c.B-=c.b;c.b=0;nc(c)}};
function gb(a,b,c,d,e,f,h,g){g|=256;null!=f&&(a.qa&g)!=g||a.message(b.Lb+"."+(null!=d?"outPort":"inPort")+"("+t(c)+","+(f?f:"unknown")+(null!=d?",0x"+n(d,2):"")+")"+(null!=h?": 0x"+n(h,2):"")+(null!=e?" at "+Y(e):""))}
function se(a){var b;if(Ad(a)){if(!a.N||!a.N.length){a.N=Array(1E3);for(b=0;b<a.N.length;b++)a.N[b]=X();a.ha=0;a.g("instruction history buffer allocated")}if(!a.K||!a.K.length)for(a.K=Array(256),b=0;b<a.K.length;b++)a.K[b]=[b,0]}else a.N&&a.N.length&&a.g("instruction history buffer freed"),a.ha=0,a.N=[],a.K=[]}m.eb=function(a){if(!Pe(this))return!1;this.b.eb(a);return!0};
m.tb=function(a,b,c){if(!Pe(this))return!1;this.L=0;a||Ad(this)&&Bd(this,this.b.R,0);try{var d=this.b.tb(a);0<d&&(this.L+=d,Ec(this.b,d,!0),Bc(this.b,d),this.ca++)}catch(e){"number"!=typeof e&&(this.L=0,ob(this.b,e.stack||e.message))}!1!==c&&nc(this.b);this.Ja(b||!1);return 0<this.L};m.na=function(a){this.b&&this.b.na(a)};m.Ja=function(a){void 0===a&&(a=!0);this.O=X(this.b.R);a&&1!=this.Z?Qe(this):Re(this)};
function Pe(a){var b;if(b=a.b&&lb(a.b))b=a.b,b.D.sa?b=!0:(b.g(b.toString()+" not powered"),b=!1);b&&!kb(a.b)?(a=a.b,a.D.lb?(a.g(a.toString()+" error"),a=!0):a=!1,a=!a):a=!1;return a}m.Ea=function(a,b){return!b&&(this.reset(!0),a&&this.restore&&!this.restore(a))?!1:!0};m.Ia=function(a,b){b&&this.g(a?"suspending":"shutting down");return a?this.save():!0};m.reset=function(a){se(this);this.ca=this.za=0;this.wa=null;this.L=0;this.O=X(this.b.R);this.D.xa=!1;qf(this);a||this.Ja()};
m.save=function(){var a=new H(this);I(a,0,Ee(this.O));I(a,1,Ee(this.da));I(a,2,[this.B,this.ea,this.qa]);I(a,3,this.J);return a.data()};m.restore=function(a){var b=0;void 0!==a[2]&&(this.O=Fe(a[b++]),this.da=Fe(a[b++]),this.B=a[b][0],"string"==typeof this.B&&(this.B=[this.B]),this.ea=a[b][1],this.qa|=a[b][2]);a[3]&&(this.J=a[3]);return!0};m.start=function(a,b){this.Z||this.g("running");this.D.xa=!0;this.xb=a;this.yb=b};
m.stop=function(a,b){if(this.D.xa){this.D.xa=!1;this.L=b-this.yb;if(!this.Z){var c="stopped";if(this.L){var d=a-this.xb,e=0<d?Math.round(1E3*this.L/d):0,c=c+" (";Ad(this)&&(c+=this.ca+" opcodes, ",this.za-=this.ca,this.ca=0);c+=this.L+" cycles, "+d+" ms, "+e+" hz)"}else ib(this,-2147483648)&&(c+=" (use the 't' command to execute blocked faults)");this.g(c)}this.Ja(!0);this.fb();qf(this,this.b.R)}};function Ad(a){return 1<a.u.length||!!a.va}
function Bd(a,b,c){var d=a.b;if(0<c&&(a.va&&!--a.va||ec(a,b,1,a.u)))return!0;0<=c&&a.K.length&&(a.ca++,b=zb(a.w,b),null!=b&&(a.K[b][1]++,b=a.N[a.ha],b.G=d.R,b.Pa=!1,++a.ha==a.N.length&&(a.ha=0)));return!1}function Fb(a,b,c){a.g("break on input from port "+t(b)+": "+n(c));a.na(!0)}function Jb(a,b,c){a.g("break on output to port "+t(b)+": "+n(c));a.na(!0)}
function re(a){var b,c;a.u=["bp"];if(void 0!==a.P)for(b=1;b<a.P.length;b++){c=a.P[b];var d=a.w;fc(d.X[Be(c)>>>d.pa],!1)}a.P=["br"];if(void 0!==a.F)for(b=1;b<a.F.length;b++)c=a.F[b],d=a.w,fc(d.X[Be(c)>>>d.pa],!0);a.F=["bw"];a.gb=0}m.Ya=function(a,b,c){var d=!0;c||rf(this,a,b,!1,!0);if(a!=this.u){var e=Be(b);if(-1===e)this.g("invalid address: "+Y(b.G)),d=!1;else{var f=this.w;f.X[e>>>f.pa].Ya(e&f.w,a==this.F)}}d&&(a.push(b),c?b.Pa=!0:(sf(this,a,a.length-1,"set"),se(this)));return d};
function rf(a,b,c,d,e){var f=!1;c=Be(c);for(var h=1;h<b.length;h++){var g=b[h];if(c==Be(g)&&(!d||g.Pa)){f=!0;g.Pa||e||sf(a,b,h,"cleared");b.splice(h,1);b!=a.u&&(d=a.w,fc(d.X[c>>>d.pa],b==a.F));g.Pa||se(a);break}}return f}function tf(a,b){for(var c=1;c<b.length;c++)sf(a,b,c);return b.length-1}function sf(a,b,c,d){c=b[c];a.g(b[0]+" "+Y(c.G)+(d?" "+d:c.Lc?' "'+c.Lc+'"':""))}
function qf(a,b){if(void 0!==b)ec(a,b,1,a.u,!0),a.Z=0;else for(var c=1;c<a.u.length;c++){var d=a.u[c];if(d.Pa){if(!rf(a,a.u,d,!0))break;c=0}}}
function ec(a,b,c,d,e){var f=!1;if(!a.gb++)for(var h=1;!f&&h<d.length;h++){var g=d[h];if(!e||g.Pa)for(var k=Be(g),l=0;l<c;l++)if(b+l==k){var q,f=!0;g.Pa&&(rf(a,d,g,!0),e=!0);if(q=g.td){for(var f=!1,p=0;p<q.length;p++)if(!uf(a,q[p],!0)){if(q[p].indexOf("if")){f=!0;break}for(var r=p+1;r<q.length&&q[r].indexOf("else");r++)p++;if(r==q.length){f=!0;break}}a.b.D.xa||(f=!0)}if(f){e||sf(a,d,h,"hit");break}}}a.gb--;return f}
function vf(a,b,c,d){for(var e=X(b.G),f=a.aa(b,1),h=a.Fa[f],g="",k=(8086!=a.style?ve:we)[h[0]],l=h.length-1,q=0,p,r=1;r<=l;r++){var u="";p=h[r];if(void 0!==p&&!(p&16384&&a.style==qe)){var x=p&240;if(x){var z=p&15;z?q=z:p|=q;p&61440||(p|=1==r?8192:4096);if(x&32)a:{var u=a,x=p,z=b,A=" ";switch(x&15){case 1:A=n(u.aa(z,1),2);break;case 2:A=n(u.aa(z,1)<<24>>24,4);break;case 3:A=n(u.Sa(z,2),4);break;default:u="imm("+t(x)+")";break a}8086==u.style&&x&64?A="["+A+"]":x&16||(A=(u.style==qe?"$":"0x")+A);u=A}else x&
16?(u=(p&3840)>>8,x=xe[u],8086==a.style&&p&64&&(6==u&&(x="HL"),x="["+x+"]"),u=x):x&128&&(u=(f>>3&7).toString());if(!u||!u.length){g="INVALID";break}0<g.length&&(g+=",");g+=u||"???"}}}f="";h=Y(e.G)+" ";if(-1!==e.G&&-1!==b.G){do if(f+=n(a.aa(e,1),2),null==e.G)break;while(e.G!=b.G)}h+=ka(f,10);h=h+(p&32768?"*":" ")+ka(k,7);g&&(h+=" "+g);c&&(h=ka(h,40)+";"+c,h=a.b.D.kb?h+("cycles="+Cc(a.b).toString()+" cs="+n(a.b.i.Ab)):h+(null!=d?"="+d.toString():""));return h}
function wf(a,b){var c;switch(b){case "IF":c=a.b.ta&512;break;case "SF":c=Yc(a.b);break;case "ZF":c=Xc(a.b);break;case "AF":c=Wc(a.b);break;case "PF":c=Vc(a.b);break;case "CF":c=Tc(a.b);break;default:c=0}return b.charAt(0)+(c?"1":"0")+" "}function xf(a,b){return xe[b]+"="+Me(a,b)+" "}function yf(a){return xf(a,7)+xf(a,8)+xf(a,9)+xf(a,10)+xf(a,11)+wf(a,"IF")+wf(a,"SF")+wf(a,"ZF")+wf(a,"AF")+wf(a,"PF")+wf(a,"CF")}
var zf={"||":0,"&&":1,"|":2,"^":3,"&":4,"!=":5,"==":5,">=":6,">":6,"<=":6,"<":6,">>>":7,">>":7,"<<":7,"-":8,"+":8,"%":9,"/":9,"*":9};
function Af(a,b,c){for(c=c||-1;c--&&b.length;){var d=b.pop();if(2>a.length)return!1;var e=a.pop(),f=a.pop();switch(d){case "*":d=f*e;break;case "/":if(!e)return!1;d=f/e;break;case "%":if(!e)return!1;d=f%e;break;case "+":d=f+e;break;case "-":d=f-e;break;case "<<":d=f<<e;break;case ">>":d=f>>e;break;case ">>>":d=f>>>e;break;case "<":d=f<e?1:0;break;case "<=":d=f<=e?1:0;break;case ">":d=f>e?1:0;break;case ">=":d=f>=e?1:0;break;case "==":d=f==e?1:0;break;case "!=":d=f!=e?1:0;break;case "&":d=f&e;break;
case "^":d=f^e;break;case "|":d=f|e;break;case "&&":d=f&&e?1:0;break;case "||":d=f||e?1:0;break;default:return!1}a.push(d|0)}return!0}
function He(a,b,c){var d;if(b){b=Ge(a,b);for(var e=0,f=!1,h=b,g=[],k=[],l=b.split(/(\|\||&&|\||^|&|!=|==|>=|>>>|>>|>|<=|<<|<|-|\+|%|\/|\*)/);e<l.length;){var q=l[e++],p=q.length,q=la(q);if(!q){f=!0;break}q=Bf(a,q,null,!1===c);if(void 0===q){f=!0;c=!1;break}g.push(q);if(e==l.length)break;var q=l[e++],r=q.length;k.length&&zf[q]<zf[k[k.length-1]]&&Af(g,k,1);k.push(q);b=b.substr(p+r)}Af(g,k)&&1==g.length||(f=!0);f?c&&a.g("error parsing '"+h+"' at character "+(h.length-b.length)):(d=g.pop(),c&&Cf(a,null,
d))}return d}function Ge(a,b){for(var c;(c=b.match(/\{(.*?)}/))&&!(0<=c[1].indexOf("{"));){var d=He(a,c[1]);b=b.replace("{"+c[1]+"}",null!=d?n(d):"undefined")}for(;(c=b.match(/\[(.*?)]/))&&!(0<=c[1].indexOf("["));)d=Ce(a,c[1]),b=b.replace("["+c[1]+"]",d?n(a.Sa(d,0),4):"undefined");for(c=b;d=c.match(/\$([a-z]+)/i);){var e=null;switch(d[1].toLowerCase()){case "ops":e=a.ca-a.za}if(null==e)break;c=c.replace(d[0],e.toString())}return c}
function Bf(a,b,c,d){var e;void 0!==b?(e=Le(b),0<=e?e=Ne(a,e):(e=a.ga[b],void 0===e&&(e=aa(b))),void 0!==e||d||a.g("invalid "+(c?c:"value")+": "+b)):d||a.g("missing "+(c||"value"));return e}
function Cf(a,b,c){var d,e=!1;if(void 0!==c){e=!0;d=c;var f,h="";if(!f||4<f)f=4;for(var g=0;g<f;g++){h&&(h=","+h);var k=d&255,l=8,q="";void 0===l?l=32:32<l&&(l=32);if(null==k||isNaN(k))for(;0<l--;)q="?"+q;else for(;0<l--;)q=(k&1?"1":"0")+q,k>>=1;h=q+"b"+h;d>>=8}d="0x"+n(c)+" "+c+". ("+h+")"}a.g((null!=b?b+": ":"")+d);return e}function Df(a,b){if(b)return Cf(a,b,a.ga[b]);var c=0;for(b in a.ga)Cf(a,b,a.ga[b]),c++;return 0<c}pe.prototype.Xa=function(a,b){return a[0]>b[0]?1:a[0]<b[0]?-1:0};
function Ef(a,b,c){var d=[],e=Be(b)>>>0;for(b=0;b<a.J.length;b++){var f=a.J[b],h=f.G>>>0,g=f.Ed;if(e>=h&&e<h+g){e=ma(f.qc,[e-h],a.Xa);0<=e?Ff(a,b,e,d):c&&(e=~e,Ff(a,b,e-1,d),Ff(a,b,e,d));break}}return d}function Ff(a,b,c,d){var e={},f=a.J[b].qc,h=0,g=null;0<=c&&c<f.length&&(h=f[c][0],g=f[c][1]);g&&(e=a.J[b].Ra[g],g="."==g.charAt(0)?null:e.l||g);d.push(g);d.push(h);d.push(e.a);d.push(e.c)}
function Gf(a,b){if("?"==b)a.g("frequency commands:"),a.g("\tclear\tclear all frequency counts");else{var c,d=0;if(a.K)if("clear"==b){for(c=0;c<a.K.length;c++)a.K[c]=[c,0];a.g("frequency data cleared");d++}else if(void 0!==b)a.g("unknown frequency command: "+b),d++;else{var e=a.K.slice();e.sort(function(a,b){return b[1]-a[1]});var f=8086!=a.style?ve:we;for(c=0;c<e.length;c++){var h=e[c][0],g=e[c][1];g&&(a.g((f[a.Fa[h][0]]+"  ").substr(0,5)+" ("+("0x"+n(h,2))+"): "+g+" times"),d++)}}d||a.g("no frequency data available")}}
function Hf(a,b){var c=b.match(/^\s*([A-Z_]?[A-Z0-9_]*)\s*(=?)\s*(.*)$/i);if(c){if(!c[1])return Df(a)||a.g("no variables"),!0;if(!c[2])return Df(a,c[1]);if(!c[3])return delete a.ga[c[1]],!0;var d=He(a,c[3]);return void 0!==d?(a.ga[c[1]]=d,!0):!1}a.g("invalid assignment:"+b);return!1}
function If(a,b,c){var d=null;if(b=Ce(a,b,!0)){var e=Ef(a,b,!0);if(e.length){var f,h;e[0]&&(h="",(f=b.G-e[1])&&(h=" + "+t(f)),f=e[0]+" ("+Y(e[1])+")"+h,c&&a.g(f),d=f);4<e.length&&e[4]&&(h="",(f=e[5]-b.G)&&(h=" - "+t(f)),f=e[4]+" ("+Y(e[5])+")"+h,c&&a.g(f),d||(d=f))}else c&&a.g("no symbols")}return d}
function Jf(a,b){switch(b[1]){case "8080":a.style=qe;break;case "8086":a.style=8086;break;case "cs":var c;void 0!==b[3]&&(c=+b[3]);switch(b[2]){case "int":a.b.i.nb=c;break;case "start":a.b.i.Bb=c;break;case "stop":a.b.i.pb=c;break;default:a.g("unknown cs option");return}void 0!==c&&lc(a.b);a.g("checksums "+(a.b.D.kb?"enabled":"disabled"));return;case "sp":void 0!==b[2]&&(Dc(a.b,+b[2])||a.g("warning: using 1x multiplier, previous target not reached"));a.g("target speed: "+(a.b.i.ab.toFixed(2)+"Mhz")+
" ("+a.b.i.cb+"x)");return;case "?":a.g("debugger options:");a.g("\t8080\t\tselect 8080-style mnemonics");a.g("\t8086\t\tselect 8086-style mnemonics");a.g("\tcs int #\tset checksum cycle interval to #");a.g("\tcs start #\tset checksum cycle start count to #");a.g("\tcs stop #\tset checksum cycle stop count to #");a.g("\tsp #\t\tset speed multiplier to #");break;default:if(b[1]){a.g("unknown option: "+b[1]);return}}a.g(a.style+"-style mnemonics enabled")}
function Qe(a,b){var c;if(b&&"?"==b[1])a.g("register commands:"),a.g("\tr\tdump registers"),a.g("\trx [#]\tset flag or register x to [#]");else{var d=a.b;null==c&&(c=!0);if(null!=b&&1<b.length){var e=b[1],f=null,h=e.indexOf("=");if(0<h)f=e.substr(h+1),e=e.substr(0,h);else if(2<b.length)f=b[2];else{a.g("missing value for "+b[1]);return}var h=!1,g=He(a,f);if(void 0!==g)switch(h=!0,e.toUpperCase()){case "A":d.j=g&255;break;case "B":d.S=g&255;break;case "BC":d.S=g>>8&255;case "C":d.T=g&255;break;case "D":d.U=
g&255;break;case "DE":d.U=g>>8&255;case "E":d.V=g&255;break;case "H":d.W=g&255;break;case "HL":d.W=g>>8&255;case "L":d.Y=g&255;break;case "SP":d.la=g&65535;break;case "PC":G(d,g);a.O=X(d.R);break;case "PS":Lc(d,g);break;case "PSW":Lc(d,g&255|d.ta&-256);d.j=g>>8;break;case "CF":d.ba=g?d.ba|256:d.ba&255;break;case "PF":g?Vc(d)||(d.fa^=1):Vc(d)&&(d.fa^=1);break;case "AF":d.ua=g?~d.fa&16|d.ua&-17:d.fa&16|d.ua&-17;break;case "ZF":d.ba=g?d.ba&-256:d.ba|255;break;case "SF":g?Yc(d)||(d.fa^=192):Yc(d)&&(d.fa^=
192);break;case "IF":d.ta=g?d.ta|512:d.ta&-513;break;default:a.g("unknown register: "+e);return}if(!h){a.g("invalid value: "+f);return}nc(d);a.g("updated registers:")}a.g(yf(a));c&&(a.O=X(d.R),Re(a,Y(a.O.G)))}}function Kf(a,b){b=la(b);var c=b.match(/^(['"])(.*?)\1$/);c?a.g(Oe(a,c[2])):He(a,b,!0)}function Lf(a,b,c){var d="t"!=b;c=Bf(a,c,null,!0)||1;var e=1==c?0:1;"tc"==b&&(e=c,c=1);za(c,function(){return jb(a,!0)&&a.tb(e,d,!1)},function(){nc(a.b);jb(a,!1)})}
function Re(a,b,c,d){if(b=Ce(a,b,!0)){void 0===d&&(d=1);var e=256;if(void 0!==c){d=Ce(a,c,!0);if(!d||d.G<b.G)return;e=d.G-b.G;if(256<e){a.g("range too large");return}d=-1}c=0;for(var f;0<e&&d--;){f=kb(a,!1)||a.Z?a.L:null;var h=null!=f?"cycles":null,g=Ef(a,b),k=b.G;if(g[0]&&d&&(!c&&d||0>g[0].indexOf("+"))){var l=g[0]+":";g[2]&&(l+=" "+g[2]);a.g(l)}g[3]&&(h=g[3],f=null);f=vf(a,b,h,f);a.g(f);a.O=b;e-=b.G-k;c++}}}
function Je(a,b,c,d){if(c)if(b){0>a.I&&a.B.length&&(a.I=0);if(0>a.I||b!=a.B[a.I])a.B.splice(0,0,b),a.I=0;a.I--}else a.ea?b="end":b=a.B[a.I+1];a=[];if(b){b=b.toLowerCase().replace(/""/g,"'");c=0;var e=null;d=d||";";for(var f=0;f<=b.length;f++){var h=b.charAt(f);if('"'==h||"'"==h)e?h==e&&(e=null):e=h;else if(h==d&&!e||!h)a.push(la(b.substring(c,f))),c=f+1}}return a}
function uf(a,b,c){var d=!0;try{b.length&&"end"!=b?c||a.g(">> "+b):(a.ea&&(a.g("ended assemble at "+Y(a.da.G)),a.O=a.da,a.ea=!1),b="");var e=b.charAt(0);if('"'==e||"'"==e)return!0;a.wa=null;if(lb(a)&&0<b.length){a.ea&&(b="a "+Y(a.da.G)+" "+b);var f=b.replace(/ +/g," ").split(" ");if(f&&f.length)for(var h=f[0],g=h.charAt(0),k=1;k<h.length;k++){var l=h.charAt(k);if("?"==g||"r"==g||"a">l||"z"<l){f[0]=h.substr(k);f.unshift(h.substr(0,k));break}}switch(f[0].charAt(0)){case "a":var q=Ce(a,f[1],!0);if(q)if(a.da=
q,void 0===f[2])a.g("begin assemble at "+Y(q.G)),a.ea=!0,nc(a.b);else{var p;a.g("not supported yet");p=[];if(p.length){for(var r=0;r<p.length;r++)a.ra(q,p[r],1);a.g(vf(a,a.da))}}break;case "b":a:{var u=f[0],x=f[1],z=b;if("?"==x)a.g("breakpoint commands:"),a.g("\tbi [p]\ttoggle break on input port [p]"),a.g("\tbo [p]\ttoggle break on output port [p]"),a.g("\tbp [a]\tset exec breakpoint at addr [a]"),a.g("\tbr [a]\tset read breakpoint at addr [a]"),a.g("\tbw [a]\tset write breakpoint at addr [a]"),
a.g("\tbc [a]\tclear breakpoint at addr [a]"),a.g("\tbl\tlist all breakpoints"),a.g("\tbn [n]\tbreak after [n] instruction(s)");else{var A=u.charAt(1);if("l"==A){var K=0,K=K+tf(a,a.u),K=K+tf(a,a.P);(K+=tf(a,a.F))||a.g("no breakpoints")}else if("n"==A)a.va=Bf(a,x),a.g("break after "+a.va+" instruction(s)");else if(void 0===x)a.g("missing breakpoint address");else{var C=X();if("*"!=x&&(C=Ce(a,x,!0),!C))break a;x=t(C.G);"c"==A?null==C.G?(re(a),a.g("all breakpoints cleared")):rf(a,a.u,C)||rf(a,a.P,C)||
rf(a,a.F,C)||a.g("breakpoint missing: "+Y(C.G)):"i"==A?a.g("breakpoint "+(Cb(a.w,C.G)?"enabled":"cleared")+": port "+x+" (input)"):"o"==A?a.g("breakpoint "+(Gb(a.w,C.G)?"enabled":"cleared")+": port "+x+" (output)"):null!=C.G&&(Ie(a,C,z),"p"==A?a.Ya(a.u,C):"r"==A?a.Ya(a.P,C):"w"==A?a.Ya(a.F,C):a.g("unknown breakpoint command: "+A))}}}break;case "c":a.Ga&&(a.Ga.value="");break;case "d":a:{var R,ia=f[0],ca=f[1],ja=f[2],fg=f[3];if("?"==ca){var Ea="";for(R in ze)a.Ca[R]&&(Ea&&(Ea+=","),Ea+=R);Ea+=",state,symbols";
a.g("dump memory commands:");a.g("\tdb [a] [#]    dump # bytes at address a");a.g("\tdw [a] [#]    dump # words at address a");a.g("\tdd [a] [#]    dump # dwords at address a");a.g("\tdh [#] [#]    dump # instructions from history");Ea.length&&a.g("dump extension commands:\n\t"+Ea)}else if("state"==ca){var Se=Mf(a.A,!0);"console"==ja?console.log(Se):(a.Ga&&(a.Ga.value=""),a.g(Se))}else if("symbols"==ca)for(var gd=0;gd<a.J.length;gd++){var hd=a.J[gd],mb;for(mb in hd.Ra)if("."!=mb.charAt(0)){var Te=
hd.Ra[mb].o;if(void 0!==Te){var Ue=hd.Ra[mb].l;Ue&&(mb=Ue);a.g(Y(Te)+" "+mb)}}}else{if("d"==ia){for(R in ze)if(f[1]==R){var Ve=a.Ca[R];Ve?(f.shift(),f.shift(),Ve(f)):a.g("no dump registered for "+ca);break a}ca||(ia=a.zb||"db")}else a.zb=ia;if("dh"==ia){var We=ca,Xe=ja,Ye="",Ze=0,Z=a.ha,Fa=a.N;if(Fa.length){var fa=+We||a.hb,nb=+Xe||10;isNaN(fa)?fa=nb:Ye="more ";fa>Fa.length&&(a.g("note: only "+Fa.length+" available"),fa=Fa.length);Z-=fa;0>Z&&(null==Fa[Fa.length-1].G?(fa=Z+fa,Z=0):Z+=Fa.length);var id=
[];"call"==Xe&&(nb=1E5,id=["CALL"]);for(void 0!==We&&a.g(fa+" instructions earlier:");0<nb&&Z!=a.ha;){var $e=Fa[Z++];if(null==$e.G)break;var Kb=X($e.G),gg=fa--,af=vf(a,Kb,"history",gg);(!id.length||0<=af.indexOf(id[0]))&&a.g(af);Kb.Ub&&(Z+=Kb.Ub,nb-=Kb.Ub,fa-=Kb.Ub);Z>=Fa.length&&(Z=0);a.hb=fa;Ze++;nb--}}Ze||(a.g("no "+Ye+"history available"),a.hb=void 0)}else{var oc=Ce(a,ca);if(oc){var pc=0;ja&&("l"==ja.charAt(0)&&(ja=ja.substr(1)||fg),pc=Bf(a,ja)>>>0,65536<pc&&(pc=65536));for(var Xa="",qc="dd"==
ia?4:"dw"==ia?2:1,rc=qc*pc||128,hg=rc+15>>4||1;hg--&&0<rc;){var sc=0,jd=0,Lb,Mb="",kd="",ca=Y(oc.G);for(Lb=16;0<Lb&&0<rc;Lb--){var tc=a.aa(oc,1),sc=sc|tc<<(jd++<<3);jd==qc&&(Mb+=n(sc,2*qc),Mb+=1==qc?9==Lb?"-":" ":"  ",sc=jd=0);kd+=32<=tc&&128>tc?String.fromCharCode(tc):".";rc--}Xa&&(Xa+="\n");Xa+=ca+"  "+Mb+(0==Lb?" "+kd:"")}Xa&&a.g(Xa);a.Za=oc}}}}break;case "e":if("else"==f[0])break;var uc=1,bf=255,cf=a.aa,df=a.ra;"ew"==f[0]&&(uc=2,bf=65535,cf=a.Sa,df=a.Tb);var ef=uc<<1,ff=f[1];if(null==ff)a.g("edit memory commands:"),
a.g("\teb [a] [...]  edit bytes at address a"),a.g("\tew [a] [...]  edit words at address a");else{var vc=Ce(a,ff);if(vc)for(var wc=2;wc<f.length;wc++){var Nb=He(a,f[wc]);if(void 0===Nb){a.g("unrecognized value: "+f[wc]);break}Nb&~bf&&a.g("warning: "+n(Nb)+" exceeds "+uc+"-byte value");var ig=cf.call(a,vc);a.g("changing "+Y(vc.G)+" from 0x"+n(ig,ef)+" to 0x"+n(Nb,ef));df.call(a,vc,Nb,uc)}}break;case "f":Gf(a,f[1]);break;case "g":a:{var gf=f[1],jg=b;if(void 0!==gf){var ld=Ce(a,gf,!0);if(!ld)break a;
Ie(a,ld,jg);a.Ya(a.u,ld,!0)}a.eb(!0)||c||a.g("cpu busy or unavailable, run command ignored")}break;case "h":a:{var md;if(a.D.xa)md="halting",a.na();else{if(kb(a,!0))break a;md="already halted"}c||a.g(md)}break;case "i":if("if"==f[0]){var nd;var Ob=b.substr(2),Ob=la(Ob);He(a,Ob)?(c||a.g("true: "+Ob),nd=!0):(c||a.g("false: "+Ob),nd=!1);nd||(d=!1);break}if("int"==f[0]){var xc;var kg=f[1];if(a.b.ta&512){var od=He(a,kg);null==od?xc=!1:(a.g("requesting interrupt level "+od),zd(a.b,od),xc=!0)}else a.g("interrupts disabled (use rif=1 to enable)"),
xc=!1;xc||(d=!1);break}var pd=f[1];if(pd&&"?"!=pd){var qd=Bf(a,pd);if(void 0!==qd){var lg=Eb(a.w,qd);a.g(t(qd)+": "+("0x"+n(lg,2)))}}else a.g("input commands:"),a.g("\ti [p]\tread port [p]"),a.g("warning: port accesses can affect hardware state");break;case "k":var mg=f[0];if("?"==f[1])a.g("stack trace commands:"),a.g("\tk\tshow frame addresses"),a.g("\tks\tshow symbol information");else{var rd=0,hf=X(),Pb=X(a.b.la);for(a.g("stack trace for "+Y(Pb.G));10>rd;){for(var Ya=null,ng=256;65536>Pb.G>>>0;){hf.G=
a.Sa(Pb,2);if(null==Pb.G||!ng--)break;for(var og=a,yc=hf,jf=null,Qb=yc.G,kf=Qb,sd=1;6>=sd&&Qb;sd++){if(2<sd){yc.G=Qb;var zc=vf(og,yc);if(0<=zc.indexOf("CALL")){var lf=zc.indexOf(" ");if(Qb+(zc.indexOf(" ",lf+1)-lf-1)/2==kf){jf=zc;break}}}Qb--}yc.G=kf;if(Ya=jf)break}if(!Ya||null==Ya)break;var mf=null;if("ks"==mg){var nf=Ya.match(/[0-9A-F]+$/);nf&&(mf=If(a,nf[0]))}Ya=ka(Ya,50)+"  ;"+(mf||"stack="+Y(Pb.G));a.g(Ya);rd++}rd||a.g("no return addresses found")}break;case "l":if("ln"==f[0]){If(a,f[1],!0);
break}break;case "m":a:{var Ga,Ha=null,O=f[1];"?"==O&&(O=void 0);if(void 0!==O){var Qa=0;if("all"==O)Qa=1878917119,O=null;else if("on"==O)Ha=!0,O=null;else if("off"==O)Ha=!1,O=null;else{"keys"==O&&(O="key");"kbd"==O&&(O="keyboard");for(Ga in ze)if(O==Ga){Qa=ze[Ga];Ha=!!(a.qa&Qa);break}if(!Qa){a.g("unknown message category: "+O);break a}}if(Qa)if("on"==f[2])a.qa|=Qa,Ha=!0;else if("off"==f[2]&&(a.qa&=~Qa,Ha=!1,1073741824==Qa)){for(var td=0;td<a.ya.length;td++)a.g(a.ya[td]);a.ya=[]}}var pg=0,Ra="";for(Ga in ze)if(!O||
O==Ga){var qg=!!(a.qa&ze[Ga]);if(null===Ha||Ha==qg)Ra&&(Ra+=","),++pg%10||(Ra+="\n\t"),"key"==Ga&&(Ga="keys"),Ra+=Ga}void 0===O&&a.g("message commands:\n\tm [category] [on|off]\tturn categories on/off");a.g((null!==Ha?Ha?"messages on:  ":"messages off: ":"message categories:\n\t")+(Ra||"none"));se(a)}break;case "o":var ud=f[1],rg=f[2];if(ud&&"?"!=ud){var vd=Bf(a,ud,"port #"),wd=Bf(a,rg);void 0!==vd&&void 0!==wd&&(Ib(a.w,vd,wd),a.g(t(vd)+": "+("0x"+n(wd,2))))}else a.g("output commands:"),a.g("\to [p] [b]\twrite byte [b] to port [p]"),
a.g("warning: port accesses can affect hardware state");break;case "p":if("print"==f[0]){Kf(a,b.substr(5));break}var of="pr"==f[0]?1:0,sg=1+of;if(a.Z)a.g("step in progress");else{var xd=X(a.b.R);switch(a.aa(xd)){case 205:a.Z=sg,De(xd,3)}a.Z?(a.Ya(a.u,xd,!0),a.eb()||(a.A&&a.A.fb(),a.Z=0)):Lf(a,of?"tr":"t")}break;case "r":if("reset"==b){a.A&&a.A.reset();break}Qe(a,f);break;case "s":Jf(a,f);break;case "t":Lf(a,f[0],f[1]);break;case "u":Re(a,f[1],f[2],8);break;case "v":if("var"==f[0]){Hf(a,b.substr(3))||
(d=!1);break}a.g("PC8080 version 1.23.3 ("+a.b.Ac+",RELEASE"+(pb?",TYPEDARRAYS":",LONGARRAYS")+")");a.g(sa());break;case "?":if(f[1]){Kf(a,b.substr(1));break}var Rb="commands:",yd;for(yd in ue)Rb+="\n"+ka(yd,9)+ue[yd];Ad(a)||(Rb+="\nnote: frequency/history disabled if no exec breakpoints");a.g(Rb);break;default:a.g("unknown command: "+b),d=!1}}}catch(pf){a.g("debugger error: "+(pf.stack||pf.message)),d=!1}return d}function mc(a,b,c){b=Je(a,b,c);for(var d in b)if(!uf(a,b[d]))return!1;return!0}
Ja(function(){for(var a=B(document,"pc8080","debugger"),b=0;b<a.length;b++){var c=a[b],d=y(c),d=new pe(d);fb(d,c)}});function H(a,b,c){this.id=a.id;this.key=Nf(a,b,c);this.H=a.H;Of(this,a.Hc)}function Nf(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
H.prototype={constructor:H,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){Of(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}}};
function Of(a,b){a[a.id]={};b&&I(a,"parms",b);a.b=!1}function Pf(a){var b=!0;if(va()){var c=JSON.stringify(a[a.id]);xa(a.key,c)||(v("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function Qf(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){v(c.message||c),b=!1}return b}function Rf(a,b){return b?(a[a.id]=b,a.b=!0):a.b?!0:va()&&(b=wa(a.key))?(a[a.id]=b,a.b=!0):!1}function Sf(a,b){return a[a.id][b]||null}function I(a,b,c){try{a[a.id][b]=c}catch(d){}}
function Tf(a,b,c){w.call(this,"Computer",a,Tf,67108864);this.D.sa=!1;Uf(this,b);this.Z=jc(this,"autoPower",a);this.B=0;this.ga=a.busWidth||a.buswidth;this.A=Vf;this.O=null;this.K=this.ea=!1;this.ha=jc(this,"url")||"";(Math.random()+.1).toString(36);this.u=Wf(this);if(this.b=cb("CPU",this.id)){this.H=cb("Debugger",this.id);this.J=[];for(b=null;b=sb(this,"Video",b);)this.J.push(b);this.w=new ub({id:this.Xb+".bus",busWidth:this.ga},this.b,this.H);var d,e=bb(this.id);if((this.I=cb("Panel",this.id))&&
this.I.Ga)for(b=0;b<e.length;b++)d=e[b],d.ja=this.I.ja,d.g=this.I.g,d.Ga=this.I.Ga;this.g("PC8080 v1.23.3\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>");for(b=0;b<e.length;b++)d=e[b],d.Qa&&d.Qa(this,this.w,this.b,this.H);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.N=d:this.A=parseInt(d,10));var f;if(a=jc(this,"state")||(f=!0,a.state))b=this.ca=a,f||(this.K=!0,this.A=Vf),this.A&&(this.P=new H(this,"1.23.3"),Rf(this.P)?
b=null:delete this.P);!b&&this.A&&(b=Xf(this))&&(this.K=!0);if(b){var h=this;qa(b,null,!0,function(a,b,c){c?(h.N=null,h.K=!1,h.ja("Unable to load machine state from server (error "+c+(b?": "+la(b):"")+")")):(h.O=b,h.ea=!0);E(h)})}else E(this);this.M.power||(this.Z=!0);!c&&this.Z&&Yf(this,this.Fb)}else v("Unable to find CPU component")}Za(Tf);var Vf=0;function Uf(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){v(d.message+" ("+c+")")}}a.L=b}
function jc(a,b,c){var d=b.toLowerCase(),d=Sa[b]||Sa[d];void 0===d&&a.L&&(d=a.L[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function Yf(a,b,c){for(var d=bb(a.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:a;if(!lb(f)){lb(f,function(){Yf(a,b,c)});return}}b.call(a,c)}
function Zf(a,b){var c=new H(a,"1.23.3","validate");if(Rf(c)&&Qf(c)){var d=Sf(c,"timestamp"),e=b?Sf(b,"timestamp"):"unknown";d!=e&&(a.ja("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}m=Tf.prototype;
m.Fb=function(a){void 0===a&&(a=this.A||(this.O?1:Vf));if(!this.B){this.B++;var b=!1,c=!1;this.da=!1;var d=this.P||new H(this,"1.23.3");if(-1==a)b=!0;else if(a>Vf){if(Rf(d,this.O)){this.F=new H(this,"1.23.3","failsafe");Rf(this.F)&&($f(this,d),a=2,Of(this.F));I(this.F,"timestamp",oa());Pf(this.F);var e=this.A&&!this.K;if(1==a||ta("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=Qf(d)){var f=Sf(d,"code"),h=Sf(d,"data");f&&("ok"==f?Rf(d,h):("error"==f&&
"no machine state"!=h?(this.ja("Error: "+h),"unable to verify user"==h&&(xa("user",""),this.u=null)):this.g(f+": "+h),Of(d),Rf(d)?(c=Qf(d),e=!0):c=!1))}e&&Zf(this,c?d:null)}else 2==a&&d.clear()}else Zf(this);delete this.O;delete this.P}e=bb(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.b&&(c=ag(this,h,d,b,c));b=[d,a,c];-1!=a?Yf(this,this.rc,b):this.rc(b)}};
function ag(a,b,c,d,e){if(!b.D.sa){b.D.sa=!0;if(b.Ea){var f=null;e&&((f=Sf(c,b.id))||(f=Sf(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.Ea(f,d)&&f&&(v("Unable to restore state for "+b.type),a.ca&&!a.ea?(c.clear(),a.A=Vf,window&&window.location.reload()):a.da=!0,b.Ea(null),e=!1)}if(!d&&b.wc)for(a=b.wc.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
m.rc=function(a){var b=a[0],c=0>a[1];a=a[2];this.ia=!0;this.D.sa=!0;var d=this.M.power;d&&(d.textContent="Shutdown");this.b&&(ag(this,this.b,b,c,a),Ac(this.b));this.da&&($f(this,b),b.clear());!c&&this.F&&(this.F.clear(),delete this.F);this.B=0};
function $f(a,b){if(ta("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.u||"",d=b.toString(),e={app:"PC8080",ver:"1.23.3"};e.url=a.ha;e.user=c;e.type="bug";e.data=d;qa("http://www.pcjs.org/api/v1/report",e,!0)}}
function Mf(a,b,c){var d,e="none";if(a.B)return null;a.B--;var f=new H(a,"1.23.3"),h=new H(a,"1.23.3","validate"),g=oa();I(h,"timestamp",g);I(f,"timestamp",g);I(f,"version","1.23.3");I(f,"url",window?window.location.href:null);I(f,"browser",sa());a.b&&a.b.Ia&&(c&&a.b.na(),d=a.b.Ia(b,c),"object"===typeof d&&I(f,a.b.id,d),c&&(a.b.D.sa=!1,!1===d&&(e=null)));for(var g=bb(a.id),k=0;k<g.length;k++){var l=g[k];l.D.sa&&(l.Ia&&(d=l.Ia(b,c),"object"===typeof d&&I(f,l.id,d)),c&&(l.D.sa=!1,!1===d&&(e=null)))}e&&
(c?(g=d=!1,b?(a.u&&bg(a,a.u,f.toString()),Pf(h)&&Pf(f)||(e=null,d=g=!0)):a.A&&(d=!0,g=3==a.A),d&&f.clear(g)):e=f.toString());c&&(a.D.sa=!1,b=a.M.power)&&(b.textContent="Power");a.B=0;return e}m.reset=function(){this.w&&this.w.reset&&(hb(this,"Resetting "+this.w.type),this.w.reset());for(var a=bb(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.w&&c.reset&&(hb(this,"Resetting "+c.type),c.reset())}};
m.start=function(a,b){for(var c=bb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};m.stop=function(a,b){for(var c=bb(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
m.ma=function(a,b,c){var d=this;switch(b){case "power":return this.M[b]=c,c.onclick=function(){d.B||(d.D.sa?Mf(d,!1,!0):Yf(d,d.Fb))},!0;case "reset":return this.M[b]=c,c.onclick=function(){if(d.D.sa&&!d.B)if(d.A&&!d.N){var a=ta("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");Mf(d,a,!0);!a&&d.ca?window&&window.location.reload():d.Fb(Vf)}else d.reset(),d.b&&Ac(d.b)},!0;case "save":if(ea(ra(),"pcjs.org")){c.parentNode.removeChild(c);
break}this.M[b]=c;c.onclick=function(){var a=Wf(d,!0);if(a){var b=!!(d.A&&!d.N||d.ca),c=Mf(d,b);b?bg(d,a,c):d.ja("Resume disabled, machine state not saved")}};return!0}return!1};
function Wf(a,b){var c=a.u;c||(c=wa("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=cg(a,c))||a.ja("The user ID is invalid."))):b&&a.ja("Browser local storage is not available"));return c}
function cg(a,b){a.u=null;var c=qa(ra()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(xa("user",c.data),a.u=c.data)}catch(e){v(e.message+" ("+d+")")}return a.u}function Xf(a){var b=null;a.u&&(b=ra()+"/api/v1/user?req=load&user="+a.u+"&state="+Nf(a,"1.23.3"));return b}
function bg(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=Nf(a,"1.23.3");d.data=c;b=qa(ra()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.ja("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.ja(c),xa("user",""),a.u=null)}}
function sb(a,b,c){a=bb(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}m.fb=function(a){if(this.J.length){var b=0,c=0;a&&window&&(b=window.scrollX,c=window.scrollY);var d=this.J[0];d.Ca&&d.Ca.focus();a&&window&&window.scrollTo(b,c)}};m.Ja=function(a){this.b&&this.b.Ja(a);this.I&&this.I.Ja(a)};function Gc(a,b){for(var c=0;c<a.J.length;c++)Id(a.J[c],b)}
Ja(function(){for(var a=B(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=y(c),c=B(c,"pc8080","computer"),e=0;e<c.length;e++){var f=c[e],h=y(f),h=new Tf(h,d,!0);fb(h,f);h.Z&&Yf(h,h.Fb)}});Ba.show.push(function(){for(var a=B(document,"pc8080","computer"),b=0;b<a.length;b++){var c=y(a[b]);(c=cb("Computer",c.id))&&c.ia&&!c.D.sa&&c.Fb(-1)}});
Ba.exit.push(function(){for(var a=B(document,"pc8080","computer"),b=0;b<a.length;b++){var c=y(a[b]);(c=cb("Computer",c.id))&&c.D.sa&&Mf(c,!(!c.A||c.N),!0)}});var dg=0;function eg(a,b,c,d,e,f){e("Loading "+a+"...");qa(a,null,!0,function(h,g,k){k?(g||(g="unable to load "+a+" ("+k+")"),f(g,null)):tg(g,a,b,c,d,e,f)})}
function tg(a,b,c,d,e,f,h){function g(a,f){if(f)h(f,null);else{if(c){ab(c,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(p){g=null,a=p.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?ug(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function ug(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=d[2];b("Loading "+e+"...");qa(e,null,!0,function(f,h,g){if(g||!h)c(a,"unable to resolve XML reference: "+d[0]+" ("+g+")");else{if(f=d[3])if(g=h.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var k=g[0],l,q=/( [a-z]+=)(['"])(.*?)\2/g;l=q.exec(f);)k=0>k.indexOf(l[1])?k.replace(">",l[0]+">"):k.replace(new RegExp(l[1]+"(['\"])(.*?)\\1"),l[0]);g[0]!=k&&(h=h.replace(g[0],k))}else{c(a,"missing <"+d[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],h);ug(a,b,c)}})}else c(a,null)}
function vg(a,b,c,d){function e(a){if(void 0===g){var b=h&&B(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=ha(a))}function f(a){e("Error: "+a);k&&(--dg||Ma(!0));k=!1}var h,g,k=!0;dg++;$a[a]={};try{if(h=document.getElementById(a)){var l;if("object"==typeof resources&&(l=resources.css)){var q=document.head||document.getElementsByTagName("head")[0],p=document.createElement("style");p.type="text/css";p.styleSheet?p.styleSheet.cssText=l:p.appendChild(document.createTextNode(l));q.appendChild(p)}c||
(c="/versions/pc8080/1.23.3/components.xsl");l=function(d,g){g?eg(c,null,null,!1,e,function(d,k){if(k)if(ab(a,c,d),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var l=g.transformNode(k);l?(h.outerHTML=l,--dg||Ma(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(l=new XSLTProcessor,l.importStylesheet(k),(l=l.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(l,h),--dg||Ma(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(d)}):f(d)};"<"!=b.charAt(0)?eg(b,a,d,!0,e,l):tg(b,null,a,d,!1,e,l)}else f("missing machine element: "+a)}catch(r){f(r.message)}return k}window.embedPC8080=function(a,b,c,d){Ma(!1);return vg(a,b,c,d)};window.enableEvents=Ma;window.sendEvent=Na;
function wg(a,b,c,d){if(!c&&b){d.push(b);a=$a[d[0]];b=null;for(var e in a)if(ea(e,"components.xsl")){b=e.replace(".xsl",".css");break}b?qa(b,null,!0,function(a,b){xg(b,d)}):xg(null,d)}else v("Error ("+c+") requesting "+a)}
function xg(a,b){var c,d,e,f=b[0],h=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var g=$a[f],k={},l;for(l in g){var q=g[l],p=da(l);if("xml"==p){for(p=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=p.exec(g[l]);){var r=d[2];r&&(g[r]||(q=q.replace(d[0],"")))}d=l=ba(l)}else"xsl"==p&&(e=l=ba(l));k[l]=q}a&&(k[l="css"]=a);b[2]&&(k[l="parms"]=b[2]);b[3]&&(k[l="state"]=b[3]);d&&e?(l=JSON.stringify(k),h+=".js",c=c[1]+"var resources="+l+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),l=h,g=null,k="data:application/javascript,",k=ya("Firefox")?k+encodeURIComponent(c):k+encodeURI(c),l&&(g=document.createElement("a"),"string"!=typeof g.download&&(g=null)),g?(g.href=k,g.download=l,document.body.appendChild(g),g.click(),document.body.removeChild(g),c="Check your Downloads folder for "+l+"."):(window.open(k),c="Check your browser for a new window/tab containing the requested data"+(l?" ("+l+")":"")+"."),c+=', copy it to your web server as "'+h+'", and then add the following to your web page:\n\n',
c+='<div id="'+f+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+h+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+f+'","'+d+'","'+e+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",v(c)):v("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=cb("Computer",a),e=cb("Debugger",a);if(d){var f=Mf(d,!0),h=d.L?JSON.stringify(d.L):null;b||(b="/versions/pcjs/1.23.3/pc"+(e?"-dbg":"")+".js");if(c&&c({state:f,Hc:h}))return!0;qa(b,null,!0,function(c,d,e){wg(c,d,e,[a,ba(b,!0),h,f])});return!0}v("Unable to identify machine '"+a+"'");return!1};})();
