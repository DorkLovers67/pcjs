(function(){var l;function aa(a){var b=16,c;if(a){b||(b=16);if("$"==a.charAt(0))b=16,a=a.substr(1);else if("0x"==a.substr(0,2))b=16,a=a.substr(2);else{var d=a.charAt(a.length-1).toLowerCase();"h"==d?(b=16,d=null):"."==d&&(b=10,d=null);null==d&&(a=a.substr(0,a.length-1))}var e,d=a,f=b;(f&&10!=f?16==f?null!==d.match(/^[0-9a-f]+$/i):2==f&&null!==d.match(/^[01]+$/i):null!==d.match(/^[0-9]+$/))&&!isNaN(e=parseInt(a,b))&&(c=e|0)}return c}
function n(a,b){var c="";void 0===b?b=8:8<b&&(b=8);if(null==a||isNaN(a))for(;0<b--;)c="?"+c;else for(;0<b--;){var d=a&15,d=d+(0<=d&&9>=d?48:55),c=String.fromCharCode(d)+c;a>>=4}return c}function ba(a,b){var c=a,d=a.lastIndexOf("/");0<=d&&(c=a.substr(d+1));d=c.indexOf("&");0<d&&(c=c.substr(0,d));b&&(d=c.lastIndexOf("."),0<d&&(c=c.substring(0,d)));return c}function ca(a){var b="",c=a.lastIndexOf(".");0<=c&&(b=a.substr(c+1).toLowerCase());return b}
function da(a,b){return-1!==a.indexOf(b,a.length-b.length)}var ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function fa(a){return a.replace(/[&<>"']/g,function(a){return ea[a]})}function ga(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}
var ha={0:"NUL",1:"SOH",2:"STX",3:"ETX",4:"EOT",5:"ENQ",6:"ACK",7:"BEL",8:"BS",9:"TAB",10:"LF",11:"VT",12:"FF",13:"CR",14:"SO",15:"SI",16:"DLE",17:"DC1",18:"DC2",19:"DC3",20:"DC4",21:"NAK",22:"SYN",23:"ETB",24:"CAN",25:"EM",26:"SUB",27:"ESC",28:"FS",29:"GS",30:"RS",31:"US"},ia=Date.now||function(){return+new Date};
function ja(){function a(a){return(10>a?"0":"")+a}var b=new Date;return b.getFullYear()+"-"+a(b.getMonth()+1)+"-"+a(b.getDate())+" "+a(b.getHours())+":"+a(b.getMinutes())+":"+a(b.getSeconds())}
function p(a,b,c,d){var e=0,f=null,h=null;if("object"==typeof resources&&(f=resources[a]))return d&&d(a,f,e),[f,e];if(c&&"function"==typeof resources)return resources(a,function(b,c){d&&d(a,b,c)}),h;var g=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");c&&(g.onreadystatechange=function(){4===g.readyState&&(f=g.responseText,200==g.status||!g.status&&f.length&&"file:"==(window?window.location.protocol:"file:")||(e=g.status||-1),d&&d(a,f,e))});if(b&&"object"==
typeof b){var k="",m;for(m in b)b.hasOwnProperty(m)&&(k&&(k+="&"),k+=m+"="+encodeURIComponent(b[m]));k=k.replace(/%20/g,"+");g.open("POST",a,!!c);g.setRequestHeader("Content-type","application/x-www-form-urlencoded");g.send(k)}else g.open("GET",a,!!c),"bytes"==b&&g.overrideMimeType("text/plain; charset=x-user-defined"),g.send();c||(f=g.responseText,200!=g.status&&(e=g.status||-1),d&&d(a,f,e),h=[f,e]);return h}function ka(){return"http://"+(window?window.location.host:"www.pcjs.org")}
function q(a){window&&window.alert(a)}function ma(a){var b=!1;window&&(b=window.confirm(a));return b}var na=null;function oa(){if(null==na){var a=!1;if(window)try{window.localStorage.setItem("PCjs.localStorage","PCjs.localStorage"),a="PCjs.localStorage"==window.localStorage.getItem("PCjs.localStorage"),window.localStorage.removeItem("PCjs.localStorage")}catch(b){a=!1}na=a}return na}function pa(a){var b;if(window)try{b=window.localStorage.getItem(a)}catch(c){}return b}
function qa(a,b){try{return window.localStorage.setItem(a,b),!0}catch(c){}return!1}function ra(a){if(window){var b=window?window.navigator.userAgent:"";return"iOS"==a&&b.match(/(iPod|iPhone|iPad)/)&&b.match(/AppleWebKit/)||"MSIE"==a&&b.match(/(MSIE|Trident)/)||0<=b.indexOf(a)?!0:!1}return!1}var sa={init:[],show:[],exit:[]},ta=!1,ua=!0;function va(a,b){if(window){var c=window[a];window[a]="function"!==typeof c?b:function(){c&&c();b()}}}function wa(a){sa.init.push(a)}
function xa(a){if(ua)try{for(var b=0;b<a.length;b++)a[b]()}catch(c){ya("An unexpected exception occurred:\n\n"+c.message+"\n\nPlease send this information to support@pcjs.org. Thanks.",void 0,void 0)}}function za(a){!ua&&a?(ua=!0,ta&&Aa("init")):ua=a}function Aa(a){sa[a]&&xa(sa[a])}va("onload",function(){ta=!0;xa(sa.init)});va("onpageshow",function(){xa(sa.show)});va(ra("Opera")||ra("iOS")?"onunload":"onbeforeunload",function(){xa(sa.exit)});
function r(a,b,c){this.type=a;b||(b={id:"",name:""});this.id=b.id;this.name=b.name;this.wb=b.comment;this.Xb=b;void 0===this.id&&(this.id="");b=this.id.indexOf(".");0<b?(this.jb=this.id.substr(0,b),this.Qa=this.id.substr(b+1)):this.Qa=this.id;this[a]=c;this.j={fa:!1,Fa:!1,mb:!1,V:!1,ra:!1};this.Wa=null;this.j.ra=!1;this.B={};this.N=null;w.push(this)}var Ba=void 0,Ca={};
if(window){Ba||(Ba=window.location.search.substr(1));for(var Ea,Fa=/\+/g,Ga=/([^&=]+)=?([^&]*)/g;Ea=Ga.exec(Ba);)Ca[decodeURIComponent(Ea[1].replace(Fa," "))]=decodeURIComponent(Ea[2].replace(Fa," "))}function Ha(a){function b(){}if(window){if(!a)throw new TypeError;if(Object.create)return Object.create(a);var c=typeof a;if("object"!==c&&"function"!==c)throw new TypeError;}b.prototype=a;return new b}
function y(a,b){b||(b=r);a.prototype=Ha(b.prototype);a.prototype.constructor=a;a.prototype.parent=b.prototype}var w=[],Ia={};function Ja(a,b,c){Ia[a]&&b&&(Ia[a][b]=c)}function ya(a,b,c){b||q((c?c+": ":"")+a)}function Ka(a){var b,c=[];a&&(a=0<(b=a.indexOf("."))?a.substr(0,b+1):"");for(b=0;b<w.length;b++){var d=w[b];a&&d.id.indexOf(a)||c.push(d)}return c}function La(a){if(void 0!==a){var b;for(b=0;b<w.length;b++)if(w[b].id===a)return w[b]}return null}
function Ma(a,b){var c;if(void 0!==a){var d;b&&(b=0<(d=b.indexOf("."))?b.substr(0,d+1):"");for(d=0;d<w.length;d++)if(c)c==w[d]&&(c=null);else if(!(a!=w[d].type||b&&w[d].id.indexOf(b)))return w[d]}return null}function z(a){var b=null;if(a=a.getAttribute("data-value"))try{b=eval("("+a+")")}catch(c){q(c.message+" ("+a+")")}return b}
function Na(a,b){for(var c=A(b.parentNode,"pc8080-control"),d=0;d<c.length;d++)for(var e=c[d].childNodes,f=0;f<e.length;f++){var h=e[f];if(1===h.nodeType){var g=h.getAttribute("class");if(g)for(var k=g.split(" "),m=0;m<k.length;m++)switch(g=k[m],g){case "pc8080-binding":(g=z(h))&&g.binding&&a.S(g.type,g.binding,h,g.value),m=k.length}}}}
function A(a,b,c){c&&(b+="-"+c+"-object");if(a.getElementsByClassName)return a.getElementsByClassName(b);var d;c=[];a=a.getElementsByTagName("*");var e=new RegExp("(^| )"+b+"( |$)");b=0;for(d=a.length;b<d;b++)e.test(a[b].className)&&c.push(a[b]);return c}
r.prototype={constructor:r,parent:null,toString:function(){return this.name?this.name:this.id||this.type},S:function(a,b,c){switch(b){case "clear":return this.B[b]||(this.B[b]=c,c.onclick=function(a){return function(){a.B.print&&(a.B.print.value="")}}(this)),!0;case "print":return this.B[b]||(this.na=this.B[b]=c,c.value="",this.ba=function(a){return function(b,c){8192<a.value.length&&(a.value=a.value.substr(a.value.length-4096));a.value+=(void 0!==c?c+": ":"")+(b||"")+"\n";a.scrollTop=a.scrollHeight}}(c),
this.M=function(a){this.ba(a,this.Qa)}),!0;default:return!1}},log:function(){},ba:function(){},status:function(a){this.ba(this.Qa+": "+a)},M:function(a,b,c){ya(a,b,c||this.type)},ca:function(){return this.j.V=!0},ga:function(a,b){b&&(this.j.V=!1);return!0}};function Oa(a,b){if(a.j.mb)return a.j.Fa&&(a.j.Fa=!1),a.j.mb=!1;if(a.j.ra)return a.ba(a.toString()+" error"),!1;a.j.Fa=b;return a.j.Fa}function D(a){if(!a.j.ra&&(a.j.fa=!0,a.j.fa)){var b=a.Wa;a.Wa=null;b&&b()}}
function Pa(a,b){b&&(a.j.fa?b():a.Wa=b);return a.j.fa}
var Qa="undefined"!==typeof ArrayBuffer,Ra=[1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,
0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1];function Sa(a){r.call(this,"Panel",a,Sa)}y(Sa);l=Sa.prototype;l.S=function(a,b,c,d){return this.l&&this.l.S(a,b,c,d)||this.a&&this.a.S(a,b,c,d)||this.o&&this.o.S(a,b,c,d)?!0:this.parent.S.call(this,a,b,c,d)};l.la=function(a,b,c,d){this.l=a;this.m=b;this.a=c;this.N=d;this.o=E(a,"Keyboard")};l.ca=function(a,b){b||Ta();return!0};l.ga=function(){return!0};l.wa=function(){};
function Ta(){for(var a=!1,b=A(document,"pc8080","panel"),c=0;c<b.length;c++){var d=b[c],e=z(d),f=La(e.id);f||(a=!0,f=new Sa(e));Na(f,d);a&&D(f)}}wa(Ta);
function Ua(a,b,c){r.call(this,"Bus",a,Ua);this.a=b;this.N=c;this.h=a.busWidth||16;this.v=Math.pow(2,this.h);this.f=this.v-1|0;this.c=16>=this.h?10:20>=this.h?12:24>=this.h?14:15;this.m=1<<this.c;this.w=this.m>>2;this.l=this.m-1;this.i=this.v/this.m|0;this.u=this.i-1;this.o=[];this.s=[];this.A=[];this.C=[];a=new F;Va(a,this.N);this.b=Array(this.i);for(b=0;b<this.i;b++)this.b[b]=a;D(this)}y(Ua);Ua.prototype.reset=function(){};Ua.prototype.ca=function(a,b){b||this.reset();return!0};
function Wa(a,b,c,d){for(var e=b,f=c,h=e>>>a.c;0<f&&h<a.b.length;){var g=a.b[h],k=h*a.m,m=a.m-(e-k);m>f&&(m=f);if(g&&g.size){if(g.type==d){if(e+f<=g.Ea)return g.eb+=g.Ea-e,g.Ea=e,!0;if(e>=g.Ea+g.eb){m=g.size-(e-k);m>f&&(m=f);g.eb=e-g.Ea+m;e=k+a.m;f-=m;h++;continue}}return Xa(1,e,f)}e=new F(e,m,a.m,d);Va(e,a.N,g);a.b[h++]=e;e=k+a.m;f-=m}return 0>=f?(a.status(Math.floor(c/1024)+"Kb "+Ya[d]+" at "+("0x"+n(b,4))),!0):Xa(2,b,c)}
Ua.prototype.K=function(a){return this.b[(a&this.f)>>>this.c].Na(a&this.l,a)};function Za(a,b){return a.b[(b&a.f)>>>a.c].cb(b&a.l,b)}function $a(a,b){var c=b&a.l,d=(b&a.f)>>>a.c;return c!=a.l?a.b[d].jd(c,b):a.b[d++].Na(c,b)|a.b[d&a.u].Na(0,b+1)<<8}Ua.prototype.W=function(a,b){this.b[(a&this.f)>>>this.c].Oa(a&this.l,b&255,a)};function ab(a,b,c){a.b[(b&a.f)>>>a.c].$b(b&a.l,c&255,b)}
function bb(a,b,c){var d=b&a.l,e=(b&a.f)>>>a.c;d!=a.l?a.b[e].kd(d,c&65535,b):(a.b[e++].Oa(d,c&255,b),a.b[e&a.u].Oa(0,c>>8&255,b+1))}function cb(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,h=+e+d,g=c[e].bind(b);if(void 0!==g)for(var k=+e+d;k<=h;k++)void 0!==f.o[k]?q("Input port 0x"+n(k,4)+" already registered"):f.o[k]=[g,!1]}}
function db(a,b,c,d){void 0===d&&(d=0);if(c)for(var e in c){var f=a,h=+e+d,g=c[e].bind(b);if(void 0!==g)for(var k=+e+d;k<=h;k++)void 0!==f.s[k]?q("Output port 0x"+n(k,4)+" already registered"):f.s[k]=[g,!1]}}function Xa(a,b,c){q("Memory block error ("+a+": "+n(b)+","+n(c)+")");return!1}var eb;if(Qa){var fb=new ArrayBuffer(2);(new DataView(fb)).setUint16(0,256,!0);eb=256===(new Uint16Array(fb))[0]}else eb=!1;var hb=eb;
function F(a,b,c,d){this.id=ib+=2;this.a=null;this.Ea=a;this.eb=b;this.size=c||0;this.type=d||jb;this.B=d==kb;Va(this);this.ja=this.Nb=!1;if(c)if(Qa)this.c=new ArrayBuffer(c),this.m=new DataView(this.c,0,c),this.b=new Uint8Array(this.c,0,c),this.h=new Uint16Array(this.c,0,c>>1),this.a=new Int32Array(this.c,0,c>>2),lb(this,hb?mb:nb);else{this.a=Array(c>>2);for(a=0;a<this.a.length;a++)this.a[a]=0;lb(this,ob)}else lb(this)}var jb=0,kb=2,Ya=["NONE","RAM","ROM","VID","H/W"],ib=0;
F.prototype={constructor:F,parent:null,save:function(){var a,b;if(Qa)for(a=Array(this.size>>2),b=0;b<a.length;b++)a[b]=this.m.getInt32(b<<2,!0);else a=this.a;return a},restore:function(a){if(a&&this.size==a.length<<2){var b;if(Qa)for(b=0;b<a.length;b++)this.m.setInt32(b<<2,a[b],!0);else this.a=a;return this.ja=!0}return!1},i:function(){return 255},s:function(){},o:function(a,b){return this.Na(a++,b++)|this.Na(a,b)<<8},u:function(a,b,c){this.Oa(a++,b&255,c++);this.Oa(a,b>>8,c)},C:function(a){return this.a[a>>
2]>>>((a&3)<<3)&255},I:function(a){var b=a>>2;a=(a&3)<<3;var c=this.a[b]>>a;return 24>a?c&65535:c&255|(this.a[b+1]&255)<<8},U:function(a,b){var c=a>>2,d=(a&3)<<3;this.a[c]=this.a[c]&~(255<<d)|b<<d;this.ja=!0},ma:function(a,b){var c=a>>2,d=(a&3)<<3;24>d?this.a[c]=this.a[c]&~(65535<<d)|b<<d:(this.a[c]=this.a[c]&16777215|b<<24,c++,this.a[c]=this.a[c]&-256|b>>8);this.ja=!0},w:function(a,b){return this.cb(a,b)},H:function(a,b){return this.Yb(a,b)},O:function(a,b,c){this.B||this.$b(a,b,c)},$:function(a,
b,c){this.B||this.aa(a,b,c)},v:function(a){return this.b[a]},A:function(a){return this.b[a]},G:function(a){return this.m.getUint16(a,!0)},L:function(a){return a&1?this.b[a]|this.b[a+1]<<8:this.h[a>>1]},J:function(a,b){this.b[a]=b;this.ja=!0},T:function(a,b){this.b[a]=b;this.ja=!0},Z:function(a,b){this.m.setUint16(a,b,!0);this.ja=!0},da:function(a,b){a&1?(this.b[a]=b,this.b[a+1]=b>>8):this.h[a>>1]=b;this.ja=!0}};
function Va(a,b,c){a.N=b;a.l=a.f=0;c&&((a.l=c.l)&&pb(a,qb,!1),(a.f=c.f)&&rb(a,qb,!1))}function rb(a,b,c){c&&a.f||(a.Oa=!a.B&&b[2]||a.s,a.kd=!a.B&&b[3]||a.u);if(c||void 0===c)a.$b=b[2]||a.s,a.aa=b[3]||a.u}function pb(a,b,c){c&&a.l||(a.Na=b[0]||a.i,a.jd=b[1]||a.o);if(c||void 0===c)a.cb=b[0]||a.i,a.Yb=b[1]||a.o}function lb(a,b){b||(b=sb);pb(a,b,void 0);rb(a,b,void 0)}var sb=[],ob=[F.prototype.C,F.prototype.I,F.prototype.U,F.prototype.ma],qb=[F.prototype.w,F.prototype.H,F.prototype.O,F.prototype.$];
if(Qa)var nb=[F.prototype.v,F.prototype.G,F.prototype.J,F.prototype.Z],mb=[F.prototype.A,F.prototype.L,F.prototype.T,F.prototype.da];
function tb(a,b){r.call(this,"CPU",a,tb);var c=a.cycles||b,d=a.multiplier||1;this.b={};this.b.va=c;this.b.$a=0;this.b.ua=d;this.b.ob=Math.round(this.b.va/1E4)/100;this.b.za=this.b.ob*this.b.ua;this.j.ka=!1;this.j.Pb=!1;this.j.Mb=a.autoStart;this.j.Ob=!1;this.j.Ua=!1;this.b.Ya=this.b.Ba=0;this.b.Za=a.csStart;this.b.Ga=a.csInterval;this.b.Ha=a.csStop;this.H=[];this.ma=this.ub.bind(this);D(this)}y(tb);var ub=["power","reset"];l=tb.prototype;
l.la=function(a,b,c,d){this.l=a;this.m=b;this.N=d;for(b=0;b<ub.length;b++)(c=this.B[ub[b]])&&this.l.S(null,ub[b],c);this.U=(b=E(a,"Video"))&&Math.max(b.Tc,b.lb)||60;this.L=E(a,"ChipSet");a=vb(a,"autoStart");null!=a&&(this.j.Mb="true"==a?!0:"false"==a?!1:!!a);D(this)};l.reset=function(){this.b.$a=0};l.save=function(){return null};l.restore=function(){return!1};
l.ca=function(a,b){if(!b){if(a&&this.restore){wb(this);if(!this.restore(a))return!1;xb(this)}else this.reset();this.ba("No debugger detected")}yb(this);return!0};l.ga=function(a){return a?this.save():!0};function zb(a){(a.j.Mb||void 0===a.B.run)&&a.ub(!0)}l.Sb=function(){return 0};function xb(a){void 0===a.b.Za&&(a.b.Za=0);void 0===a.b.Ga&&(a.b.Ga=-1);void 0===a.b.Ha&&(a.b.Ha=-1);a.j.Ua=0<=a.b.Za&&0<a.b.Ga;a.j.Ua&&(a.b.Ya=0,a.b.Ba=a.b.Za-a.O)}
l.S=function(a,b,c){var d=this;a=!1;switch(b){case "power":case "reset":this.B[b]=c;a=!0;break;case "run":this.B[b]=c;c.onclick=function(){var a;if(a=d.l)if(a=d.l,a.j.V)a=!0;else{var b=null,c,g=Ka(a.id);for(c=0;c<g.length&&(b=g[c],b===a||b.j.fa);c++);if(c==g.length)for(c=0;c<g.length&&(b=g[c],b===a||b.j.V);c++);c==g.length&&(b=a);q("The "+b.type+" component ("+b.id+") is not "+(b.j.fa?"powered yet":"ready yet"+(b.Wa?" (waiting for notification)":""))+".");a=!1}a&&(d.j.ka?Ab(d,!0):d.ub(!0))};a=!0;
break;case "speed":this.B[b]=c;a=!0;break;case "setSpeed":this.B[b]=c,c.onclick=function(){Bb(d,d.b.ua<<1,!0)},c.textContent=this.b.za.toFixed(2)+"Mhz",a=!0}return a};function Cb(a,b,c){a.O+=b;c&&(a.J=a.a=0)}
function Db(a,b){var c=30;c<a.U&&(c=a.U);2>c&&(c=2);var d=1;b&&1<a.b.ua&&a.b.sa&&(d=a.b.sa/a.b.ob);a.b.Ub=Math.round(1E3/30);a.b.Uc=Math.floor(a.b.va/c*d);a.b.qb=Math.floor(a.b.va/30*d);a.b.Wb=Math.floor(a.b.va/a.U*d);a.b.Vb=Math.floor(a.b.va/2*d);b||(a.b.Ka=a.b.qb,a.b.Ja=a.b.Wb,a.b.Ia=a.b.Vb);a.b.rb=0}function Eb(a){return a.O+a.I+a.J-a.a}function wb(a){a.b.sa=0;a.O=a.I=a.J=a.a=0;xb(a);Bb(a,1)}
function Bb(a,b,c){if(void 0!==b){.8>a.b.sa/a.b.za&&(b=1);a.b.ua=b;b=a.b.ob*a.b.ua;if(a.b.za!=b){a.b.za=b;b=a.b.za.toFixed(2)+"Mhz";var d=a.B.setSpeed;d&&(d.textContent=b);a.ba("target speed: "+b)}c&&a.l&&Fb(a.l)}Cb(a,a.I);a.I=0;a.b.Aa=ia();a.b.ta=0;Db(a)}function Gb(a,b){var c=a.H.length;a.H.push([-1,b]);return c}function Hb(a,b,c){var d=-1;0<=b&&b<a.H.length&&(d=a.b.va*a.b.ua/1E3*c,a.H[b][0]=d)}
l.ub=function(a){if(Oa(this,!0)){if(!this.j.ka){Bb(this);this.l&&this.l.start(this.b.Aa,Eb(this));this.j.ka=!0;this.j.Pb=!0;this.L&&this.L.start();var b=this.B.run;b&&(b.textContent="Halt");this.l&&(this.l.wa(!0),a&&Fb(this.l,!0))}this.b.rb>=this.b.va&&Db(this,!0);this.b.La=0;this.b.Xa=ia();this.b.ta&&(a=this.b.Xa-this.b.ta,a>this.b.Ub&&(this.b.Aa+=a,this.b.Aa>this.b.Xa&&(this.b.Aa=this.b.Xa)));try{do{var c=this.j.Ua?1:this.b.Uc;a=c;for(b=0;b<this.H.length;b++){var d=this.H[b];0>d[0]||a>d[0]&&(a=
d[0])}c=a;this.Zb(c);var e=this.J-this.a;a=e;for(b=0;b<this.H.length;b++){var f=this.H[b];0>f[0]||(f[0]-=a,0>=f[0]&&(f[0]=-1,f[1]()))}this.b.La+=e;this.I+=e;Cb(this,0,!0);a=e;this.j.Ua&&(b=!1,this.b.Ya=this.b.Ya+this.Sb()|0,this.b.Ba-=a,0>=this.b.Ba&&(this.b.Ba+=this.b.Ga,b=!0),0<=this.b.Ha&&this.b.Ha<=Eb(this)&&(this.b.Ga=this.b.Ha=-1,xb(this),Ab(this),b=!0),b&&this.ba(Eb(this)+" cycles: checksum="+n(this.b.Ya)));this.b.Ja-=e;0>=this.b.Ja&&(this.b.Ja+=this.b.Wb,this.l&&Ib(this.l,this.b.$a++),this.b.$a>
this.U&&(this.b.$a=0));this.b.Ia-=e;0>=this.b.Ia&&(this.b.Ia+=this.b.Vb,this.l&&this.l.wa());this.b.Ka-=e;if(0>=this.b.Ka){this.b.Ka+=this.b.qb;break}}while(this.j.ka)}catch(h){Ab(this);yb(this);this.l&&this.l.stop(ia(),Eb(this));Oa(this,!1);c=h.stack||h.message;this.j.ra=!0;this.M(c);return}c=setTimeout;d=this.ma;this.b.ta=ia();e=this.b.Ub;this.b.La&&(e=Math.round(e*this.b.La/this.b.qb));e-=this.b.ta-this.b.Xa;if(f=this.b.ta-this.b.Aa)this.b.sa=Math.round(this.I/(10*f))/100,864E5<=f&&(this.O=0,Bb(this));
if(0>e||this.b.sa<this.b.za)e=0;this.b.rb+=this.b.La;this.b.ta+=e;c(d,e)}else yb(this),this.l&&this.l.stop(ia(),Eb(this))};l.Zb=function(){return 0};function Ab(a,b){a.j.Fa&&(a.j.mb=!0);a.J-=a.a;a.a=0;Cb(a,a.I);a.I=0;if(a.j.ka){a.j.ka=!1;a.L&&a.L.stop();var c=a.B.run;c&&(c.textContent="Run")}a.j.Va=b}function yb(a){a.l&&(Ib(a.l,-1),a.l.wa(void 0))}function Kb(a){this.da=+a.model||8080;tb.call(this,a,1E6);this.Z=Lb;wb(this);this.j.Va=this.j.Gc=!1;this.aa=0;this.T=[];this.$=0;Mb(this)}y(Kb,tb);
function Nb(a,b){a.T.push(b)}l=Kb.prototype;l.reset=function(){this.j.ka&&Ab(this);Mb(this);wb(this);this.j.ra=!1;this.parent.reset.call(this)};function Mb(a){a.c=0;a.f=0;a.D=0;a.h=0;a.F=0;a.i=0;a.o=0;a.w=0;G(a,a.$);Ob(a,0);a.C=0}function Pb(a,b){a.$=b;G(a,b)}l.Sb=function(){var a=this.c+this.f+this.D+this.h+this.F+this.i+this.o|0;return a=a+this.w+this.u+Qb(this)|0};
l.save=function(){var a=new I(this);J(a,0,[this.c,this.f,this.D,this.h,this.F,this.i,this.o,this.w,this.u,Qb(this)]);J(a,1,[this.C,this.O,this.b.ua]);for(var b=this.m,c=0,d=[],e=0;e<b.i;e++){var f=b.b[e];if(f.ja||f.Nb){d[c++]=e;var h=c++;a:if(f=f.save()){for(var g=0,k=0,m=[];g<f.length;){for(var v=f[g],u=g+1;u<f.length&&f[u]===v;)u++;m[k++]=u-g;m[k++]=v;g=u}if(m.length<f.length){f=m;break a}}d[h]=f}}J(a,2,d);return a.data()};
l.restore=function(a){var b=a[0];this.c=b[0];this.f=b[1];this.D=b[2];this.h=b[3];this.F=b[4];this.i=b[5];this.o=b[6];this.w=b[7]&65535;G(this,b[8]);Ob(this,b[9]);b=a[1];this.C=b[0];this.O=b[1];Bb(this,b[3]);a:{b=this.m;a=a[2];var c;for(c=0;c<a.length-1;c+=2){var d=a[c],e=a[c+1];if(e&&e.length<b.w){for(var f=0,h=Array(b.w),g=0;g<e.length-1;)for(var k=e[g++],m=e[g++];k--;)h[f++]=m;e=h}f=b.b[d];if(!f||!f.restore(e)){q("Unable to restore memory block "+d);b=!1;break a}}b=!0}return b};
l.S=function(a,b,c){var d=!1;switch(b){case "A":case "B":case "C":case "BC":case "D":case "E":case "DE":case "H":case "L":case "HL":case "SP":case "PC":case "PS":case "IF":case "SF":case "ZF":case "AF":case "PF":case "CF":this.B[b]=c;this.aa++;d=!0;break;default:d=this.parent.S.call(this,a,b,c)}return d};function Rb(a){return a.f<<8|a.D}function Sb(a,b){a.f=b>>8&255;a.D=b&255}function Tb(a){return a.h<<8|a.F}function Ub(a,b){a.h=b>>8&255;a.F=b&255}function K(a){return a.i<<8|a.o}
function L(a,b){a.i=b>>8&255;a.o=b&255}function G(a,b){a.u=b&65535}function M(a){return a.s&256?1:0}function N(a,b){a.s=a.s&255|b}function Vb(a){return Ra[a.v&255]?4:0}function Qb(a){return a.G&-214|(a.v&128?128:0)|(a.s&255?0:64)|((a.v^a.A)&16?16:0)|Vb(a)|M(a)}function Ob(a,b){a.s=a.v=a.A=0;b&1&&(a.s|=256);b&4||(a.v|=1);b&16&&(a.A|=16);b&64||(a.s|=255);b&128&&(a.v^=192);a.G=a.G&-726|b&512|2}function Wb(a,b){a.A=a.c^b;return a.v=(a.s=a.c+b)&255}
function Xb(a,b){a.A=a.c^b;return a.v=(a.s=a.c+b+(a.s&256?1:0))&255}function Yb(a,b){a.s=a.v=a.A=a.c&b;(a.c|b)&8&&(a.A^=16);return a.s}function Zb(a,b){a.A=b^255;b=a.v=b+255&255;a.s=a.s&-256|b;return b}function $b(a,b){a.A=b;b=a.v=b+1&255;a.s=a.s&-256|b;return b}function ac(a,b){return a.v=a.s=a.A=a.c|b}function O(a,b){b^=255;a.A=a.c^b;return a.v=(a.s=a.c+b+1^256)&255}function bc(a,b){b^=255;a.A=a.c^b;return a.v=(a.s=a.c+b+(a.s&256?0:1)^256)&255}function cc(a,b){return a.v=a.s=a.A=a.c^b}l.K=function(a){return this.m.K(a)};
l.W=function(a,b){this.m.W(a,b)};function P(a){var b=a.K(a.u);G(a,a.u+1);return b}function R(a){var b=$a(a.m,a.u);G(a,a.u+2);return b}function S(a){var b=$a(a.m,a.w);a.w=a.w+2&65535;return b}function T(a,b){a.w=a.w-2&65535;bb(a.m,a.w,b)}function dc(a,b){a.C|=1<<b}function U(a,b,c,d){d=d||2;a.B[b]&&(void 0===c&&(a.j.ra=!0,a.M("Value for "+b+" is invalid"),Ab(a)),c=!a.j.ka||a.j.Ob?n(c,d):"--------".substr(0,d),a.B[b].textContent!=c&&(a.B[b].textContent=c))}
l.wa=function(a){this.aa&&(a||!this.j.ka||this.j.Ob)&&(U(this,"A",this.c),U(this,"B",this.f),U(this,"C",this.D),U(this,"BC",Rb(this),4),U(this,"D",this.h),U(this,"E",this.F),U(this,"DE",Tb(this),4),U(this,"H",this.i),U(this,"L",this.o),U(this,"HL",K(this),4),U(this,"SP",this.w,4),U(this,"PC",this.u,4),a=Qb(this),U(this,"PS",a,4),U(this,"IF",a&512?1:0,1),U(this,"SF",a&128?1:0,1),U(this,"ZF",a&64?1:0,1),U(this,"AF",a&16?1:0,1),U(this,"PF",a&4?1:0,1),U(this,"CF",a&1?1:0,1));if(a=this.B.speed)a.textContent=
this.j.ka&&this.b.sa?this.b.sa.toFixed(2)+"Mhz":"Stopped"};l.Zb=function(a){this.j.Va=!0;this.j.Gc=!1;this.j.Pb=!1;this.J=this.a=a;do{if(this.C){if(a&&this.C&255&&this.G&512){for(var b=0;8>b&&!(this.C&1<<b);b++);this.C&=~(0>b?255:1<<b);this.G&=-513;this.C&=-257;this.Z[199|b<<3].call(this)}if(this.C&256){this.a=0;break}}this.Z[P(this)].call(this)}while(0<this.a);return this.j.Va?this.J-this.a:void 0===this.j.Va?0:-1};
wa(function(){for(var a=A(document,"pc8080","cpu"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new Kb(d);Na(d,c)}});function ec(){this.a-=4}function fc(){G(this,R(this));this.a-=10}function gc(){G(this,S(this));this.a-=10}function hc(){var a=R(this);T(this,this.u);G(this,a);this.a-=17}
var Lb=[ec,function(){Sb(this,R(this));this.a-=10},function(){this.W(Rb(this),this.c);this.a-=7},function(){Sb(this,Rb(this)+1);this.a-=5},function(){this.f=$b(this,this.f);this.a-=5},function(){this.f=Zb(this,this.f);this.a-=5},function(){this.f=P(this);this.a-=7},function(){var a=this.c<<1;this.c=a&255|a>>8;N(this,a&256);this.a-=4},ec,function(){var a;L(this,a=K(this)+Rb(this));N(this,a>>8&256);this.a-=10},function(){this.c=this.K(Rb(this));this.a-=7},function(){Sb(this,Rb(this)-1);this.a-=5},function(){this.D=
$b(this,this.D);this.a-=5},function(){this.D=Zb(this,this.D);this.a-=5},function(){this.D=P(this);this.a-=7},function(){var a=this.c<<8&256;this.c=(a|this.c)>>1;N(this,a);this.a-=4},ec,function(){Ub(this,R(this));this.a-=10},function(){this.W(Tb(this),this.c);this.a-=7},function(){Ub(this,Tb(this)+1);this.a-=5},function(){this.h=$b(this,this.h);this.a-=5},function(){this.h=Zb(this,this.h);this.a-=5},function(){this.h=P(this);this.a-=7},function(){var a=this.c<<1;this.c=a&255|M(this);N(this,a&256);
this.a-=4},ec,function(){var a;L(this,a=K(this)+Tb(this));N(this,a>>8&256);this.a-=10},function(){this.c=this.K(Tb(this));this.a-=7},function(){Ub(this,Tb(this)-1);this.a-=5},function(){this.F=$b(this,this.F);this.a-=5},function(){this.F=Zb(this,this.F);this.a-=5},function(){this.F=P(this);this.a-=7},function(){var a=this.c<<8;this.c=(M(this)<<8|this.c)>>1;N(this,a&256);this.a-=4},ec,function(){L(this,R(this));this.a-=10},function(){var a=R(this);bb(this.m,a,K(this));this.a-=16},function(){L(this,
K(this)+1);this.a-=5},function(){this.i=$b(this,this.i);this.a-=5},function(){this.i=Zb(this,this.i);this.a-=5},function(){this.i=P(this);this.a-=7},function(){var a=0,b=M(this);if((this.v^this.A)&16||9<(this.c&15))a|=6;if(b||154<=this.c)a|=96,b=1;this.c=Wb(this,a);N(this,b?256:0);this.a-=4},ec,function(){var a;L(this,a=K(this)+K(this));N(this,a>>8&256);this.a-=10},function(){var a;a=R(this);a=$a(this.m,a);L(this,a);this.a-=16},function(){L(this,K(this)-1);this.a-=5},function(){this.o=$b(this,this.o);
this.a-=5},function(){this.o=Zb(this,this.o);this.a-=5},function(){this.o=P(this);this.a-=7},function(){this.c=~this.c&255;this.a-=4},ec,function(){this.w=R(this)&65535;this.a-=10},function(){this.W(R(this),this.c);this.a-=13},function(){this.w=this.w+1&65535;this.a-=5},function(){var a=K(this);this.W(a,$b(this,this.K(a)));this.a-=10},function(){var a=K(this);this.W(a,Zb(this,this.K(a)));this.a-=10},function(){this.W(K(this),P(this));this.a-=10},function(){this.s|=256;this.a-=4},ec,function(){var a;
L(this,a=K(this)+this.w);N(this,a>>8&256);this.a-=10},function(){this.c=this.K(R(this));this.a-=13},function(){this.w=this.w-1&65535;this.a-=5},function(){this.c=$b(this,this.c);this.a-=5},function(){this.c=Zb(this,this.c);this.a-=5},function(){this.c=P(this);this.a-=7},function(){N(this,M(this)?0:256);this.a-=4},function(){this.a-=5},function(){this.f=this.D;this.a-=5},function(){this.f=this.h;this.a-=5},function(){this.f=this.F;this.a-=5},function(){this.f=this.i;this.a-=5},function(){this.f=this.o;
this.a-=5},function(){this.f=this.K(K(this));this.a-=7},function(){this.f=this.c;this.a-=5},function(){this.D=this.f;this.a-=5},function(){this.a-=5},function(){this.D=this.h;this.a-=5},function(){this.D=this.F;this.a-=5},function(){this.D=this.i;this.a-=5},function(){this.D=this.o;this.a-=5},function(){this.D=this.K(K(this));this.a-=7},function(){this.D=this.c;this.a-=5},function(){this.h=this.f;this.a-=5},function(){this.h=this.D;this.a-=5},function(){this.a-=5},function(){this.h=this.F;this.a-=
5},function(){this.h=this.i;this.a-=5},function(){this.h=this.o;this.a-=5},function(){this.h=this.K(K(this));this.a-=7},function(){this.h=this.c;this.a-=5},function(){this.F=this.f;this.a-=5},function(){this.F=this.D;this.a-=5},function(){this.F=this.h;this.a-=5},function(){this.a-=5},function(){this.F=this.i;this.a-=5},function(){this.F=this.o;this.a-=5},function(){this.F=this.K(K(this));this.a-=7},function(){this.F=this.c;this.a-=5},function(){this.i=this.f;this.a-=5},function(){this.i=this.D;this.a-=
5},function(){this.i=this.h;this.a-=5},function(){this.i=this.F;this.a-=5},function(){this.a-=5},function(){this.i=this.o;this.a-=5},function(){this.i=this.K(K(this));this.a-=7},function(){this.i=this.c;this.a-=5},function(){this.o=this.f;this.a-=5},function(){this.o=this.D;this.a-=5},function(){this.o=this.h;this.a-=5},function(){this.o=this.F;this.a-=5},function(){this.o=this.i;this.a-=5},function(){this.a-=5},function(){this.o=this.K(K(this));this.a-=7},function(){this.o=this.c;this.a-=5},function(){this.W(K(this),
this.f);this.a-=7},function(){this.W(K(this),this.D);this.a-=7},function(){this.W(K(this),this.h);this.a-=7},function(){this.W(K(this),this.F);this.a-=7},function(){this.W(K(this),this.i);this.a-=7},function(){this.W(K(this),this.o);this.a-=7},function(){var a=this.u-1;if(this.T.length)for(var b=0;b<this.T.length;b++)if(this.T[b](a))return;this.C|=256;this.a-=7;this.G&512||Ab(this)},function(){this.W(K(this),this.c);this.a-=7},function(){this.c=this.f;this.a-=5},function(){this.c=this.D;this.a-=5},
function(){this.c=this.h;this.a-=5},function(){this.c=this.F;this.a-=5},function(){this.c=this.i;this.a-=5},function(){this.c=this.o;this.a-=5},function(){this.c=this.K(K(this));this.a-=7},function(){this.a-=5},function(){this.c=Wb(this,this.f);this.a-=4},function(){this.c=Wb(this,this.D);this.a-=4},function(){this.c=Wb(this,this.h);this.a-=4},function(){this.c=Wb(this,this.F);this.a-=4},function(){this.c=Wb(this,this.i);this.a-=4},function(){this.c=Wb(this,this.o);this.a-=4},function(){this.c=Wb(this,
this.K(K(this)));this.a-=7},function(){this.c=Wb(this,this.c);this.a-=4},function(){this.c=Xb(this,this.f);this.a-=4},function(){this.c=Xb(this,this.D);this.a-=4},function(){this.c=Xb(this,this.h);this.a-=4},function(){this.c=Xb(this,this.F);this.a-=4},function(){this.c=Xb(this,this.i);this.a-=4},function(){this.c=Xb(this,this.o);this.a-=4},function(){this.c=Xb(this,this.K(K(this)));this.a-=7},function(){this.c=Xb(this,this.c);this.a-=4},function(){this.c=O(this,this.f);this.a-=4},function(){this.c=
O(this,this.D);this.a-=4},function(){this.c=O(this,this.h);this.a-=4},function(){this.c=O(this,this.F);this.a-=4},function(){this.c=O(this,this.i);this.a-=4},function(){this.c=O(this,this.o);this.a-=4},function(){this.c=O(this,this.K(K(this)));this.a-=7},function(){this.c=O(this,this.c);this.a-=4},function(){this.c=bc(this,this.f);this.a-=4},function(){this.c=bc(this,this.D);this.a-=4},function(){this.c=bc(this,this.h);this.a-=4},function(){this.c=bc(this,this.F);this.a-=4},function(){this.c=bc(this,
this.i);this.a-=4},function(){this.c=bc(this,this.o);this.a-=4},function(){this.c=bc(this,this.K(K(this)));this.a-=7},function(){this.c=bc(this,this.c);this.a-=4},function(){this.c=Yb(this,this.f);this.a-=4},function(){this.c=Yb(this,this.D);this.a-=4},function(){this.c=Yb(this,this.h);this.a-=4},function(){this.c=Yb(this,this.F);this.a-=4},function(){this.c=Yb(this,this.i);this.a-=4},function(){this.c=Yb(this,this.o);this.a-=4},function(){this.c=Yb(this,this.K(K(this)));this.a-=7},function(){this.c=
Yb(this,this.c);this.a-=4},function(){this.c=cc(this,this.f);this.a-=4},function(){this.c=cc(this,this.D);this.a-=4},function(){this.c=cc(this,this.h);this.a-=4},function(){this.c=cc(this,this.F);this.a-=4},function(){this.c=cc(this,this.i);this.a-=4},function(){this.c=cc(this,this.o);this.a-=4},function(){this.c=cc(this,this.K(K(this)));this.a-=7},function(){this.c=cc(this,this.c);this.a-=4},function(){this.c=ac(this,this.f);this.a-=4},function(){this.c=ac(this,this.D);this.a-=4},function(){this.c=
ac(this,this.h);this.a-=4},function(){this.c=ac(this,this.F);this.a-=4},function(){this.c=ac(this,this.i);this.a-=4},function(){this.c=ac(this,this.o);this.a-=4},function(){this.c=ac(this,this.K(K(this)));this.a-=7},function(){this.c=ac(this,this.c);this.a-=4},function(){O(this,this.f);this.a-=4},function(){O(this,this.D);this.a-=4},function(){O(this,this.h);this.a-=4},function(){O(this,this.F);this.a-=4},function(){O(this,this.i);this.a-=4},function(){O(this,this.o);this.a-=4},function(){O(this,
this.K(K(this)));this.a-=7},function(){O(this,this.c);this.a-=4},function(){this.s&255&&(G(this,S(this)),this.a-=6);this.a-=5},function(){Sb(this,S(this));this.a-=10},function(){var a=R(this);this.s&255&&G(this,a);this.a-=10},fc,function(){var a=R(this);this.s&255&&(T(this,this.u),G(this,a),this.a-=6);this.a-=11},function(){T(this,Rb(this));this.a-=11},function(){this.c=Wb(this,P(this));this.a-=7},function(){T(this,this.u);G(this,0);this.a-=11},function(){this.s&255||(G(this,S(this)),this.a-=6);this.a-=
5},gc,function(){var a=R(this);this.s&255||G(this,a);this.a-=10},fc,function(){var a=R(this);this.s&255||(T(this,this.u),G(this,a),this.a-=6);this.a-=11},hc,function(){this.c=Xb(this,P(this));this.a-=7},function(){T(this,this.u);G(this,8);this.a-=11},function(){M(this)||(G(this,S(this)),this.a-=6);this.a-=5},function(){Ub(this,S(this));this.a-=10},function(){var a=R(this);M(this)||G(this,a);this.a-=10},function(){for(var a=P(this),b=this.m,c=this.c,d=this.u+-2&65535,e=1,f=0;0<e;){var h=b.s[a],g=b.C[a]||
1,k=1==g?255:2==g?65535:-1,k=(c>>>=f)&k;if(void 0!==h&&h[0])h[0](a,k,d);f+=g<<3;a+=g;e-=g}this.a-=10},function(){var a=R(this);M(this)||(T(this,this.u),G(this,a),this.a-=6);this.a-=11},function(){T(this,Tb(this));this.a-=11},function(){this.c=O(this,P(this));this.a-=7},function(){T(this,this.u);G(this,16);this.a-=11},function(){M(this)&&(G(this,S(this)),this.a-=6);this.a-=5},gc,function(){var a=R(this);M(this)&&G(this,a);this.a-=10},function(){for(var a=P(this),b=this.m,c=this.u+-2&65535,d=1,e=0,
f=0;0<d;){var h=b.o[a],g=b.A[a]||1,k=1==g?255:2==g?65535:-1,m=k;void 0!==h&&h[0]&&(m=h[0](a,c),void 0===m?m=k:m&=k);e|=m<<f;f+=g<<3;a+=g;d-=g}this.c=e&255;this.a-=10},function(){var a=R(this);M(this)&&(T(this,this.u),G(this,a),this.a-=6);this.a-=11},hc,function(){this.c=bc(this,P(this));this.a-=7},function(){T(this,this.u);G(this,24);this.a-=11},function(){Vb(this)||(G(this,S(this)),this.a-=6);this.a-=5},function(){L(this,S(this));this.a-=10},function(){var a=R(this);Vb(this)||G(this,a);this.a-=10},
function(){var a=S(this);T(this,K(this));L(this,a);this.a-=18},function(){var a=R(this);Vb(this)||(T(this,this.u),G(this,a),this.a-=6);this.a-=11},function(){T(this,K(this));this.a-=11},function(){this.c=Yb(this,P(this));this.a-=7},function(){T(this,this.u);G(this,32);this.a-=11},function(){Vb(this)&&(G(this,S(this)),this.a-=6);this.a-=5},function(){G(this,K(this));this.a-=5},function(){var a=R(this);Vb(this)&&G(this,a);this.a-=10},function(){var a=K(this);L(this,Tb(this));Ub(this,a);this.a-=5},function(){var a=
R(this);Vb(this)&&(T(this,this.u),G(this,a),this.a-=6);this.a-=11},hc,function(){this.c=cc(this,P(this));this.a-=7},function(){T(this,this.u);G(this,40);this.a-=11},function(){this.v&128||(G(this,S(this)),this.a-=6);this.a-=5},function(){var a=S(this);Ob(this,a&255|this.G&-256);this.c=a>>8;this.a-=10},function(){var a=R(this);this.v&128||G(this,a);this.a-=10},function(){this.G&=-513;this.a-=4},function(){var a=R(this);this.v&128||(T(this,this.u),G(this,a),this.a-=6);this.a-=11},function(){T(this,
Qb(this)&255|this.c<<8);this.a-=11},function(){this.c=ac(this,P(this));this.a-=7},function(){T(this,this.u);G(this,48);this.a-=11},function(){this.v&128&&(G(this,S(this)),this.a-=6);this.a-=5},function(){this.w=K(this)&65535;this.a-=5},function(){var a=R(this);this.v&128&&G(this,a);this.a-=10},function(){this.G|=512;this.a-=4},function(){var a=R(this);this.v&128&&(T(this,this.u),G(this,a),this.a-=6);this.a-=11},hc,function(){O(this,P(this));this.a-=7},function(){T(this,this.u);G(this,56);this.a-=
11}];function W(a){r.call(this,"ChipSet",a,W);var b=a.model;b&&!ic[b]&&ya("Unrecognized ChipSet model: "+b);this.c=ic[b]||{};a.sound&&(this.I=null,window&&(this.I=window.AudioContext||window.webkitAudioContext),this.I&&new this.I);D(this)}y(W);
var X={X:1978.1,Dc:{Y:0,pd:1,td:16,Ad:32,Jd:64,Id:128,Ca:14},qa:{Y:1,ec:1,yc:2,uc:4,vc:16,wc:32,xc:64,Ca:8},Ec:{Y:2,od:3,Sd:4,qd:8,Ed:16,Fd:32,Gd:64,rd:128,Ca:0},Nd:{Y:3},Ld:{Y:2,Bd:7},Pd:{Y:3,Td:1,Od:2,Hd:4,yd:8,sd:16,ld:32},Md:{Y:4},Qd:{Y:5,ud:1,vd:2,wd:4,xd:8,Ud:16}},Y={X:100,ha:{Y:66,Fb:1,sc:2,tc:4,Dd:8,Cd:16,Db:32,Cb:64,zb:128},dc:{Y:66,INIT:0},oa:{Y:194,nd:0,yb:16,zc:32,Eb:48,ic:0,jc:32},Pa:{Y:162,Kd:0,lc:0,hc:0,kc:0,gc:0},ia:{zd:{Y:98},xa:{bc:0,ac:1,Bc:2,Fc:4,fc:5,Ac:6,Rd:7},Sa:16383}},ic=
{SI1978:X,VT100:Y};W.prototype.S=function(){return!1};W.prototype.la=function(a,b,c,d){this.m=b;this.a=c;this.N=d;this.l=a;this.o=E(a,"Keyboard");this.da=E(a,"SerialPort");this.video=E(a,"Video");cb(b,this,this.c.ab);db(b,this,this.c.bb)};W.prototype.ca=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};W.prototype.ga=function(a){return a?this.save():!0};X.INIT=[[X.Dc.Ca,X.qa.Ca,X.Ec.Ca,0,0,0,0]];
Y.INIT=[[Y.dc.INIT,Y.ha.sc|Y.ha.tc],[Y.oa.ic,Y.oa.jc],[Y.Pa.lc,Y.Pa.hc,Y.Pa.kc,Y.Pa.gc],[0,0,0,0,[11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11904,11776,11784,11918,11776,11856,11824,11840,11808,11776,12E3,12E3,11857,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]];
l=W.prototype;l.reset=function(){this.c.INIT&&!this.restore(this.c.INIT)&&this.M("reset error")};l.save=function(){var a=new I(this);switch(this.c.X){case X.X:J(a,0,[this.$,this.h,this.aa,this.C,this.L,this.U,this.Z]);break;case Y.X:J(a,0,[this.J,this.v]),J(a,1,[this.s,this.u]),J(a,2,[this.f,this.G,this.T,this.O]),J(a,3,[this.A,this.b,this.w,this.H,this.i])}return a.data()};
l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.c.X){case X.X:return this.$=b[0],this.h=b[1],this.aa=b[2],this.C=b[3],this.L=b[4],this.U=b[5],this.Z=b[6],!0;case Y.X:return this.J=b[0],this.v=b[1],b=a[1],this.s=b[0],this.u=b[1],b=a[2],this.f=b[0],this.G=b[1],this.T=b[2],this.O=b[3],b=a[3],this.A=b[0],this.b=b[1],this.w=b[2],this.H=b[3],this.i=b[4],!0}return!1};l.start=function(){};l.stop=function(){};l.Lc=function(){return this.$};l.Mc=function(){return this.h};l.Nc=function(){return this.aa};
l.Kc=function(){return this.C>>8-this.L&255};l.Zc=function(a,b){this.L=b};l.ad=function(a,b){this.U=b};l.$c=function(a,b){this.C=b<<8|this.C>>8};l.bd=function(a,b){this.Z=b};l.cd=function(){};function jc(a){var b=0,c=0,d=~a.A;for(a=0;10>a;a++)d&1&&(b=9-a),d>>=1;for(a=0;10>a;a++)d&1&&(c=9-a),d>>=1;return 10*b+c}
l.Oc=function(){var a=this.v,a=a&~Y.ha.Cb;if((Eb(this.a)&64)<<1&&(a|=Y.ha.Cb,a!=this.v)){var b,c;b=this.w&1;switch(this.w>>1&7){case Y.ia.xa.ac:this.A=this.A<<1|b;break;case Y.ia.xa.fc:b=jc(this);this.i[b]=Y.ia.Sa;break;case Y.ia.xa.bc:this.b=this.b<<1|b;break;case Y.ia.xa.Fc:b=jc(this);c=this.b&Y.ia.Sa;this.i[b]=c;break;case Y.ia.xa.Ac:b=jc(this);c=this.i[b];null==c&&(c=Y.ia.Sa);this.b=c;break;case Y.ia.xa.Bc:this.b<<=1,this.H=this.b&Y.ia.Sa+1}}a&=~Y.ha.Db;this.H&&(a|=Y.ha.Db);a&=~Y.ha.zb;this.o&&
this.o.nb()&&(a|=Y.ha.zb);a&=~Y.ha.Fb;this.da&&this.da.nb()&&(a|=Y.ha.Fb);return this.v=a};l.dd=function(a,b){this.J=b};l.gd=function(a,b){this.w=b};l.fd=function(a,b){var c=b&3;switch(b>>2&3){case 0:this.f=this.f&-4|c;break;case 1:this.f=this.f&-13|c<<2;if(this.video){var c=this.video,d=this.f;c.fb!==d&&((c.fb=d)?kc(c,-1):c.hb=!0)}break;case 2:switch(c){case 0:this.G=~this.G;break;case 2:case 3:this.T=3-c}break;case 3:this.O=c}};
l.ed=function(a,b){if(b&Y.oa.zc)b&=Y.oa.Eb,this.u!=b&&(this.u=b,this.video&&(this.video.sb=this.u==Y.oa.Eb?50:60));else if(b&=Y.oa.yb,this.s!=b&&(this.s=b,this.video)){var c=this.video,d=this.s==Y.oa.yb?132:80;c.H=d;c.R=c.Gb;80<d&&c.R--;lc(c)&&mc(c)}};X.ab={0:W.prototype.Lc,1:W.prototype.Mc,2:W.prototype.Nc,3:W.prototype.Kc};X.bb={2:W.prototype.Zc,3:W.prototype.ad,4:W.prototype.$c,5:W.prototype.bd,6:W.prototype.cd};Y.ab={66:W.prototype.Oc};
Y.bb={66:W.prototype.dd,98:W.prototype.gd,162:W.prototype.fd,194:W.prototype.ed};wa(function(){for(var a=A(document,"pc8080","chipset"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new W(d);Na(d,c)}});
function nc(a){r.call(this,"ROM",a,nc);this.b=null;this.i=a.addr;this.c=a.size;this.o=a.writable;this.l=a.alias;this.f=a.file;this.s=ba(this.f);if(this.f){a=this.f;var b=ca(this.s);"json"!=b&&"hex"!=b&&(a=ka()+"/api/v1/dump?file="+this.f+"&format=bytes&decimal=true");var c=this;p(a,null,!0,function(a,b,f){oc(c,a,b,f)})}}y(nc);var pc=[0,5];nc.prototype.la=function(a,b,c,d){this.m=b;this.a=c;this.N=d;qc(this)};
nc.prototype.ca=function(){this.h&&(this.N&&this.N.a(this.id,this.i,this.c,this.h),delete this.h);return!0};nc.prototype.ga=function(){return!0};
function oc(a,b,c,d){if(d)a.M("Unable to load system ROM (error "+d+": "+b+")");else{Ja(a.jb,b,c);if("["==c.charAt(0)||"{"==c.charAt(0))try{var e=eval("("+c+")"),f=e.bytes,h=e.data;if(f)a.b=f;else if(h)for(a.b=Array(4*h.length),d=c=0;c<h.length;c++)a.b[d++]=h[c]&255,a.b[d++]=h[c]>>8&255,a.b[d++]=h[c]>>16&255,a.b[d++]=h[c]>>24&255;else a.b=e;a.h=e.symbols;if(!a.b.length){q("Empty ROM: "+b);return}if(1==a.b.length){q(a.b[0]);return}}catch(g){a.M("ROM data error: "+g.message);return}else for(b=c.replace(/\n/gm,
" ").replace(/ +$/,"").split(" "),a.b=Array(b.length),e=0;e<b.length;e++)a.b[e]=aa(b[e]);qc(a)}}
function qc(a){if(!Pa(a))if(!a.f)D(a);else if(a.b&&a.m){a.c||(a.c=a.b.length);if(a.b.length!=a.c){var b="ROM size (0x"+n(a.b.length)+") does not match specified size ("+("0x"+n(a.c))+")";a.j.ra=!0;a.M(b)}else if(rc(a,a.i)){b=[];"number"==typeof a.l?b.push(a.l):null!=a.l&&a.l.length&&(b=a.l);for(var c=0;c<b.length;c++){for(var d=a,e=b[c],f=d.m,h=d.c,g=[],k=d.i>>>f.c;0<h&&k<f.b.length;)g.push(f.b[k++]),h-=f.m;f=d.m;d=d.c;h=0;for(e>>>=f.c;0<d&&e<f.b.length;){k=g[h++];if(!k)break;f.b[e++]=k;d-=f.m}}delete a.b}D(a)}}
function rc(a,b){if(Wa(a.m,b,a.c,a.o?1:kb)){var c;for(c=0;c<a.b.length;c++)ab(a.m,b+c,a.b[c]);if(a.o&&256==b){for(c=0;c<pc.length;c++)ab(a.m,pc[c],118);Nb(a.a,function(a){return function(b){if(0<=pc.indexOf(b)){var c=!1,h=a.a,g=a.N;if(5==b)switch(c=!0,h.D){case 2:sc(a,String.fromCharCode(h.F));break;case 9:for(var k=Tb(h),m="",v=255;v--;){var u=a.a.K(k++);if(36==u)break;m+=String.fromCharCode(u)}sc(a,m);break;default:c=!1}c?gc.call(h):g&&(a.ba("\nCP/M vector 0x"+n(b,4)),G(h,b),Ab(g));b=!0}else b=
!1;return b}}(a));Pb(a.a,b)}return!0}return!1}function sc(a,b){b=b.replace(/\r/g,"");a.na&&(a.na.value+=b,a.na.scrollTop=a.na.scrollHeight)}wa(function(){for(var a=A(document,"pc8080","rom"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new nc(d);Na(d,c)}});function tc(a){r.call(this,"RAM",a,tc);this.l=a.addr;this.c=a.size;this.b=!1}y(tc);l=tc.prototype;l.la=function(a,b,c,d){this.m=b;this.a=c;this.N=d;D(this)};l.ca=function(a,b){b||this.reset();return!0};l.ga=function(a){return a?this.save():!0};
l.reset=function(){!this.b&&this.c&&Wa(this.m,this.l,this.c,1)&&(this.b=!0);this.b||q("No RAM allocated")};l.save=function(){return null};l.restore=function(){return!0};wa(function(){for(var a=A(document,"pc8080","ram"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new tc(d);Na(d,c)}});function uc(a){r.call(this,"Keyboard",a,uc);(a=a.model)&&!vc[a]&&ya("Unrecognized Keyboard model: "+a);this.b=vc[a]||{};this.reset();D(this)}y(uc);
var wc={X:1978.1,g:{},xb:{65:37,68:39,76:32},Da:{},pa:{"1p":49,"2p":50,coin:51,left:37,right:39,fire:32}},Z={X:100,g:{},xb:{},Da:{},pa:{setup:120},cc:{Y:130,INIT:127},ea:{Y:130,qc:1,pc:2,oc:4,nc:8,rc:16,Bb:32,Ab:63,Cc:64,md:128,INIT:0},mc:127};Z.g[46]=3;Z.g[80]=5;Z.g[79]=6;Z.g[89]=7;Z.g[84]=8;Z.g[87]=9;Z.g[81]=10;Z.g[39]=16;Z.g[221]=20;Z.g[219]=21;Z.g[73]=22;Z.g[85]=23;Z.g[82]=24;Z.g[69]=25;Z.g[49]=26;Z.g[37]=32;Z.g[40]=34;Z.g[117]=35;Z.g[19]=35;Z.g[192]=36;Z.g[189]=37;Z.g[57]=38;Z.g[55]=39;
Z.g[52]=40;Z.g[51]=41;Z.g[27]=42;Z.g[38]=48;Z.g[114]=49;Z.g[112]=50;Z.g[8]=51;Z.g[187]=52;Z.g[48]=53;Z.g[56]=54;Z.g[54]=55;Z.g[53]=56;Z.g[50]=57;Z.g[9]=58;Z.g[103]=64;Z.g[115]=65;Z.g[113]=66;Z.g[96]=67;Z.g[118]=68;Z.g[220]=69;Z.g[76]=70;Z.g[75]=71;Z.g[71]=72;Z.g[70]=73;Z.g[65]=74;Z.g[104]=80;Z.g[2013]=81;Z.g[98]=82;Z.g[97]=83;Z.g[222]=85;Z.g[186]=86;Z.g[74]=87;Z.g[72]=88;Z.g[68]=89;Z.g[83]=90;Z.g[110]=96;Z.g[116]=97;Z.g[101]=98;Z.g[100]=99;Z.g[13]=100;Z.g[190]=101;Z.g[188]=102;Z.g[78]=103;
Z.g[66]=104;Z.g[88]=105;Z.g[119]=106;Z.g[105]=112;Z.g[99]=113;Z.g[102]=114;Z.g[109]=115;Z.g[191]=117;Z.g[77]=118;Z.g[32]=119;Z.g[86]=120;Z.g[67]=121;Z.g[90]=122;Z.g[120]=123;Z.g[17]=124;Z.g[16]=125;Z.g[20]=126;Z.Da={l4:Z.ea.qc,l3:Z.ea.pc,l2:Z.ea.oc,l1:Z.ea.nc,locked:Z.ea.rc,local:Z.ea.Bb,online:~Z.ea.Bb};var vc={SI1978:wc,VT100:Z};
uc.prototype.S=function(a,b,c){var d=this,e=a+"-"+b;if(void 0===this.B[e]){if("led"==a&&this.b.Da[b])return this.B[e]=c,!0;switch(b){case "kbd":return c.onkeydown=function(a){return xc(d,a,!0)},c.onkeyup=function(a){return xc(d,a,!1)},!0;default:if(this.b.pa&&void 0!==this.b.pa[b])return this.B[e]=c,a=function(a,b){return function(){yc(a,b,!0)}}(this,this.b.pa[b]),b=function(a,b){return function(){yc(a,b,!1);a.l&&Fb(a.l)}}(this,this.b.pa[b]),"ontouchstart"in window?(c.ontouchstart=a,c.ontouchend=
b):(c.onmousedown=a,c.onmouseup=c.onmouseout=b),!0}}return!1};uc.prototype.la=function(a,b,c,d){this.l=a;this.a=c;this.N=d;this.L=E(a,"ChipSet");cb(b,this,this.b.ab);db(b,this,this.b.bb)};uc.prototype.ca=function(a,b){if(!b)if(!a)this.reset();else if(!this.restore(a))return!1;return!0};uc.prototype.ga=function(a){return a?this.save():!0};Z.INIT=[[Z.ea.INIT,Z.cc.INIT,-1]];l=uc.prototype;l.reset=function(){this.c=[];this.b.INIT&&!this.restore(this.b.INIT)&&this.M("reset error")};
l.save=function(){var a=new I(this);switch(this.b.X){case Z.X:J(a,0,[this.h,this.f,-1])}return a.data()};l.restore=function(a){var b;if(a&&(b=a[0])&&b.length)switch(this.b.X){case wc.X:return!0;case Z.X:return this.h=b[0],zc(this,this.h&Z.ea.Ab),this.f=b[1],this.m=b[2],!0}return!1};function zc(a,b){for(var c in a.b.Da){var d=a.B["led-"+c];if(d){var e=a.b.Da[c],f=!!(b&e);e&e-1&&(f=!(b&~e));d.style.backgroundColor=f?"#ff0000":"#000000"}}}
function xc(a,b,c){var d=!0,e;a:if(e=b.keyCode,e=a.b.xb[e]||e,!a.b.g[e]){for(var f in a.b.pa)if(a.b.pa[f]===e){e=f;break a}e=null}e&&(d=yc(a,e,c),b.preventDefault());return d}
function yc(a,b,c){var d;a:{for(d=0;d<a.c.length;d++)if(a.c[d].vb==b)break a;d=-1}if(c)0>d?a.c.push({vb:b,pb:Date.now(),Ta:!1}):(a.c[d].pb=Date.now(),a.c[d].Ta=!1);else if(0<=d){if(!a.c[d].Ta){var e=a.c[d].pb;if(e&&100>Date.now()-e)return a.c[d].Ta=!0,Ac(a),!0}a.c.splice(d,1)}if(a.L){d=0;switch(b){case "1p":d=X.qa.uc;break;case "2p":d=X.qa.yc;break;case "coin":d=X.qa.ec;break;case "left":d=X.qa.wc;break;case "right":d=X.qa.xc;break;case "fire":d=X.qa.vc}d&&(a=a.L,b=d,a.h&=~b,c&&(a.h|=b))}return!0}
function Ac(a){for(var b=0,c=-1;b<a.c.length;){if(a.c[b].Ta){var d=a.c[b].vb,e=100-(Date.now()-a.c[b].pb);if(0<e){if(0>c||c>e)c=e}else{yc(a,d,!1);b=0;continue}}b++}0<=c&&setTimeout(function(){Ac(a)},c)}l.nb=function(){return!0};l.Pc=function(){var a=this.f;0<=this.m&&(this.m<this.c.length?(a=this.c[this.m],this.m++,a=Z.g[a.vb],a&128&&(a&=127)):(this.m=-1,a=Z.mc),this.f=a,dc(this.a,1));return a};l.hd=function(a,b){this.h=b;zc(this,b&Z.ea.Ab);b&Z.ea.Cc&&(this.m=0,dc(this.a,1))};Z.ab={130:uc.prototype.Pc};
Z.bb={130:uc.prototype.hd};wa(function(){for(var a=A(document,"pc8080","keyboard"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new uc(d);Na(d,c)}});
function Cc(a,b,c,d,e){var f=this;this.Lb=ra("Gecko/");var h=["","moz","ms","webkit"];r.call(this,"Video",a,Cc);this.C=a.screenWidth;this.w=a.screenHeight;this.U=a.bufferAddr;this.Rc=a.bufferRAM;var g=a.bufferFormat;this.L=g&&Dc[g.toUpperCase()]||Ec;this.H=a.bufferCols;this.I=a.bufferRows;this.Gb=this.R=a.cellWidth||1;this.P=a.cellHeight||1;this.da=null;this.Jb=!1;this.Ra=a.bufferBits||1;this.Sc=a.bufferLeft||0;if(this.c=a.bufferRotate)this.c=this.c%360,0<this.c&&(this.c-=360),-90!=this.c&&(this.M("unsupported buffer rotation: "+
this.c),this.c=0);this.lb=a.interruptRate;this.Tc=a.refreshRate||60;this.v=b;this.f=c;this.$=(this.Vc=d)||b||null;this.Hc=this.C;this.Qc=this.w;this.Hb=this.C/this.H|0;this.Ib=this.w/this.I|0;1<this.P&&(this.I++,this.fb=0,this.hb=!1);b=a.smoothing;(c=Ca.smoothing)&&(b="true"==c);if(null!=b)for(c=0;c<h.length;c++)if(d=(d=h[c])?d+"ImageSmoothingEnabled":"imageSmoothingEnabled",void 0!==this.f[d]){this.f[d]=b;break}if(this.h=a.screenRotate)this.h=this.h%360,0<this.h&&(this.h-=360),-90!=this.h?(this.M("unsupported screen rotation: "+
this.h),this.h=0):(this.f.translate(0,this.w),this.f.rotate(this.h*Math.PI/180),this.f.scale(this.w/this.C,this.C/this.w));if(this.b=e)if(this.b.ya=e.requestFullscreen||e.msRequestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen,this.b.ya){for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenchange","on"+d in document){document.addEventListener(d,function(){Fc(f,document.fullscreenElement||document.msFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?!0:!1)},!1);
break}for(c=0;c<h.length;c++)if(d=h[c]+"fullscreenerror","on"+d in document){document.addEventListener(d,function(){Fc(f,null)},!1);break}}if(this.J=a.fontROM)"json"!=ca(this.J)&&(this.J=ka()+"/api/v1/dump?file="+this.J+"&format=bytes"),p(this.J,null,!0,function(a,b,c){Gc(f,a,b,c)});this.kb={}}y(Cc);var Ec=0,Dc={SI1978:1,VT100:2};
function lc(a){a.s=a.H*a.R;a.G=a.I*a.P;var b=a.s,c=a.G;a.c&&(b=a.G,c=a.s);a.A=0;if(!a.Rc&&(a.A=(a.s*a.Ra>>3)*a.G,!Wa(a.m,a.U,a.A,3)))return!1;a.A?(a.Qb=a.f.createImageData(b,c),a.Tb=16/a.Ra|0,Hc(a,a.A>>1)):Hc(a,(a.H+1)*a.I);a.u=document.createElement("canvas");a.u.width=b;a.u.height=c;a.gb=a.u.getContext("2d");a.O={};a.aa=1<<a.Ra;a.T=Array(a.aa+2);a.T[0]=[0,0,0,255];a.T[1]=[255,255,255,255];1==a.L&&(a.T[a.aa+0]=[255,255,0,255],a.T[a.aa+1]=[0,255,0,255]);2==a.L&&(a.sb=60,a.ib=!1,a.ma=Array(a.H));return!0}
Cc.prototype.la=function(a,b,c,d){this.l=a;this.m=b;this.a=c;this.N=d;lc(this);if(this.o=E(a,"Keyboard")){for(var e in this.kb)this.o.S("led",e,this.kb[e]);this.v&&this.o.S(this.Vc?"textarea":"canvas","kbd",this.$)}this.J||D(this)};
function Gc(a,b,c,d){if(d)a.M("Unable to load font ROM (error "+d+": "+b+")");else{Ja(a.jb,b,c);try{var e=eval("("+c+")"),f=e.bytes||e;if(!f||!f.length){q("Empty font ROM: "+b);return}if(1==f.length){q(f[0]);return}if(2048==f.length)a.da=f,mc(a);else{a.M("Unrecognized font data length ("+f.length+")");return}}catch(h){a.M("Font ROM data error: "+h.message);return}(a.f||a.N)&&D(a)}}
function mc(a){a.da&&(a.Jb=2==a.L,a.O[96]=[Ic(a,a.R,a.P),Ic(a,a.R,a.P,a.ib)],a.O[64]=[Ic(a,2*a.R,a.P),Ic(a,2*a.R,a.P,a.ib)],a.O[32]=a.O[0]=[Ic(a,2*a.R,2*a.P),Ic(a,2*a.R,2*a.P,a.ib)])}
function Ic(a,b,c,d){var e=8>=a.Gb?8:16,f=8<e?15:0,h=a.da.length/e,g=!1===d,k={R:b,P:c};k.canvas=document.createElement("canvas");k.canvas.width=16*b;k.canvas.height=h/16*c;k.context=k.canvas.getContext("2d");for(var m=k.context.createImageData(b,c),v=0;v<h;v++){for(var u=0,x=u;u<a.P;u++)for(var B=v*e+(f+u&e-1),B=d&&8==u?255:a.da[B],t=0;t<c/a.P;t++){for(var C=0,H=0,V=H;H<a.R;H++){for(var Q=B&128>>(7<H?7:H),C=a.Jb&&!Q&&C?C:Q,la=0;la<b/a.R;la++)g&&(C=!C),Jc(a,m,V,x,C?1:0),V++;C=Q}x++}k.context.putImageData(m,
(v&15)*b,(v>>4)*c)}return k}
Cc.prototype.ca=function(){if(2==this.L){for(var a={0:[32,"SET-UP A"],2:[64,'TO EXIT PRESS "SET-UP"'],22:[96,"        T       T       T       T       T       T       T       T       T"],23:[96,"1234567890","1234567890","1234567890","1234567890","1234567890","1234567890","1234567890","1234567890"],24:[]},b=this.U,c=-1,d=-1,e,f=-(60==this.sb?2:5);f<this.I;f++){var h=a[f];if(0<=c){var g=!1,c=b+2;h?h.length?d=h[0]:(c=b-1,g=!0):32==d&&(h=a[f-1],d=0);e=d&96|c>>8&15|16;ab(this.m,b++,e);ab(this.m,b++,c&255);
if(g)break}if(h)for(c=0,e=1;e<h.length;e++){for(var g=h[e],k=0;k<g.length;k++)ab(this.m,b++,g.charCodeAt(k)|c);c^=128}ab(this.m,b++,127);c=b}Kc(this)}return!0};Cc.prototype.S=function(a,b,c){var d=this;if("led"==a||"rled"==a)return this.kb[b]=c,!0;switch(b){case "fullScreen":return this.B[b]=c,this.b&&this.b.ya?c.onclick=function(){d.ya()}:c.parentNode.removeChild(c),!0}return!1};
Cc.prototype.ya=function(){var a=!1;if(this.b){if(this.b.ya){a="100%";if(screen&&screen.width&&screen.height){var b=screen.width/screen.height,c=this.C/this.w;b>c&&(a=Math.round(c/b*100)+"%")}this.Lb?(this.v.style.width=a,this.v.style.width=a,this.v.style.display="block",this.v.style.margin="auto"):(this.b.style.width=a,this.b.style.height="auto");this.b.style.backgroundColor="black";this.b.ya();a=!0}this.$&&this.$.focus()}return a};
function Fc(a,b){!b&&a.b&&(a.Lb?a.v.style.width=a.v.style.height="":a.b.style.width=a.b.style.height="")}function Hc(a,b){a.Rb=b;a.Z=!1;if(void 0===a.i||a.i.length!=a.Rb)a.i=Array(a.Rb)}function Jc(a,b,c,d,e){d=a.c?(b.height-c-1)*b.width+d:c+d*b.width;e&&1==a.L&&(208<=c&&236>c?e=a.aa+0:28<=c&&72>c&&(e=a.aa+1));a=a.T[e];d*=a.length;b.data[d]=a[0];b.data[d+1]=a[1];b.data[d+2]=a[2];b.data[d+3]=a[3]}
function Kc(a,b){for(var c=a.U,d=-1,e=0,f=60==a.sb?2:5,h=0,g=0,k=-1;e<a.I;){var m=0,v=c,u=d,x=a.H;for(96!=u&&(x>>=1);;){var B=Za(a.m,v++);if(127==(B&127)){var t=Za(a.m,v++),d=t&96,c=(t&15)<<8|Za(a.m,v),c=c+(t&16?8192:16384);break}if(m<x)a.ma[m++]=B;else break}if(f)f--;else{for(;m<a.ma.length;)a.ma[m++]=0;if(0<=u)for(v=a.Z&&a.i[h]==x,a.i[h++]=x,x=0;x<m;x++){B=a.ma[x];if(!v||B!==a.i[h]){a.i[k=h]=B;var t=a,C=a.gb,H=B&127;if(B=t.O[u][B&128?1:0]){var V=(H&15)*B.R,H=(H>>4)*B.P,Q=void 0,la=void 0,Da=void 0,
gb=void 0,Bc=B.R,Jb=B.P;C?(Q=x*t.R,la=e*t.P,Da=t.R,gb=t.P):(Q=x*t.Hb,la=e*t.Ib,Da=t.Hb,gb=t.Ib);B.R>t.R&&(Q*=2,Da*=2);B.P>t.P&&(0==u&&(H+=t.P),Jb=t.P);C?C.drawImage(B.canvas,V,H,Bc,Jb,Q,la,Da,gb):(Q+=0,la+=0,t.f.drawImage(B.canvas,V,H,Bc,Jb,Q,la,Da,gb))}g++}h++}e++}}a.Z=!0;!b&&a.hb&&1==g&&(a.i[k]=-1,g=0);a.hb=!1;(g||b)&&a.gb&&a.f.drawImage(a.u,0,a.fb,a.s,a.G-a.P,0,0,a.Hc,a.Qc)}
function kc(a,b){var c=!0,d=!0;if(0<=b){d=!1;a.lb&&(120==a.lb?b&1?(dc(a.a,2),c=!1):dc(a.a,1):dc(a.a,4));var e;if(e=c&&a.Z&&a.A){e=a.m;for(var f=a.A,h=!0,g=a.U>>>e.c;0<f&&g<e.b.length;)e.b[g].ja&&(e.b[g].ja=h=!1,e.b[g].Nb=!0),f-=e.m,g++;e=h}e&&(c=!1)}if(c)if(1<a.R)switch(a.L){case 2:Kc(a,d)}else{var f=a.U,h=f+a.A,k=g=0,m=0,c=a.s,v=0,d=a.G,u=e=0,x=a.Ra,B=(1<<x)-1;a.Sc&&(x=-x,u=16+x);for(;f<h;){var t;t=a.m;var C=f,H=C&t.l,V=(C&t.f)>>>t.c;t=H!=t.l?t.b[V].Yb(H,C):t.b[V++].cb(H,C)|t.b[V&t.u].cb(0,C+1)<<
8;if(a.Z&&t===a.i[g])k+=a.Tb;else{a.i[g]=t;(C=u)&&(t=t>>8|(t&255)<<8);k<c&&(c=k);for(H=a.Tb;H--;)V=t>>C&B,Jc(a,a.Qb,k++,m,V),C+=x;k>v&&(v=k);m<d&&(d=m);m>=e&&(e=m+1)}f+=2;g++;if(k>=a.s&&(k=0,m++,m>a.G))break}a.Z=!0;c<a.s&&(f=v-c,e-=d,a.c&&(h=c,g=f,c=d,f=e,d=a.s-(h+g),e=g),a.gb.putImageData(a.Qb,0,0,c,d,f,e),a.f.drawImage(a.u,0,0,a.u.width,a.u.height,0,0,a.C,a.w))}}
wa(function(){for(var a=A(document,"pc8080","video"),b=0;b<a.length;b++){var c=a[b],d=z(c),e=document.createElement("canvas");if(void 0===e||!e.getContext){c.innerHTML="<br/>Missing &lt;canvas&gt; support. Please try a newer web browser.";break}e.setAttribute("class","pcjs-canvas");e.setAttribute("width",d.screenWidth);e.setAttribute("height",d.screenHeight);e.style.backgroundColor=d.screenColor;e.style.height="auto";0<=(window?window.navigator.userAgent:"").indexOf("MSIE")&&(c.onresize=function(a,
b,c,d){return function(){b.style.height=(a.clientWidth*d/c|0)+"px"}}(c,e,d.screenWidth,d.screenHeight),c.onresize());var f=+(d.aspect||Ca.aspect);f&&.3<=f&&3.33>=f&&(va("onresize",function(a,b,c){return function(){b.style.height=(a.clientWidth/c|0)+"px"}}(c,e,f)),window.onresize());c.appendChild(e);f=document.createElement("textarea");ra("iOS")&&(f.setAttribute("autocapitalize","off"),f.setAttribute("autocorrect","off"));c.appendChild(f);var h=e.getContext("2d"),d=new Cc(d,e,h,f,c);Na(d,c)}});
function Lc(a){this.H=+a.adapter;switch(this.H){case 0:this.I=0;this.O=2;break;default:q("Unrecognized serial adapter #"+this.H);return}this.c=this.f=null;this.J=a.tabSize;this.G=a.charBOL;this.h=0;r.call(this,"SerialPort",a,Lc);var b=a.binding;if("console"==b)this.f="";else{var c;a=Mc;b&&(void 0===c&&(c="Panel"),(c=Ma(c,this.id))&&(b=c.B[b])&&this.S(null,a,b))}this.i="";this.s=this.A=null;this.exports={receiveData:this.tb}}y(Lc);
var Nc=[50,75,110,134.5,150,200,300,600,1200,1800,2E3,2400,3600,4800,9600,19200],Oc=[!1,0,0,133,142,39,238],Mc="buffer";l=Lc.prototype;
l.S=function(a,b,c,d){var e=this;switch(b){case Mc:return this.B[b]=this.c=c,c.onkeydown=function(a){a=a||window.event;var b=a.keyCode;if(8===b||a.ctrlKey&&65<=b&&90>=b)a.preventDefault&&a.preventDefault(),64<b&&(b-=64),Pc(e,b);return!0},c.onkeypress=function(a){a=a||window.event;Pc(e,a.which||a.keyCode);a.preventDefault&&a.preventDefault();return!0},c.removeAttribute("readonly"),!0;default:if(d)return this.B[b]=c,d=d.replace(/\\n/g,"\n").replace(/\\r/g,"\r"),c.onclick=function(){e.tb(d);e.l&&Fb(e.l);
return!0},!0}return!1};l.la=function(a,b,c,d){this.l=a;this.m=b;this.a=c;this.N=d;var e=this;this.T=Gb(this.a,function(){e.tb()});this.U=Gb(this.a,function(){e.b|=5});this.L=E(a,"ChipSet");cb(b,this,Qc,this.I);db(b,this,Rc,this.I);Sc(this);D(this)};function Sc(a){var b=vb(a.l,"connection");if(b){var c=b.split("=");2==c.length&&(b=ga(c[0]),c=ga(c[1]),b==a.Qa&&(a.s=La(c),a.s&&(b=a.s.exports)))&&(a.A=b.receiveData)}}
l.ca=function(a,b){if(!b)if(!a||!this.restore)this.reset();else if(!this.restore(a))return!1;return!0};l.ga=function(a){return a?this.save():!0};l.reset=function(){Tc(this)};l.save=function(){var a=new I(this),b=0,c=[];c[b++]=this.fa;c[b++]=this.w;c[b++]=this.C;c[b++]=this.b;c[b++]=this.o;c[b++]=this.v;c[b]=this.u;J(a,0,c);return a.data()};l.restore=function(a){return Tc(this,a[0])};
function Tc(a,b){var c=0;void 0===b&&(b=Oc);a.fa=b[c++];a.w=b[c++];a.C=b[c++];a.b=b[c++];a.o=b[c++];a.v=b[c++];a.u=b[c];return!0}function Uc(a,b){var c=a.u&b;b&15||(c>>=4);var c=Nc[c],d=((a.o&12)>>2)+6;a.o&16&&d++;d+=((a.o&192)>>6)+1>>1;return 1E3/Math.round(c/d)}function Pc(a,b){return a.b&2?!1:(a.w=b,a.b|=2,dc(a.a,a.O),!0)}
l.tb=function(a){null!=a&&(this.i="number"!=typeof a?a:this.i+String.fromCharCode(a));this.i&&(Pc(this,this.i.charCodeAt(0))&&(this.i=this.i.substr(1)),this.i&&this.a&&Hb(this.a,this.T,Uc(this,15)))};l.nb=function(){return!!(this.b&1)};l.Jc=function(){var a=this.w;this.b&=-3;return a};l.Ic=function(){return this.b};
l.Yc=function(a,b){this.C=b;this.b&=-6;this.A&&this.A.call(this.s,b);if(this.c)if(8==b)this.c.value=this.c.value.slice(0,-1),0<this.h&&this.h--;else{var c;c=(c=ha[b])?"<"+c+">":String.fromCharCode(b);var d=c.length;9==b?(d=this.J||8,d=d-this.h%d,this.J&&(c="                                        ".slice(0,d))):13==b&&(this.h=d=0,c="\n");this.G&&!this.h&&d&&(c=String.fromCharCode(this.G)+c);this.c.value+=c;this.c.scrollTop=this.c.scrollHeight;this.h+=d}else if(null!=this.f){if(10==b||1024<=this.f.length)this.ba(this.f),
this.f="";10!=b&&(this.f+=String.fromCharCode(b))}this.a&&Hb(this.a,this.U,Uc(this,240))};l.Xc=function(a,b){this.fa?(this.v=b,this.v&64&&(this.fa=!1)):(this.o=b,this.fa=!0)};l.Wc=function(a,b){this.u=b};var Qc={0:Lc.prototype.Jc,1:Lc.prototype.Ic},Rc={0:Lc.prototype.Yc,1:Lc.prototype.Xc,2:Lc.prototype.Wc};wa(function(){for(var a=A(document,"pc8080","serial"),b=0;b<a.length;b++){var c=a[b],d=z(c),d=new Lc(d);Na(d,c)}});function I(a,b,c){this.id=a.id;this.key=Vc(a,b,c);this.N=a.N;Wc(this,a.Xb)}
function Vc(a,b,c){a=a.id;if(b){var d=b.indexOf(".");0<d&&(a+=".v"+b.substr(0,d))}c&&(a+="."+c);return a}
I.prototype={constructor:I,value:function(){return this[this.id]},data:function(){return this[this.id]},toString:function(){var a=this[this.id];return"string"==typeof a?a:JSON.stringify(a)},clear:function(a){Wc(this);var b=[];try{for(var c=0,d=window.localStorage.length;c<d;c++)b.push(window.localStorage.key(c))}catch(e){}for(c=0;c<b.length;c++)if((d=b[c])&&(a||d.substr(0,this.key.length)==this.key)){try{window.localStorage.removeItem(d)}catch(e){}b.splice(c,1);c=0}}};
function Wc(a,b){a[a.id]={};b&&J(a,"parms",b);a.a=!1}function Xc(a){var b=!0;if(oa()){var c=JSON.stringify(a[a.id]);qa(a.key,c)||(q("Unable to store "+c.length+" bytes in browser local storage"),b=!1)}return b}function Yc(a){var b=!0;try{a[a.id]=JSON.parse(a[a.id])}catch(c){q(c.message||c),b=!1}return b}function Zc(a,b){return b?(a[a.id]=b,a.a=!0):a.a?!0:oa()&&(b=pa(a.key))?(a[a.id]=b,a.a=!0):!1}function $c(a,b){return a[a.id][b]||null}function J(a,b,c){try{a[a.id][b]=c}catch(d){}}
function ad(a,b,c){r.call(this,"Computer",a,ad);this.j.V=!1;bd(this,b);this.A=vb(this,"autoPower",a);this.l=0;this.L=a.busWidth||a.buswidth;this.b=cd;this.v=null;this.o=this.H=!1;this.I=vb(this,"url")||"";(Math.random()+.1).toString(36);this.c=dd(this);if(this.a=Ma("CPU",this.id)){this.N=Ma("Debugger",this.id);this.i=[];for(b=null;b=E(this,"Video",b);)this.i.push(b);this.m=new Ua({id:this.jb+".bus",busWidth:this.L},this.a,this.N);var d,e=Ka(this.id);if((this.f=Ma("Panel",this.id))&&this.f.na)for(b=
0;b<e.length;b++)d=e[b],d.M=this.f.M,d.ba=this.f.ba,d.na=this.f.na;this.ba("PC8080 v1.23.3\nCopyright \u00a9 2012-2016 Jeff Parsons <Jeff@pcjs.org>\nLicense: GPL version 3 or later <http://gnu.org/licenses/gpl.html>");for(b=0;b<e.length;b++)d=e[b],d.la&&d.la(this,this.m,this.a,this.N);b=null;d=a.resume;void 0!==d&&(1<d.length?b=this.u=d:this.b=parseInt(d,10));var f;if(a=vb(this,"state")||(f=!0,a.state))b=this.C=a,f||(this.o=!0,this.b=cd),this.b&&(this.w=new I(this,"1.23.3"),Zc(this.w)?b=null:delete this.w);
!b&&this.b&&(b=ed(this))&&(this.o=!0);if(b){var h=this;p(b,null,!0,function(a,b,c){c?(h.u=null,h.o=!1,h.M("Unable to load machine state from server (error "+c+(b?": "+ga(b):"")+")")):(h.v=b,h.H=!0);D(h)})}else D(this);this.B.power||(this.A=!0);!c&&this.A&&fd(this,this.Ma)}else q("Unable to find CPU component")}y(ad);var cd=0;function bd(a,b){if(!b){var c;if("object"==typeof resources&&(c=resources.parms))try{b=eval("("+c+")")}catch(d){q(d.message+" ("+c+")")}}a.s=b}
function vb(a,b,c){var d=b.toLowerCase(),d=Ca[b]||Ca[d];void 0===d&&a.s&&(d=a.s[b]);void 0===d&&c&&(d=c[b]);void 0===d&&"object"==typeof resources&&resources[b]&&(d=b);return d}function fd(a,b,c){for(var d=Ka(a.id),e=0;e<=d.length;e++){var f=e<d.length?d[e]:a;if(!Pa(f)){Pa(f,function(){fd(a,b,c)});return}}b.call(a,c)}
function gd(a,b){var c=new I(a,"1.23.3","validate");if(Zc(c)&&Yc(c)){var d=$c(c,"timestamp"),e=b?$c(b,"timestamp"):"unknown";d!=e&&(a.M("Machine state may be out-of-date\n("+d+" vs. "+e+")\nCheck your browser's local storage limits"),b||c.clear())}}l=ad.prototype;
l.Ma=function(a){void 0===a&&(a=this.b||(this.v?1:cd));if(!this.l){this.l++;var b=!1,c=!1;this.G=!1;var d=this.w||new I(this,"1.23.3");if(-1==a)b=!0;else if(a>cd){if(Zc(d,this.v)){this.h=new I(this,"1.23.3","failsafe");Zc(this.h)&&(hd(this,d),a=2,Wc(this.h));J(this.h,"timestamp",ja());Xc(this.h);var e=this.b&&!this.o;if(1==a||ma("Click OK to restore the previous PC8080 machine state, or CANCEL to reset the machine.")){if(c=Yc(d)){var f=$c(d,"code"),h=$c(d,"data");f&&("ok"==f?Zc(d,h):("error"==f&&
"no machine state"!=h?(this.M("Error: "+h),"unable to verify user"==h&&(qa("user",""),this.c=null)):this.ba(f+": "+h),Wc(d),Zc(d)?(c=Yc(d),e=!0):c=!1))}e&&gd(this,c?d:null)}else 2==a&&d.clear()}else gd(this);delete this.v;delete this.w}e=Ka(this.id);for(f=0;f<e.length;f++)h=e[f],h!==this&&h!=this.a&&(c=id(this,h,d,b,c));b=[d,a,c];-1!=a?fd(this,this.Kb,b):this.Kb(b)}};
function id(a,b,c,d,e){if(!b.j.V){b.j.V=!0;if(b.ca){var f=null;e&&((f=$c(c,b.id))||(f=$c(c,b.id.replace(/[a-z0-9]\./i,"."))));"string"===typeof f&&(f=null);!b.ca(f,d)&&f&&(q("Unable to restore state for "+b.type),a.C&&!a.H?(c.clear(),a.b=cd,window&&window.location.reload()):a.G=!0,b.ca(null),e=!1)}if(!d&&b.wb)for(a=b.wb.split("|"),c=0;c<a.length;c++)b.status(a[c])}return e}
l.Kb=function(a){var b=a[0],c=0>a[1];a=a[2];this.J=!0;this.j.V=!0;var d=this.B.power;d&&(d.textContent="Shutdown");this.a&&(id(this,this.a,b,c,a),zb(this.a));this.G&&(hd(this,b),b.clear());!c&&this.h&&(this.h.clear(),delete this.h);this.l=0};
function hd(a,b){if(ma("There may be a problem with your PC8080 machine.\n\nTo help us diagnose it, click OK to send this PC8080 machine state to http://www.pcjs.org.")){var c=a.c||"",d=b.toString(),e={app:"PC8080",ver:"1.23.3"};e.url=a.I;e.user=c;e.type="bug";e.data=d;p("http://www.pcjs.org/api/v1/report",e,!0)}}
function jd(a,b,c){var d,e="none";if(a.l)return null;a.l--;var f=new I(a,"1.23.3"),h=new I(a,"1.23.3","validate"),g=ja();J(h,"timestamp",g);J(f,"timestamp",g);J(f,"version","1.23.3");J(f,"url",window?window.location.href:null);J(f,"browser",window?window.navigator.userAgent:"");a.a&&a.a.ga&&(c&&Ab(a.a),d=a.a.ga(b,c),"object"===typeof d&&J(f,a.a.id,d),c&&(a.a.j.V=!1,!1===d&&(e=null)));for(var g=Ka(a.id),k=0;k<g.length;k++){var m=g[k];m.j.V&&(m.ga&&(d=m.ga(b,c),"object"===typeof d&&J(f,m.id,d)),c&&
(m.j.V=!1,!1===d&&(e=null)))}e&&(c?(g=d=!1,b?(a.c&&kd(a,a.c,f.toString()),Xc(h)&&Xc(f)||(e=null,d=g=!0)):a.b&&(d=!0,g=3==a.b),d&&f.clear(g)):e=f.toString());c&&(a.j.V=!1,b=a.B.power)&&(b.textContent="Power");a.l=0;return e}l.reset=function(){this.m&&this.m.reset&&this.m.reset();for(var a=Ka(this.id),b=0;b<a.length;b++){var c=a[b];c!==this&&c!==this.m&&c.reset&&c.reset()}};l.start=function(a,b){for(var c=Ka(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.start&&e.start(a,b)}};
l.stop=function(a,b){for(var c=Ka(this.id),d=0;d<c.length;d++){var e=c[d];"CPU"!=e.type&&e!==this&&e.stop&&e.stop(a,b)}};
l.S=function(a,b,c){var d=this;switch(b){case "power":return this.B[b]=c,c.onclick=function(){d.l||(d.j.V?jd(d,!1,!0):fd(d,d.Ma))},!0;case "reset":return this.B[b]=c,c.onclick=function(){if(d.j.V&&!d.l)if(d.b&&!d.u){var a=ma("Click OK to save changes to this PC8080 machine.\n\nWARNING: If you CANCEL, all disk changes will be discarded.");jd(d,a,!0);!a&&d.C?window&&window.location.reload():d.Ma(cd)}else d.reset(),d.a&&zb(d.a)},!0;case "save":if(da(ka(),"pcjs.org")){c.parentNode.removeChild(c);break}this.B[b]=
c;c.onclick=function(){var a=dd(d,!0);if(a){var b=!!(d.b&&!d.u||d.C),c=jd(d,b);b?kd(d,a,c):d.M("Resume disabled, machine state not saved")}};return!0}return!1};
function dd(a,b){var c=a.c;c||(c=pa("user"),void 0!==c?!c&&b&&(c=null,window&&(c=window.prompt("Saving machine states on the pcjs.org server is currently unsupported.\n\nIf you're running your own server, enter your user ID below.","")),c&&((c=ld(a,c))||a.M("The user ID is invalid."))):b&&a.M("Browser local storage is not available"));return c}
function ld(a,b){a.c=null;var c=p(ka()+"/api/v1/user?req=verify&user="+b),d=c[1];if(!c[0]&&d)try{c=eval("("+d+")"),c.code&&"ok"==c.code&&(qa("user",c.data),a.c=c.data)}catch(e){q(e.message+" ("+d+")")}return a.c}function ed(a){var b=null;a.c&&(b=ka()+"/api/v1/user?req=load&user="+a.c+"&state="+Vc(a,"1.23.3"));return b}
function kd(a,b,c){if(c){var d={req:"store"};d.user=b;d.state=Vc(a,"1.23.3");d.data=c;b=p(ka()+"/api/v1/user",d);d=b[0];if(b[1]){if(d){var e=d.indexOf("\n");0<e&&(d=d.substr(0,e));d.indexOf("Error: ")||(d=d.substr(7))}d='{"code":'+b[1]+',"data":"'+d+'"}'}b=JSON.parse(d);b&&"ok"==b.code?a.M("Machine state saved to server"):c&&(c=b&&b.data||"unable to save machine state",c="error"==b.code?"Error: "+c:"Error "+b.code+": "+c,a.M(c),qa("user",""),a.c=null)}}
function E(a,b,c){a=Ka(a.id);for(var d=0;d<a.length;d++){var e=a[d];if(c)c==e&&(c=null);else if(e.type==b)return e}return null}function Fb(a,b){if(a.i.length){var c=0,d=0;b&&window&&(c=window.scrollX,d=window.scrollY);var e=a.i[0];e.$&&e.$.focus();b&&window&&window.scrollTo(c,d)}}l.wa=function(a){this.a&&this.a.wa(a);this.f&&this.f.wa(a)};function Ib(a,b){for(var c=0;c<a.i.length;c++)kc(a.i[c],b)}
wa(function(){for(var a=A(document,"pc8080-machine"),b=0;b<a.length;b++)for(var c=a[b],d=z(c),c=A(c,"pc8080","computer"),e=0;e<c.length;e++){var f=c[e],h=z(f),h=new ad(h,d,!0);Na(h,f);h.A&&fd(h,h.Ma)}});sa.show.push(function(){for(var a=A(document,"pc8080","computer"),b=0;b<a.length;b++){var c=z(a[b]);(c=Ma("Computer",c.id))&&c.J&&!c.j.V&&c.Ma(-1)}});
sa.exit.push(function(){for(var a=A(document,"pc8080","computer"),b=0;b<a.length;b++){var c=z(a[b]);(c=Ma("Computer",c.id))&&c.j.V&&jd(c,!(!c.b||c.u),!0)}});var md=0;function nd(a,b,c,d,e,f){e("Loading "+a+"...");p(a,null,!0,function(h,g,k){k?(g||(g="unable to load "+a+" ("+k+")"),f(g,null)):od(g,a,b,c,d,e,f)})}
function od(a,b,c,d,e,f,h){function g(a,f){if(f)h(f,null);else{if(c){Ja(c,b,a);var g=b;g&&0>g.indexOf("/")&&"/"==window.location.pathname.slice(-1)&&(g=window.location.pathname+g);d?"}"==d.slice(-1)?(d=d.slice(0,-1),1<d.length&&(d+=",")):d='{state:"'+d+'",':d="{";d+='url:"'+g+'"}';"object"==typeof resources&&(g=null);a=a.replace(/(<machine[^>]*\sid=)(['"]).*?\2/,"$1$2"+c+"$2"+(d?" parms='"+d+"'":"")+(g?' url="'+g+'"':""))}e||(a=a.replace(/(<xsl:variable name="APPCLASS">).*?(<\/xsl:variable>)/,"$1pc8080$2"));
g=null;if("<"==a.charAt(0))try{e||(a=a.replace(/<!DOCTYPE(.|[\r\n])*]>\s*/g,"")),window.ActiveXObject||"ActiveXObject"in window?(g=new window.ActiveXObject("Microsoft.XMLDOM"),g.async=!1,g.loadXML(a)):g=(new window.DOMParser).parseFromString(a,"text/xml")}catch(u){g=null,a=u.message}else a="unrecognized XML: "+(255<a.length?a.substr(0,255)+"...":a);h(a,g)}}a?e?pd(a,f,g):g(a,null):h("no data"+(b?" for file: "+b:""),null)}
function pd(a,b,c){var d;if(d=/<([a-z]+)\s+ref="(.*?)"(.*?)\/>/g.exec(a)){var e=d[2];b("Loading "+e+"...");p(e,null,!0,function(f,h,g){if(g||!h)c(a,"unable to resolve XML reference: "+d[0]+" ("+g+")");else{if(f=d[3])if(g=h.match(new RegExp("<"+d[1]+"[^>]*>"))){for(var k=g[0],m,v=/( [a-z]+=)(['"])(.*?)\2/g;m=v.exec(f);)k=0>k.indexOf(m[1])?k.replace(">",m[0]+">"):k.replace(new RegExp(m[1]+"(['\"])(.*?)\\1"),m[0]);g[0]!=k&&(h=h.replace(g[0],k))}else{c(a,"missing <"+d[1]+"> in "+e);return}h=h.replace(/<\?xml[^>]*>[\r\n]*/,
"");a=a.replace(d[0],h);pd(a,b,c)}})}else c(a,null)}
function qd(a,b,c,d){function e(a){if(void 0===g){var b=h&&A(h,"machine-warning");g=b&&b[0]||h}g&&(g.innerHTML=fa(a))}function f(a){e("Error: "+a);k&&(--md||za(!0));k=!1}var h,g,k=!0;md++;Ia[a]={};try{if(h=document.getElementById(a)){var m;if("object"==typeof resources&&(m=resources.css)){var v=document.head||document.getElementsByTagName("head")[0],u=document.createElement("style");u.type="text/css";u.styleSheet?u.styleSheet.cssText=m:u.appendChild(document.createTextNode(m));v.appendChild(u)}c||
(c="/versions/pc8080/1.23.3/components.xsl");m=function(d,g){g?nd(c,null,null,!1,e,function(d,k){if(k)if(Ja(a,c,d),e("Processing "+b+"..."),window.ActiveXObject||"ActiveXObject"in window){var m=g.transformNode(k);m?(h.outerHTML=m,--md||za(!0)):f("transformNodeToObject failed")}else document.implementation&&document.implementation.createDocument?(m=new XSLTProcessor,m.importStylesheet(k),(m=m.transformToFragment(g,document))?h.parentNode?(h.parentNode.replaceChild(m,h),--md||za(!0)):f("invalid machine element: "+
a):f("transformToFragment failed")):f("unable to transform XML: unsupported browser");else f(d)}):f(d)};"<"!=b.charAt(0)?nd(b,a,d,!0,e,m):od(b,null,a,d,!1,e,m)}else f("missing machine element: "+a)}catch(x){f(x.message)}return k}window.embedPC8080=function(a,b,c,d){za(!1);return qd(a,b,c,d)};window.enableEvents=za;window.sendEvent=Aa;
function rd(a,b,c,d){if(!c&&b){d.push(b);a=Ia[d[0]];b=null;for(var e in a)if(da(e,"components.xsl")){b=e.replace(".xsl",".css");break}b?p(b,null,!0,function(a,b){sd(b,d)}):sd(null,d)}else q("Error ("+c+") requesting "+a)}
function sd(a,b){var c,d,e,f=b[0],h=b[1];c=b[4];c=c.match(/^(\s*\(function\(\)\{)([\s\S]*)(}\)\(\);\s*)$/);var g=Ia[f],k={},m;for(m in g){var v=g[m],u=ca(m);if("xml"==u){for(u=/[ \t]*<disk [^>]*path=(['"])(.*?)\1.*?<\/disk>\n?/g;d=u.exec(g[m]);){var x=d[2];x&&(g[x]||(v=v.replace(d[0],"")))}d=m=ba(m)}else"xsl"==u&&(e=m=ba(m));k[m]=v}a&&(k[m="css"]=a);b[2]&&(k[m="parms"]=b[2]);b[3]&&(k[m="state"]=b[3]);d&&e?(m=JSON.stringify(k),h+=".js",c=c[1]+"var resources="+m+";"+c[2]+c[3],c=c.replace(/\u00A9/g,
"&#xA9;"),m=h,g=null,k="data:application/javascript,",k=ra("Firefox")?k+encodeURIComponent(c):k+encodeURI(c),m&&(g=document.createElement("a"),"string"!=typeof g.download&&(g=null)),g?(g.href=k,g.download=m,document.body.appendChild(g),g.click(),document.body.removeChild(g),c="Check your Downloads folder for "+m+"."):(window.open(k),c="Check your browser for a new window/tab containing the requested data"+(m?" ("+m+")":"")+"."),c+=', copy it to your web server as "'+h+'", and then add the following to your web page:\n\n',
c+='<div id="'+f+'"></div>\n',c+="...\n",c+='<script type="text/javascript" src="'+h+'">\x3c/script>\n',c+='<script type="text/javascript">embedPC("'+f+'","'+d+'","'+e+'");\x3c/script>\n\n',c+="The machine should appear where the <div> is located.",q(c)):q("Missing XML/XSL resources")}
window.savePC=function(a,b,c){var d=Ma("Computer",a),e=Ma("Debugger",a);if(d){var f=jd(d,!0),h=d.s?JSON.stringify(d.s):null;b||(b="/versions/pcjs/1.23.3/pc"+(e?"-dbg":"")+".js");if(c&&c({state:f,Xb:h}))return!0;p(b,null,!0,function(c,d,e){rd(c,d,e,[a,ba(b,!0),h,f])});return!0}q("Unable to identify machine '"+a+"'");return!1};})();
